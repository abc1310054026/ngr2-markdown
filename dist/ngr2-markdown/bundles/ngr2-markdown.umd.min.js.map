{"version":3,"sources":["ng://ngr2-markdown/lib/core/markdown/markdown.ts","node_modules/tslib/tslib.es6.js","ng://ngr2-markdown/lib/core/fileOperator.ts","ng://ngr2-markdown/lib/utils/textParser.ts","ng://ngr2-markdown/lib/service/ngr2-markdown.service.ts","ng://ngr2-markdown/lib/utils/parseUnit.ts","ng://ngr2-markdown/lib/ngr2-markdown.component.ts","ng://ngr2-markdown/lib/side-toc/side-toc.component.ts","ng://ngr2-markdown/lib/pipe/htmlpipe.pipe.ts","ng://ngr2-markdown/lib/pipe/md.pipe.ts","ng://ngr2-markdown/lib/tool-bar/tool-bar.component.ts","ng://ngr2-markdown/lib/edit-box/edit-box.component.ts","ng://ngr2-markdown/lib/core/indexedDB/indexedDB.ts","ng://ngr2-markdown/lib/file-browser/file-browser.component.ts","ng://ngr2-markdown/lib/status-bar/status-bar.component.ts","ng://ngr2-markdown/lib/control-bar/control-bar.component.ts","ng://ngr2-markdown/lib/menu/menu.component.ts","ng://ngr2-markdown/lib/core/dad/dragAndDropEvent.ts","ng://ngr2-markdown/lib/core/dad/dragAndDrop.ts","ng://ngr2-markdown/lib/core/dad/dragAndDropContainer.ts","ng://ngr2-markdown/lib/drag-and-drop.directive.ts","ng://ngr2-markdown/lib/ngr2-markdown.module.ts"],"names":["MarkdownImpl","_this","this","markdownIt","MarkdownIt","highlight","str","lang","hljs.getLanguage","hljs.highlight","value","__","utils","escapeHtml","prototype","render","markdown","options","disable","html","enable","use","fn","md","Observable","subscriber","option","enableRules","Object","keys","filter","disableRules","__read","o","n","m","Symbol","iterator","r","e","i","call","ar","next","done","push","error","__spread","arguments","length","concat","FileOperatorImpl","fileReader","FileReader","toDataURL","fileOrBlob","readAsDataURL","mergeFileReader","toText","encoding","readAsText","toArrayBuffer","readAsArrayBuffer","toDataURLSync","result","window","URL","createObjectURL","revokeDataURLSync","revokeObjectURL","merge","apply","fromEvent","pipe","map","assign","TextParser","parse","text","words","match","WORDS","bytes","lines","charCodeAt","charAt","console","log","parseMD","parseHTML","_DIV","innerHTML","textContent","document","createElement","RegExp","Ngr2MarkdownService","originMd","BehaviorSubject","resetMd","currentHeading","currentContent","TOCInfo","_md","anchor","subscribe","infoList","item","TOCItem","content","indentLevel","root","parent","children","renderMd","mdText","reinitialization","observerResetMarkdown","updateMarkdown","observeMarkdown","setCurrentHeading","heading","getValue","currentContentToDataUrl","type","file","fileOperator","Blob","observer","core","ruler","state","tokens","token","index","array","attrJoin","attrGet","markup","Injectable","args","providedIn","EditorOption","mode","TOC","toolBar","direction","height","themeColor","bodyClassName","MODE","ANCHOR","TOc","TOOL_BAR","DIRECTION","HEIGHT","THEME_COLOR","BODY_CLASS_NAME","instanceOf","Array","ParseUnit","checkUnit","unitMap","caseSensitive","UNIT_MAP","toLocaleLowerCase","isMatch","ascii","exist","child","unit","substr","number","Number","parseInt","b","v","c","p","h","l","a","q","t","w","x","Ngr2MarkdownComponent","markdownService","defineProperty","_options","ngOnInit","_html","setTimeout","updateHeadingInfo","markdownBody","nativeElement","headingElementRef","markdownScroll","distinctUntilChanged","headingElementMarginTop","scrollTop","preRect","curRect","preMarginTop","curMarginTop","baseOffsetTop","getBoundingClientRect","top","reduce","previousValue","currentValue","id","nodeList","querySelectorAll","undefined","splice","nodes","marginTop","getComputedStyle","_a","element","property","pseudoElt","getPropertyValue","Component","selector","template","encapsulation","ViewEncapsulation","None","ViewChild","read","ElementRef","Input","SideTocComponent","HTMLPipePipe","domSanitizer","transform","_i","bypassSecurityTrustHtml","bypassSecurityTrustUrl","Pipe","name","DomSanitizer","MdPipe","ToolBarComponent","MdFileOperator","HTMLFileOperator","titleSubscribe","title","hrefSubscribe","mdHref","htmlHref","ngOnDestroy","unsubscribe","EditBoxComponent","el","mdSubject","Subject","_el","_editArea","querySelector","innerText","bindMdService","bindMutationObserver","observeText","time","debounceTime","asObservable","MutationObserver","mutations","getText","observe","subtree","childList","characterData","characterDataOldValue","IndexedDB","dbName","objectStoreStructs","O_S_STRUCT","request","indexedDB","open","onerror","event","alert","onsuccess","_db","onupgradeneeded","forEach","store","objectStore","createObjectStore","optionalParameters","indexes","createIndex","keyPath","instenceof","getObjectStore","storeName","IndexedDBStore","transaction","unique","add","data","initRequest","addAll","addObservables","_concat_scan","getById","key","get","getAll","observable","openCursor","cursor","IndexedDBEvent","IndexedDBEventType","COMPLETE","continue","complete","ERROR","getCount","mergeMap","_from_scan","getAllById","getObservables","getAllByIndex","indexName","update","put","updateAll","updateObservables","delete","deleteAll","deleteObservables","object","count","total","scan","acc","loaded","PENDING","observables","SUCCESS","FileBrowserComponent","renderer","indexedDBStructs","autoIncrement","inputAreaLi","addClass","inputAreaI","appendChild","createText","inputAreaInput","setAttribute","inputArea","isConnect","selectedArticles","db","refreshArticles","fileListArea","fileList","createFile","cloneEl","cloneNode","listen","ev","code","Article","removeChild","createFolder","rename","getOwnPropertyNames","selected","replaceChild","focus","close","select","article","toString","classList","remove","articles","Renderer2","author","AUTHOR","TITLE","CONTENT","createTime","Date","lastModifiedTime","StatusBarComponent","ControlBarComponent","MenuComponent","DragAndDropEvent","eventOptions","interceptor","ALL_OPTIONS","initEvent","eventObservable","addEventListener","addListenFunction","resultSelector","eventType","streamOperator","listener","tap","preventDefault","stopPropagation","cancelBubble","operatorOptions","operator","throttleTime","dragstart","DragAndDropEventType","defaultFun","group","groupEnd","drag","dragend","dragenter","dragover","drop","DragAndDropElement","parentContainer","elementStyle","demoStyle","ELEMENT_STYLE","DEMO_STYLE","diagonal","RT_ANGLE","Math","PI","LT_ANGLE","LB_ANGLE","RB_ANGLE","_parent","parentElement","clone","style","draggable","_dadEvent","ondragstart","bind","ondrag","ondragend","ondragenter","equals","getDragElement","target","ondragover","ondrop","status","rect","clientRect","centerPoint","Point","left","width","reset","transitDemonstrationFinish","setDragElement","setDropElement","atan2","transitDemonstration","clientX","clientY","ondragleave","ondragexit","replaceElement","insertBefore","insertAfter","nextElementSibling","computeDirection","point","relaitiveTo","angle","Y","X","draggedEl","dir","dragElement","removeElement","newEl","oldEl","opacity","relato","DragAndDropContainer","_children","DADChildren","dragEl","_dragEl","getTime","dataTransfer","setData","dropEl","_dropEl","getDropElement","types","split","DragAndDropDirective","ngAfterViewInit","DADContainer","Directive","Ngr2MarkdownModule","NgModule","declarations","imports","BrowserModule","exports"],"mappings":"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","sourcesContent":["// import * as MarkdownIt from 'markdown-it';\r\n// å¦ä¸ç¨TSç@typesåè£å¼å¥å¨ie11ä¸­æ æ³å¼å®¹, å¨æååºæ¥çvendor.jsä¸­ä¼æä¸è¡ä½¿ç¨äºç®­å¤´å½æ°çä»£ç æ¥(è¯­æ³éè¯¯)\r\n// ç´æ¥å¼å¥markdown-it.min.jså¯ä»¥é¿å\r\nimport * as MarkdownIt from 'node_modules/markdown-it/dist/markdown-it.min.js';\r\nimport {Observable, Observer} from 'rxjs';\r\nimport * as hljs from 'highlight.js';\r\n\r\nexport class MarkdownImpl implements Markdown {\r\n  markdownIt: MarkdownIt;\r\n\r\n  constructor() {\r\n    this.markdownIt = new MarkdownIt({\r\n      highlight: (str: string, lang: string) => {\r\n        if (lang && hljs.getLanguage(lang)) {\r\n          try {\r\n            return '<pre class=\"hljs\"><code>' +\r\n              hljs.highlight(lang, str).value +\r\n              '</code></pre>';\r\n          } catch (__) {}\r\n        }\r\n        return '<pre class=\"hljs\"><code>' + this.markdownIt.utils.escapeHtml(str) + '</code>';\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * render markdown text function\r\n   * æ¸²æå½æ°\r\n   * @param markdown - markdown format text - markdownæ ¼å¼çææ¬\r\n   * @param options - use to open or close plugins\r\n   * @return - return transformation html - è¿åæ¸²æåçhtml\r\n   */\r\n  render(markdown: string, options?: MarkdownOption) {\r\n    this.disable(options);\r\n    const html = this.markdownIt.render(markdown);\r\n    this.enable(options);\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * fn: ä¼ å¥çæ¹æ³å¯ä»¥å¯¹mdçåå®¹è¿è¡å¤ç, å¤çç»æç±subjectååº\r\n   * fn.md: Markdownå¯¹è±¡åå®¹é½å¨éé¢\r\n   * fm.subject: è§å¯è, å¤çç»æç±æ­¤ä¼ åº\r\n   * @param fn\r\n   */\r\n  use<T>(fn: (md: MarkdownIt, subject: Observer<T>) => void): Observable<T> {\r\n    const md = this.markdownIt;\r\n    const observable = new Observable<T>(function (subscriber) {\r\n      md.use(fn, subscriber);\r\n    });\r\n    return observable;\r\n  }\r\n\r\n  enable(option: MarkdownOption) {\r\n    if (!option) { return; }\r\n    const enableRules = Object.keys(option).filter((value => {\r\n      return !option[value];\r\n    }));\r\n    this.markdownIt.enable(enableRules);\r\n  }\r\n\r\n  disable(option: MarkdownOption) {\r\n    if (!option) { return; }\r\n    const disableRules = Object.keys(option).filter((value => {\r\n      return !option[value];\r\n    }));\r\n    this.markdownIt.disable(disableRules);\r\n  }\r\n}\r\n\r\nexport class MarkdownOptionImpl implements MarkdownOption {\r\n  anchor: boolean;\r\n}\r\n\r\ninterface Markdown {\r\n  render(markdown: string, options: any);\r\n  use<T>(fn: (md: any, observer: Observer<T>) => void);\r\n  enable(option: MarkdownOption);\r\n  disable(option: MarkdownOption);\r\n}\r\n\r\ninterface MarkdownOption {\r\n  anchor: boolean;\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import {fromEvent, merge, Observable} from 'rxjs';\r\nimport {map} from 'rxjs/operators';\r\n\r\nexport class FileOperatorImpl implements FileOperator {\r\n  result: string;\r\n  private fileReader = new FileReader();\r\n  toDataURL(fileOrBlob: File | Blob): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsDataURL(fileOrBlob);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toText(fileOrBlob: File | Blob, encoding?: string): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsText(fileOrBlob, encoding);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toArrayBuffer(fileOrBlob: File | Blob): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsArrayBuffer(fileOrBlob);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toDataURLSync(fileOrBlob: File | Blob): string {\r\n    this.result = window.URL.createObjectURL(fileOrBlob);\r\n    return this.result;\r\n  }\r\n\r\n  revokeDataURLSync(): void {\r\n    window.URL.revokeObjectURL(this.result);\r\n  }\r\n\r\n  private mergeFileReader(fileReader: FileReader): Observable<FileProgressEvent> {\r\n    return merge(...[fromEvent(fileReader, 'load'),\r\n      fromEvent(fileReader, 'loadstart'),\r\n      fromEvent(fileReader, 'loadend'),\r\n      fromEvent(fileReader, 'progress'),\r\n      fromEvent(fileReader, 'error'),\r\n      fromEvent(fileReader, 'abort')])\r\n      .pipe(\r\n        map((value: ProgressEvent): FileProgressEvent => {\r\n          return Object.assign(value, {\r\n            result: fileReader.result || '',\r\n            error: fileReader.error || null\r\n          });\r\n        })\r\n      );\r\n  }\r\n}\r\n\r\nexport interface FileOperator {\r\n  toDataURL(fileOrBlob: File | Blob): Observable<FileProgressEvent>;\r\n  toText(fileOrBlob: File | Blob, encoding?: string): Observable<FileProgressEvent>;\r\n  toArrayBuffer(fileOrBlob: File | Blob): Observable<FileProgressEvent>;\r\n  toDataURLSync(fileOrBlob: File | Blob): string;\r\n  revokeDataURLSync(): void;\r\n}\r\n\r\nexport interface FileProgressEvent extends ProgressEvent {\r\n  result?: string | ArrayBuffer | null;\r\n  error?: DOMException | null;\r\n}\r\n","export class TextParser {\r\n\r\n  private static _DIV = document.createElement('DIV');\r\n  static WORDS = new RegExp('/([a-zA-Z]+)|([\\u4e00-\\u9fa5])/g');\r\n\r\n  private static parse(text: string): void {\r\n    if (!text) { return; }\r\n    const words = (text.match(TextParser.WORDS) || []).length;\r\n    let bytes = 0;\r\n    let lines = 0;\r\n    for (let i = 0; i < text.length; i++) {\r\n      if (text.charCodeAt(i) & 0xff00) {\r\n        bytes++;\r\n      } else if (text.charAt(i) === '\\n') {\r\n        lines++;\r\n      }\r\n      bytes++;\r\n    }\r\n    console.log({\r\n      words: words,\r\n      bytes: bytes,\r\n      lines: lines\r\n    });\r\n  }\r\n\r\n  static parseMD(markdown: string): void {\r\n    this.parse(markdown);\r\n  }\r\n\r\n  static parseHTML(html: string): void {\r\n    TextParser._DIV.innerHTML = html;\r\n    this.parse(TextParser._DIV.textContent);\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport * as MarkdownIt from 'markdown-it/lib/index';\r\nimport {BehaviorSubject, Observable, Observer} from 'rxjs';\r\nimport {MarkdownImpl, MarkdownOptionImpl} from '../core/markdown/markdown';\r\nimport {FileOperatorImpl} from '../core/fileOperator';\r\nimport {map} from 'rxjs/operators';\r\nimport {TextParser} from '../utils/textParser';\r\nimport {IndexedDB} from '../core/indexedDB/indexedDB';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class Ngr2MarkdownService {\r\n\r\n  /**\r\n   * æ¥æ¶Markdownæºææ¬\r\n   */\r\n  private originMd: BehaviorSubject<string> = new BehaviorSubject<string>(null);\r\n  private resetMd: BehaviorSubject<string> = new BehaviorSubject<string>(null);\r\n  /**\r\n   * è§å¯`originMd`éè¿`render`æ¹æ³æ¸²æåºçHTML\r\n   */\r\n  private renderMd: Observable<MarkdownContent>;\r\n  private _md: MarkdownImpl;\r\n  /**\r\n   * å½åæµè§çæ é¢çSubject, BehaviorSubjectå¯æ¯æå¤æ­(å¨å¤å¤è®¢é)\r\n   */\r\n  currentHeading: BehaviorSubject<string> = new BehaviorSubject<string>(null);\r\n  /**\r\n   * @deprecated\r\n   */\r\n  currentContent: BehaviorSubject<{md: string, html: string}> = new BehaviorSubject<{md: string, html: string}>({md: '', html: ''});\r\n  /**\r\n   * åéç®å½ä¿¡æ¯çSubject\r\n   */\r\n  TOCInfo: BehaviorSubject<TOCItem> = new BehaviorSubject<TOCItem>(null);\r\n\r\n  constructor() {\r\n    this._md = new MarkdownImpl();\r\n    this._md.use(this.anchor)\r\n      .subscribe((value: Array<any>) => {\r\n        const infoList = value.map((item) => {\r\n          return new TOCItem(item.content, item.indentLevel);\r\n        });\r\n        const root = new TOCItem('root', 0);\r\n        let TOCInfo = root;\r\n        for (let i = 0; i < infoList.length; i++) {\r\n          while (TOCInfo && TOCInfo.indentLevel >= infoList[i].indentLevel) {\r\n            TOCInfo = TOCInfo.parent;\r\n          }\r\n          infoList[i].parent = TOCInfo;\r\n          TOCInfo.children.push(infoList[i]);\r\n          TOCInfo = infoList[i];\r\n        }\r\n        this.TOCInfo.next(root);\r\n      });\r\n\r\n    this.renderMd = this.originMd\r\n      .pipe(\r\n        map(mdText => {\r\n          return {\r\n            md:   mdText || null,\r\n            html: this.render(mdText)\r\n          };\r\n        })\r\n      );\r\n\r\n    this.resetMd\r\n      .subscribe(this.originMd);\r\n  }\r\n\r\n  /**\r\n   * éç½®markdownææ¬\r\n   * @param md\r\n   */\r\n  reinitialization(md: string): void {\r\n    if (!md) { return; }\r\n    this.resetMd.next(md);\r\n  }\r\n\r\n  /**\r\n   * markdownææ¬éç½®å, ååºæ¶æ¯\r\n   */\r\n  observerResetMarkdown(): Observable<string> {\r\n    return this.resetMd;\r\n  }\r\n\r\n  /**\r\n   * æ´æ°markdownææ¬, ç¨äºå®æ¶é¢è§åè½\r\n   * @param md\r\n   */\r\n  updateMarkdown(md: string | Observable<string>): void {\r\n    if (!md) { return; }\r\n\r\n    if (md instanceof Observable) {\r\n      md.subscribe(this.originMd);\r\n    } else {\r\n      this.originMd.next(md);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * markdownææ¬æ´æ°å, ååºæ¶æ¯\r\n   */\r\n  observeMarkdown(): Observable<MarkdownContent> {\r\n    return this.renderMd;\r\n  }\r\n\r\n  render(markdown: string, options?: MarkdownOptionImpl): string {\r\n    if (!markdown) {\r\n      markdown = '';\r\n    }\r\n    const html = this._md.render(markdown, options);\r\n    TextParser.parseMD(markdown);\r\n    TextParser.parseHTML(html);\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®å½åæµè§çæ é¢\r\n   * @param heading - æ é¢æ ç­¾çid\r\n   */\r\n  setCurrentHeading(heading: string): void {\r\n    if (this.currentHeading.getValue() !== heading) {\r\n      this.currentHeading.next(heading);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å°å½åæ¾ç¤ºçåå®¹è½¬æ¢æ`data:`url\r\n   * @param type - `markdown`/`html`: è¦è½¬æ¢çåå®¹\r\n   */\r\n  currentContentToDataUrl(type: string): FileOperatorImpl {\r\n    const fileOperator = new FileOperatorImpl();\r\n    // å¼å®¹ie11-10, ie10ä¸æ¯æFileå¯¹è±¡çæé å½æ°, æ æ³æ°å»ºFileå¯¹è±¡, æä½¿ç¨Blob\r\n    let file: Blob | File;\r\n    switch (type) {\r\n      case 'markdown':\r\n        file = new Blob([this.currentContent.getValue().md], {type: 'text/plain'});\r\n        break;\r\n      case `html`:\r\n        file = new Blob([this.currentContent.getValue().html], {type: 'text/html'});\r\n        break;\r\n      default:\r\n        file = new Blob(['null'], {type: 'text/html'});\r\n        break;\r\n    }\r\n    fileOperator.toDataURLSync(file);\r\n    return fileOperator;\r\n  }\r\n\r\n  /**\r\n   * Plugin: anchor\r\n   * è¿ä¸ªæ¹æ³åç±»åä¸ºheading_opençtokenæ·»å id, ç¨äºéç¹å®ä½\r\n   * @param md - MarkdownIt instance\r\n   * @param observer - use to push info\r\n   */\r\n  private anchor(md: MarkdownIt, observer: Observer<Array<any>>) {\r\n    md.core.ruler.push('anchor', (state => {\r\n      const infoList: Array<any> = [];\r\n      state.tokens.map((token, index, array) => {\r\n        if (token.type === 'heading_open') {\r\n          token.attrJoin('id', array[index + 1].content);\r\n          infoList.push({\r\n            content: token.attrGet('id'),\r\n            indentLevel: token.markup.length\r\n          });\r\n        }\r\n      });\r\n      observer.next(infoList);\r\n    }));\r\n  }\r\n}\r\n\r\nexport interface MarkdownContent {\r\n  md: string;\r\n  html?: string;\r\n  Markdown?: {\r\n    text:   string,\r\n    bytes:  number,\r\n    words:  number,\r\n    lines:  number\r\n  };\r\n  HTML?: {\r\n    text:       string,\r\n    characters: number,\r\n    words:      number,\r\n    paragraphs: number\r\n  };\r\n}\r\n/**\r\n * ç®å½(TOC)çæçä½ç½®\r\n * start: TOCå¨åå®¹å·¦è¾¹\r\n * end: å³è¾¹\r\n */\r\ntype TocPos = 'left' | 'right';\r\n/**\r\n * æ¨¡å¼\r\n * preview: é¢è§æ¨¡å¼\r\n * edit: ç¼è¾æ¨¡å¼\r\n */\r\ntype Mode = 'preview' | 'edit';\r\n\r\nexport class EditorOption {\r\n  static MODE: Mode = 'edit';\r\n  static ANCHOR = false;\r\n  static TOc = false;\r\n  static TOOL_BAR = false;\r\n  static DIRECTION: TocPos = 'left';\r\n  static HEIGHT = '800px';\r\n  static THEME_COLOR = '#3f51b5';\r\n  static BODY_CLASS_NAME = 'markdown-body';\r\n\r\n  mode: Mode;\r\n  anchor: boolean;\r\n  TOC: boolean;\r\n  toolBar: boolean;\r\n  direction: TocPos;\r\n  /**\r\n   * container height property\r\n   */\r\n  height: string;\r\n  /**\r\n   * container toc active color property\r\n   */\r\n  themeColor: string;\r\n  bodyClassName: string;\r\n\r\n  constructor(mode: Mode            = EditorOption.MODE,\r\n            anchor: boolean         = EditorOption.ANCHOR,\r\n              TOC: boolean          = EditorOption.TOc,\r\n              toolBar: boolean      = EditorOption.TOOL_BAR,\r\n              direction: TocPos     = EditorOption.DIRECTION,\r\n              height: string        = EditorOption.HEIGHT,\r\n              themeColor: string    = EditorOption.THEME_COLOR,\r\n              bodyClassName: string = EditorOption.BODY_CLASS_NAME\r\n  ) {\r\n    this.mode =           mode;\r\n    this.anchor =         anchor;\r\n    this.TOC =            TOC;\r\n    this.toolBar =        toolBar;\r\n    this.direction =      direction;\r\n    this.height =         height;\r\n    this.themeColor =     themeColor;\r\n    this.bodyClassName =  bodyClassName;\r\n  }\r\n\r\n  static instanceOf(value: EditorOption) {\r\n    return new EditorOption(\r\n      value.mode          || EditorOption.MODE,\r\n      value.anchor        || EditorOption.ANCHOR,\r\n      value.TOC           || EditorOption.TOc,\r\n      value.toolBar       || EditorOption.TOOL_BAR,\r\n      value.direction     || EditorOption.DIRECTION,\r\n      value.height        || EditorOption.HEIGHT,\r\n      value.themeColor    || EditorOption.THEME_COLOR,\r\n      value.bodyClassName || EditorOption.BODY_CLASS_NAME,\r\n    );\r\n  }\r\n}\r\n\r\nexport class TOCItem {\r\n  content: string;\r\n  indentLevel: number;\r\n  parent: TOCItem;\r\n  children: Array<TOCItem>;\r\n\r\n  constructor(content: string, indentLevel: number) {\r\n    this.content      = content;\r\n    this.indentLevel  = indentLevel;\r\n    this.children     = new Array<TOCItem>();\r\n  }\r\n}\r\n","export class ParseUnit {\r\n  static UNIT_MAP = {\r\n    exist: false,\r\n    child: {\r\n      'b': {\r\n        exist: false,\r\n        child: {\r\n          'v': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'c': {\r\n        exist: false,\r\n        child: {\r\n          'i': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          },\r\n          'p': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'h': {\r\n        exist: false,\r\n        child: {\r\n          'c': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          },\r\n          'l': {\r\n            exist: true,\r\n            child: {\r\n              'r': {\r\n                exist: true,\r\n                child: {\r\n                }\r\n              }\r\n            }\r\n          },\r\n          'v': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'i': {\r\n        exist: false,\r\n        child: {\r\n          'v': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'm': {\r\n        exist: false,\r\n        child: {\r\n          'e': {\r\n            exist: true,\r\n            child: {\r\n              'r': {\r\n                exist: true,\r\n                child: {\r\n                }\r\n              }\r\n            }\r\n          },\r\n          'm': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          },\r\n          'c': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'n': {\r\n        exist: false,\r\n        child: {\r\n          'i': {\r\n            exist: true,\r\n            child: {\r\n              'm': {\r\n                exist: false,\r\n                child: {\r\n                  'v': {\r\n                    exist: true,\r\n                    child: {\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'p': {\r\n        exist: false,\r\n        child: {\r\n          'a': {\r\n            exist: false,\r\n            child: {\r\n              'c': {\r\n                exist: true,\r\n                child: {\r\n                }\r\n              },\r\n            }\r\n          },\r\n        }\r\n      },\r\n      'q': {\r\n        exist: true,\r\n        child: {\r\n        }\r\n      },\r\n      't': {\r\n        exist: false,\r\n        child: {\r\n          'p': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'w': {\r\n        exist: false,\r\n        child: {\r\n          'v': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      },\r\n      'x': {\r\n        exist: false,\r\n        child: {\r\n          'a': {\r\n            exist: false,\r\n            child: {\r\n              'm': {\r\n                exist: false,\r\n                child: {\r\n                  'v': {\r\n                    exist: true,\r\n                    child: {\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          },\r\n          'e': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          },\r\n          'p': {\r\n            exist: true,\r\n            child: {\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  static checkUnit(str: string, unitMap: any = ParseUnit.UNIT_MAP, caseSensitive?: boolean): {\r\n    unit: string,\r\n    number: number\r\n  } {\r\n    if (!unitMap || !str) { return; }\r\n    if (!caseSensitive) { str = str.toLocaleLowerCase(); }\r\n    let i: number, isMatch = false;\r\n    for (i = str.length - 1; i >= 0; i--) {\r\n      const ascii = str.charCodeAt(i);\r\n      if (ascii >= 48 && ascii <= 57) {\r\n        isMatch = unitMap.exist;\r\n        break;\r\n      } else {\r\n        if (!unitMap.child[str[i]]) { break; }\r\n        unitMap = unitMap.child[str[i]];\r\n      }\r\n    }\r\n    return isMatch ? {\r\n      unit: str.substr(i + 1),\r\n      number: Number.parseInt(str.substr(0, i + 1), 10)\r\n    } : null;\r\n  }\r\n}\r\n","/*\r\n* æµç¨å¾\r\n* change `markdown` --> render `markdown` --> change `_html'\r\n*                                       --> change `headingInfo`\r\n*                                       --> init `headingElementRef`, `headingElementMarginTop`\r\n*                                       --> view changed `ngAfterViewChecked()` --> change `headingElementRef`\r\n*                                                        --> change `headingElementMarginTop`\r\n*                                                        --> wait view scroll --> `markdownScroll()`\r\n*                                                                             --> `markdownService.setCurrentBrowseHeading`\r\n* */\r\n\r\nimport {\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnInit,\r\n  ViewChild,\r\n  ViewEncapsulation\r\n} from '@angular/core';\r\nimport {EditorOption, Ngr2MarkdownService} from './service/ngr2-markdown.service';\r\nimport {fromEvent} from 'rxjs';\r\nimport {distinctUntilChanged, filter, map} from 'rxjs/operators';\r\nimport {ParseUnit} from './utils/parseUnit';\r\n\r\n@Component({\r\n  selector: 'nb-ngr2-markdown',\r\n  templateUrl: './ngr2-markdown.component.html',\r\n  styleUrls: [\r\n    './ngr2-markdown.component.css',\r\n  ],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class Ngr2MarkdownComponent implements OnInit {\r\n  @ViewChild('markdownBody', {\r\n    read: ElementRef\r\n  }) markdownBody: ElementRef;\r\n  /**\r\n   * markdownè½¬æ¢åçhtmlææ¬\r\n   */\r\n  _html: string;\r\n  /**\r\n   * éç½®åæ°\r\n   */\r\n  _options: EditorOption;\r\n  /**\r\n   * æ é¢æ ç­¾å¼ç¨çæ°ç»\r\n   */\r\n  headingElementRef: Array<HTMLElement>;\r\n  /**\r\n   * æ é¢æ ç­¾margin-topå±æ§çé®å¼å¯¹\r\n   * key: id, value: margin-topçpxå¼\r\n   */\r\n  headingElementMarginTop: {\r\n    [key: string]: number\r\n  };\r\n  @Input()\r\n  set markdown(value: string) {\r\n    this.markdownService.updateMarkdown(value);\r\n  }\r\n  @Input()\r\n  set options(value: EditorOption) {\r\n    this._options = EditorOption.instanceOf(value);\r\n  }\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.markdownService.observeMarkdown()\r\n      .subscribe(value => {\r\n        // æ´æ°innerHTML\r\n        this._html = value.html;\r\n        // éæ°åå§åä¸äºéè¦è§å¾æ¸²æç»ææè½è·åçå¯¹è±¡çå¼\r\n        this.reinitialization();\r\n        setTimeout(() => {\r\n          this.updateHeadingInfo();\r\n        });\r\n      });\r\n    fromEvent(this.markdownBody.nativeElement, 'scroll')\r\n      .pipe(\r\n        filter(() => this.headingElementRef && this.headingElementRef.length > 0),\r\n        map(() => this.markdownScroll()),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe(this.markdownService.currentHeading);\r\n  }\r\n\r\n  reinitialization() {\r\n    this.headingElementMarginTop = {};\r\n    // åå§åæ é¢åç´ çæ°ç»\r\n    this.headingElementRef = [];\r\n    // é¡µé¢æ»å¨å°é¡¶é¨\r\n    this.markdownBody.nativeElement.scrollTop = 0;\r\n    // éç½®å½åæ é¢\r\n    this.markdownService.setCurrentHeading(null);\r\n  }\r\n\r\n  /**\r\n   * @description <b>åç´ çä½ç½®ç¨\r\n   * [getBoundingClientRect()]{@link https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect}è·å,\r\n   * è¿ä¸ªæ¹æ³å¾å°çç©å½¢ä¸ä¼åæ¬åç´ çå¤è¾¹è·(margin)</b>\r\n   * å¦ææ³è¦å¨æ£æµæ¶åæ¬å¤è¾¹è·, éè¦åè·åå°å¤è¾¹è·\r\n   * markdownåå®¹æ»å¨æ¶è§¦å\r\n   * åºäºç¶åç´ çé¡¶é¨ä½ç½®, å¤æ­å½åæµè§çæ é¢åå®¹\r\n   * éåºæ é¢åç´ (h1 ~ h6)çé¡¶é¨å¨ç¶åç´ (class=markdown)é¡¶é¨ä¹ä¸æç¸ç­çåç´ , ä½ä¸ºå½åæµè§çæ é¢\r\n   */\r\n  markdownScroll(): string {\r\n    // ç¶åç´ é¡¶é¨çåæ \r\n    const baseOffsetTop = (<HTMLElement> this.markdownBody.nativeElement).getBoundingClientRect().top;\r\n    let preRect: ClientRect;\r\n    let curRect: ClientRect;\r\n    let preMarginTop: number;\r\n    let curMarginTop: number;\r\n    const elem =  this.headingElementRef.reduce((previousValue, currentValue) => {\r\n      preRect = previousValue.getBoundingClientRect();\r\n      curRect = currentValue.getBoundingClientRect();\r\n      preMarginTop = this.headingElementMarginTop[previousValue.id];\r\n      curMarginTop = this.headingElementMarginTop[currentValue.id];\r\n      // è¿æ»¤å¨é¡¶é¨ä¹ä¸çæ é¢\r\n      if (curRect.top - baseOffsetTop - curMarginTop > 0) {\r\n        return previousValue;\r\n      }\r\n      // æ¾å°è·ç¦»é¡¶é¨æè¿çæ é¢\r\n      if ((curRect.top - baseOffsetTop - curMarginTop) > (preRect.top - baseOffsetTop - preMarginTop)) {\r\n        return currentValue;\r\n      } else {\r\n        return previousValue;\r\n      }\r\n    });\r\n    return elem.id;\r\n  }\r\n\r\n  /**\r\n   * æ´æ°æ¸²æåçhtmlåå®¹ä¸­çæ é¢é¨å(h1 ~ h6)å°headingElementRef\r\n   */\r\n  updateHeadingInfo() {\r\n    const nodeList = (<Element> this.markdownBody.nativeElement).querySelectorAll('h1, h2');\r\n    if (nodeList === undefined || nodeList === null) {\r\n      return;\r\n    }\r\n\r\n    this.headingElementRef.splice(0);\r\n    const nodes: Array<HTMLElement> = [];\r\n    for (let i = 0; i < nodeList.length; i++) {\r\n      const value = <HTMLElement> nodeList[i];\r\n      // æåelementçæ ·å¼\r\n      const marginTop = this.getComputedStyle(value, 'margin-top');\r\n      this.headingElementMarginTop[value.id] = ParseUnit.checkUnit(marginTop).number;\r\n      nodes.push(value);\r\n    }\r\n    // Element.style.xxxåªè½è¯»åè¡åæ ·å¼\r\n    this.headingElementRef.push(...nodes);\r\n  }\r\n\r\n  getComputedStyle(element: Element, property: string, pseudoElt?: string): string {\r\n    return window.getComputedStyle(element, null).getPropertyValue(property);\r\n  }\r\n}\r\n","import {Component, Input, OnInit} from '@angular/core';\r\nimport {Ngr2MarkdownService, TOCItem} from '../service/ngr2-markdown.service';\r\n\r\n@Component({\r\n  selector: 'nb-side-toc',\r\n  templateUrl: './side-toc.component.html',\r\n  styleUrls: ['./side-toc.component.css']\r\n})\r\nexport class SideTocComponent implements OnInit {\r\n  @Input() currentHeading: string;\r\n  @Input() themeColor = '#3f51b5';\r\n  TOCInfo: TOCItem;\r\n  constructor(\r\n    private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.markdownService.currentHeading.subscribe({\r\n      next: (value => {\r\n        this.currentHeading = value;\r\n      })\r\n    });\r\n    this.markdownService.TOCInfo.subscribe({\r\n      next: (value => {\r\n        this.TOCInfo = value;\r\n      })\r\n    });\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport {DomSanitizer, SafeHtml, SafeUrl} from '@angular/platform-browser';\r\n\r\n@Pipe({\r\n  name: 'safe'\r\n})\r\nexport class HTMLPipePipe implements PipeTransform {\r\n\r\n  constructor(private domSanitizer: DomSanitizer) {\r\n  }\r\n\r\n  /**\r\n   * use DomSanitizer allow insert outside HTML\r\n   * ä½¿ç¨DomSanitizeråè®¸æå¥å¤é¨çHTML\r\n   * @param value - html content htmlåå®¹\r\n   * @param args = ç¬¬ä¸ä¸ªåæ°æ¯åå®¹ç±»å`html/url` é»è®¤ä¸º `html`\r\n   * @return - transformed html content htmlåæ¢åçåå®¹\r\n   */\r\n  transform(value: any, ...args: any[]): SafeHtml | SafeUrl {\r\n    const type = args[0];\r\n    switch (type) {\r\n      case 'html':\r\n        return this.domSanitizer.bypassSecurityTrustHtml(value);\r\n      case 'url':\r\n        return this.domSanitizer.bypassSecurityTrustUrl(value);\r\n      default:\r\n        return this.domSanitizer.bypassSecurityTrustHtml(value);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\n\r\n@Pipe({\r\n  name: 'md'\r\n})\r\nexport class MdPipe implements PipeTransform {\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService) {\r\n  }\r\n\r\n  transform(value: string, args?: any): any {\r\n    return this.markdownService.render(value, {anchor: false});\r\n  }\r\n\r\n}\r\n","import {Component, ElementRef, OnDestroy, OnInit, ViewChild} from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {Subscription} from 'rxjs';\r\nimport {FileOperatorImpl} from '../core/fileOperator';\r\n\r\n@Component({\r\n  selector: 'nb-tool-bar',\r\n  templateUrl: './tool-bar.component.html',\r\n  styleUrls: ['./tool-bar.component.css']\r\n})\r\nexport class ToolBarComponent implements OnInit, OnDestroy {\r\n  @ViewChild('download', {read: ElementRef}) download: ElementRef;\r\n  mdHref: string;\r\n  htmlHref: string;\r\n  title: string;\r\n  titleSubscribe: Subscription;\r\n  hrefSubscribe: Subscription;\r\n  constructor(\r\n    private markdownService: Ngr2MarkdownService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.titleSubscribe = this.markdownService.TOCInfo\r\n      .subscribe(value => this.title = value.content);\r\n    let MdFileOperator: FileOperatorImpl;\r\n    let HTMLFileOperator: FileOperatorImpl;\r\n    this.hrefSubscribe = this.markdownService.currentContent\r\n      .subscribe(value => {\r\n        if (MdFileOperator) { MdFileOperator.revokeDataURLSync(); }\r\n        if (HTMLFileOperator) { HTMLFileOperator.revokeDataURLSync(); }\r\n        MdFileOperator = this.markdownService.currentContentToDataUrl('markdown');\r\n        HTMLFileOperator = this.markdownService.currentContentToDataUrl('html');\r\n        this.mdHref = MdFileOperator.result;\r\n        this.htmlHref = HTMLFileOperator.result;\r\n      });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.titleSubscribe.unsubscribe();\r\n    this.hrefSubscribe.unsubscribe();\r\n  }\r\n}\r\n","import {Component, ElementRef, OnInit} from '@angular/core';\r\nimport {Observable, Subject} from 'rxjs';\r\nimport {debounceTime, distinctUntilChanged} from 'rxjs/operators';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {ShortcutKeyEvent} from '../core/shortcutKey/shortcutKeyEvent';\r\n\r\n@Component({\r\n  selector: 'nb-edit-box',\r\n  templateUrl: './edit-box.component.html',\r\n  styleUrls: ['./edit-box.component.css']\r\n})\r\nexport class EditBoxComponent implements OnInit {\r\n\r\n  private _el: HTMLElement;\r\n  private _editArea: HTMLElement;\r\n  private mdSubject: Subject<string> = new Subject<string>();\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService,\r\n              el: ElementRef\r\n  ) {\r\n    this._el = el.nativeElement;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this._editArea = this._el.querySelector('#editArea');\r\n\r\n    // const sk = new ShortcutKeyEvent(this._editArea);\r\n    // sk.copy()\r\n    //   .subscribe(value => console.log(value));\r\n\r\n    this.markdownService.observerResetMarkdown()\r\n      .subscribe(md => {\r\n        this._editArea.innerText = md;\r\n      });\r\n    this.bindMdService();\r\n    this.bindMutationObserver();\r\n  }\r\n\r\n  /**\r\n   * è®¢éMarkdownServiceçä¸äºSubject/Observable\r\n   */\r\n  private bindMdService(): void {\r\n    this.markdownService.observerResetMarkdown()\r\n      .subscribe(md => {\r\n        this._editArea.textContent = md;\r\n      });\r\n\r\n    this.markdownService\r\n      .updateMarkdown(this.observeText(200));\r\n  }\r\n\r\n  private observeText(time?: number): Observable<string> {\r\n    if (!time) {\r\n      return this.mdSubject.asObservable();\r\n    }\r\n    return this.mdSubject\r\n      .pipe(\r\n        distinctUntilChanged(),\r\n        debounceTime(time)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * ç»å®å¹¶å¼å¯MutationObserver, è§¦åæ¶å°markdownææ¬åéå°`mdSubject`\r\n   */\r\n  private bindMutationObserver() {\r\n    const _observer = new MutationObserver((mutations: Array<MutationRecord>, observer: MutationObserver) => {\r\n      this.mdSubject.next(this.getText());\r\n    });\r\n\r\n    _observer.observe(this._editArea, {\r\n      subtree: true,\r\n      childList: true,\r\n      characterData: true,\r\n      characterDataOldValue: true\r\n    });\r\n  }\r\n\r\n  private getText(): string {\r\n    return this._editArea.innerText;\r\n  }\r\n}\r\n","import {concat, from, Observable, Subscriber} from 'rxjs';\r\nimport {mergeMap, scan} from 'rxjs/operators';\r\nimport {el} from '@angular/platform-browser/testing/src/browser_util';\r\n\r\n// @dynamic\r\nexport class IndexedDB {\r\n  static O_S_STRUCT = [\r\n    {\r\n      name: 'testStore',\r\n      optionalParameters: {\r\n        keyPath: 'id'\r\n      },\r\n      indexes: [\r\n        {\r\n          name: 'storeName',\r\n          keyPath: 'storeName',\r\n          options: {\r\n            unique: false\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  private _db: IDBDatabase;\r\n  private objectStoreStructs: Array<IndexedDBStruct>;\r\n\r\n  private constructor(dbName: string = 'testDB',\r\n                      objectStoreStructs: Array<IndexedDBStruct> = IndexedDB.O_S_STRUCT,\r\n                      subscriber: Subscriber<IndexedDB>\r\n  ) {\r\n    this.objectStoreStructs = objectStoreStructs;\r\n\r\n    const request = window.indexedDB.open(dbName);\r\n    request.onerror = (event: Event) => {\r\n      alert('Database error: ' + (<IDBOpenDBRequest> event.target).error);\r\n    };\r\n\r\n    request.onsuccess  = (event: Event): any => {\r\n      console.log(`IndexedDB open success`);\r\n      this._db = request.result;\r\n      subscriber.next(this);\r\n    };\r\n\r\n    /**\r\n     * use to initial database\r\n     * @param event\r\n     */\r\n    request.onupgradeneeded = (event: IDBVersionChangeEvent) => {\r\n      console.log(`IndexedDB upgrade need`);\r\n      this._db = request.result;\r\n\r\n      this.objectStoreStructs.forEach(store => {\r\n        const objectStore: IDBObjectStore = this._db.createObjectStore(store.name, store.optionalParameters);\r\n        if (store.indexes) {\r\n          store.indexes.forEach(index => {\r\n            objectStore.createIndex(\r\n              index.name,\r\n              index.keyPath || index.name,\r\n              index.options);\r\n          });\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  static instenceof(dbName: string = 'testDB',\r\n                    objectStoreStructs: Array<IndexedDBStruct> = IndexedDB.O_S_STRUCT\r\n  ): Observable<IndexedDB> {\r\n    return new Observable(subscriber => {\r\n      const indexedDB = new IndexedDB(dbName, objectStoreStructs, subscriber);\r\n    });\r\n  }\r\n  /**\r\n   * get object store specify name and mode\r\n   * @param storeName\r\n   * @param mode\r\n   */\r\n  getObjectStore(storeName: string, mode: IDBTransactionMode): IndexedDBStore {\r\n    return new IndexedDBStore(this._db.transaction(storeName, mode).objectStore(storeName));\r\n  }\r\n}\r\n\r\nexport class IndexedDBStore {\r\n  /**\r\n   * IndexedDB ObjectStore represent a object store (like table in sql database)\r\n   */\r\n  objectStore: IDBObjectStore;\r\n\r\n  constructor(objectStore: IDBObjectStore) {\r\n    this.objectStore = objectStore;\r\n  }\r\n\r\n  add<T>(data: T): Observable<IndexedDBEvent<IDBValidKey>> {\r\n    return new Observable<IndexedDBEvent<IDBValidKey>>((subscriber: Subscriber<IndexedDBEvent<IDBValidKey>>) => {\r\n      const request: IDBRequest<IDBValidKey> = this.objectStore.add(data);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * return Observable object send IndexedDBEvent multiple time\r\n   * @param data - add to store object array\r\n   */\r\n  addAll<T>(data: T[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const addObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = data.map(\r\n      (item: T): Observable<IndexedDBEvent<IDBValidKey>> => this.add(item));\r\n    return this._concat_scan<IDBValidKey>(...addObservables);\r\n  }\r\n\r\n  /**\r\n   * return Observable object send IndexedDBEvent\r\n   * if IndexedDBEvent.type is IndexedDBEventType.SUCCESS then get data from IndexedDBEvent.data\r\n   * @param key\r\n   */\r\n  getById<T>(key: IDBValidKey): Observable<IndexedDBEvent<T>> {\r\n    return new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<T> = this.objectStore.get(key);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å¼å®¹ie11-10, ie10ä¸æ¯æIndexedDB.getAll()æ¹æ³, ç¨openCursoræ¿ä»£\r\n   * [IndexedDB.IDBObjectStore]{@link https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore}\r\n   */\r\n  getAll<T>(): Observable<IndexedDBEvent<Array<T>>> {\r\n    const observable = new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<IDBCursorWithValue> = this.objectStore.openCursor();\r\n\r\n      request.onsuccess = (event: Event) => {\r\n        const cursor = request.result;\r\n        if (cursor) {\r\n          subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, cursor.value));\r\n          cursor.continue();\r\n        } else {\r\n          subscriber.complete();\r\n        }\r\n      };\r\n      request.onerror = (event: Event) => {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n        subscriber.complete();\r\n      };\r\n      // this.initRequest<Array<T>>(request, subscriber);\r\n    });\r\n    return this.getCount()\r\n      .pipe(\r\n        mergeMap((value: IndexedDBEvent<number>) => this._from_scan(observable, value.data))\r\n      );\r\n  }\r\n  /**\r\n   * return Observable object will send IndexedDBEvent multiple time\r\n   * will add T to IndexedDBEvent.data every time\r\n   * @param keys - ids\r\n   */\r\n  getAllById<T>(...keys: Array<IDBValidKey>): Observable<IndexedDBEvent<Array<T>>> {\r\n    const getObservables: Array<Observable<IndexedDBEvent<T>>> = keys.map(\r\n      (item: IDBValidKey): Observable<IndexedDBEvent<T>> => this.getById(item));\r\n    return this._concat_scan(...getObservables);\r\n  }\r\n\r\n  /**\r\n   * like getAllById but parameter type is IDBIndex\r\n   * @param indexName - index name\r\n   */\r\n  getAllByIndex<T>(indexName: string): Observable<IndexedDBEvent<Array<T>>> {\r\n    const index = this.objectStore.index(indexName);\r\n    const observable = new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<IDBCursorWithValue> = index.openCursor();\r\n      request.onsuccess = (event: Event) => {\r\n        const cursor: IDBCursorWithValue = request.result;\r\n        if (cursor) {\r\n          subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, <T> cursor.value));\r\n          cursor.continue();\r\n        } else {\r\n          subscriber.complete();\r\n        }\r\n      };\r\n      request.onerror = (event: Event) => {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n        subscriber.complete();\r\n      };\r\n    });\r\n\r\n    return this.getCount(index)\r\n      .pipe(\r\n        mergeMap((value: IndexedDBEvent<number>) => this._from_scan(observable, value.data))\r\n      );\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent\r\n   * if success IndexedDBEvent.data is updated object primary key\r\n   * @param data\r\n   */\r\n  update<T>(data: T): Observable<IndexedDBEvent<IDBValidKey>> {\r\n    return new Observable<IndexedDBEvent<IDBValidKey>>((subscriber: Subscriber<IndexedDBEvent<IDBValidKey>>) => {\r\n      const request: IDBRequest<IDBValidKey> = this.objectStore.put(data);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent multiple time\r\n   * every time will add success updated object primary key to IndexedDBEvent.data\r\n   * @param data\r\n   */\r\n  updateAll<T>(data: T[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const updateObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = data.map(\r\n      (item: T): Observable<IndexedDBEvent<IDBValidKey>> => this.update(item));\r\n    return this._concat_scan<IDBValidKey>(...updateObservables);\r\n  }\r\n\r\n  /**\r\n   * delete\r\n   * if success return IndexedDBEvent.data type is undefined\r\n   * @param key\r\n   */\r\n  delete(key: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<undefined>> {\r\n    return new Observable<IndexedDBEvent<undefined>>((subscriber: Subscriber<IndexedDBEvent<undefined>>) => {\r\n      const request: IDBRequest<undefined> = this.objectStore.delete(key);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  deleteAll(...keys: (IDBValidKey | IDBKeyRange)[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const deleteObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = keys.map(\r\n      (item: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<IDBValidKey>> => this.delete(item));\r\n    return this._concat_scan<IDBValidKey>(...deleteObservables);\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent, IndexedDBEvent.data is IDBObjectStore or IDBIndex contain element's count\r\n   * @param object\r\n   * @param key\r\n   */\r\n  getCount(object?: IDBIndex, key?: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<number>> {\r\n    return new Observable((subscriber: Subscriber<IndexedDBEvent<number>>) => {\r\n      const request: IDBRequest<number> = object === undefined ? this.objectStore.count() : object.count();\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  private initRequest<T>(request: IDBRequest<T>, subscriber: Subscriber<IndexedDBEvent<T | DOMException>>): void {\r\n    request.onsuccess = () => {\r\n      if (request.result !== undefined) {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, request.result));\r\n      } else {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n      }\r\n      subscriber.complete();\r\n    };\r\n    // requeståºéè¿åéè¯¯ä¿¡æ¯\r\n    request.onerror = (event: Event) => {\r\n      subscriber.next(new IndexedDBEvent<DOMException>(IndexedDBEventType.ERROR, 0, 0, request.error));\r\n      subscriber.complete();\r\n    };\r\n  }\r\n\r\n  /**\r\n   * create observable use rxjs from function then use scan operator\r\n   * return custom event(IndexedDBEvent)\r\n   * @param observable\r\n   * @param total\r\n   */\r\n  private _from_scan<T>(observable: Observable<IndexedDBEvent<T>>, total: number): Observable<IndexedDBEvent<Array<T>>> {\r\n    return observable\r\n      .pipe(\r\n        scan<IndexedDBEvent<T>, IndexedDBEvent<Array<T>>>(\r\n          (acc: IndexedDBEvent<Array<T>>, value: IndexedDBEvent<T>): IndexedDBEvent<Array<T>> => {\r\n            if (value.type !== IndexedDBEventType.ERROR) {\r\n              acc.loaded++;\r\n              acc.data.push(value.data);\r\n              if (acc.loaded === acc.total) { acc.type = IndexedDBEventType.COMPLETE; }\r\n            } else {\r\n              acc.type = IndexedDBEventType.ERROR;\r\n              acc.loaded = 0;\r\n            }\r\n            return acc;\r\n          },\r\n          new IndexedDBEvent<Array<T>>(IndexedDBEventType.PENDING, 0, total, new Array<T>()))\r\n      );\r\n  }\r\n\r\n  /**\r\n   * connect observable use rxjs concat function(not Operator) then use scan operator\r\n   * return custom event(event: IndexedDBEvent)\r\n   * @param observables\r\n   */\r\n  private _concat_scan<T>(...observables: Array<Observable<IndexedDBEvent<T>>>): Observable<IndexedDBEvent<Array<T>>> {\r\n    const total = observables.length;\r\n    return concat(...observables)\r\n      .pipe(\r\n        scan<IndexedDBEvent<T>, IndexedDBEvent<Array<T>>>(\r\n          (acc: IndexedDBEvent<Array<T>>, value: IndexedDBEvent<T>): IndexedDBEvent<Array<T>> => {\r\n            if (value.type !== IndexedDBEventType.ERROR) {\r\n              acc.loaded++;\r\n              acc.data.push(value.data);\r\n              if (acc.loaded === acc.total) { acc.type = IndexedDBEventType.COMPLETE; }\r\n            } else {\r\n              acc.type = IndexedDBEventType.ERROR;\r\n              acc.loaded = 0;\r\n            }\r\n            return acc;\r\n          },\r\n          new IndexedDBEvent<Array<T>>(IndexedDBEventType.PENDING, 0, total, new Array<T>()))\r\n      );\r\n  }\r\n}\r\n\r\nexport interface IndexedDBStruct {\r\n  name: string;\r\n  optionalParameters: IDBObjectStoreParameters;\r\n  indexes: Array<{\r\n    name: string,\r\n    keyPath?: string,\r\n    options: IDBIndexParameters\r\n  }>;\r\n}\r\n/**\r\n * IndexedDB function return value\r\n * use to flag IndexedDB event status and loaded status\r\n */\r\nexport class IndexedDBEvent<T> {\r\n  type: IndexedDBEventType;\r\n  loaded: number;\r\n  total: number;\r\n  data: T;\r\n\r\n  constructor(type: IndexedDBEventType, loaded: number, total: number, data?: T) {\r\n    this.type = type;\r\n    this.loaded = loaded;\r\n    this.total = total;\r\n    this.data = data === undefined ? undefined : data;\r\n  }\r\n}\r\n\r\nexport enum IndexedDBEventType {\r\n  PENDING = 'Pending',\r\n  SUCCESS = 'Success',\r\n  ERROR = 'Error',\r\n  COMPLETE = 'Complete'\r\n}\r\n","import {Component, ElementRef, OnInit, Renderer2, ViewChild} from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {IndexedDB, IndexedDBStore, IndexedDBStruct} from '../core/indexedDB/indexedDB';\r\n\r\n@Component({\r\n  selector: 'nb-file-browser',\r\n  templateUrl: './file-browser.component.html',\r\n  styleUrls: [\r\n    './file-browser.component.css'\r\n  ]\r\n})\r\nexport class FileBrowserComponent implements OnInit {\r\n\r\n  @ViewChild('fileList', { read: ElementRef }) fileList: ElementRef;\r\n\r\n  private inputArea: HTMLElement;\r\n  private indexedDBStructs: Array<IndexedDBStruct> = [\r\n    {\r\n      name: 'markdown_article',\r\n      optionalParameters: {\r\n        keyPath: 'id',\r\n        autoIncrement: true\r\n      },\r\n      indexes: [\r\n        {\r\n          name: 'title',\r\n          keyPath: 'title',\r\n          options: {\r\n            unique: false\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n  private indexedDB: IndexedDB;\r\n  private selectedArticles: { [key: string]: {el: Element, data: Article} };\r\n  private fileListArea: Element;\r\n  private isConnect: boolean;\r\n  articles: Array<Article>;\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService,\r\n              private renderer: Renderer2\r\n  ) {\r\n    const inputAreaLi: HTMLElement = renderer.createElement('LI');\r\n    this.renderer.addClass(inputAreaLi, 'fb-li');\r\n    this.renderer.addClass(inputAreaLi, 'fb-li_create');\r\n    // inputAreaLi.classList.add('fb-li', 'fb-li_create');\r\n    const inputAreaI: HTMLElement = renderer.createElement('I');\r\n    this.renderer.addClass(inputAreaI, 'material-icons');\r\n    this.renderer.addClass(inputAreaI, 'md-18');\r\n    this.renderer.addClass(inputAreaI, 'md-dark');\r\n    // inputAreaI.classList.add('material-icons', 'md-18', 'md-dark');\r\n    this.renderer.appendChild(inputAreaI, this.renderer.createText('edit'));\r\n    const inputAreaInput: HTMLElement = renderer.createElement('INPUT');\r\n    this.renderer.addClass(inputAreaInput, 'fb-li_create-input');\r\n    // inputAreaDiv.classList.add('fb-li_create-input');\r\n    this.renderer.setAttribute(inputAreaInput, 'contenteditable', 'true');\r\n    this.renderer.appendChild(inputAreaLi, inputAreaI);\r\n    this.renderer.appendChild(inputAreaLi, inputAreaInput);\r\n\r\n    this.inputArea = inputAreaLi;\r\n    /*tslint:disable-next-line*/\r\n    this.isConnect = false;\r\n    this.selectedArticles = {};\r\n  }\r\n\r\n  ngOnInit() {\r\n    IndexedDB.instenceof('ngr2-markdown-db', this.indexedDBStructs)\r\n      .subscribe(db => {\r\n        this.indexedDB = db;\r\n        this.isConnect = true;\r\n\r\n        this.refreshArticles();\r\n      });\r\n    this.fileListArea = this.fileList.nativeElement;\r\n  }\r\n\r\n  createFile(): void {\r\n    const cloneEl = this.inputArea.cloneNode(true);\r\n    this.renderer.listen(cloneEl, 'keyup', (ev: KeyboardEvent) => {\r\n      switch (ev.code) {\r\n        case 'Enter':\r\n          this.indexedDB\r\n            .getObjectStore('markdown_article', 'readwrite')\r\n            .add(new Article('ce', (<HTMLInputElement> ev.target).value))\r\n            .subscribe(value => {\r\n              this.refreshArticles();\r\n              this.renderer.removeChild(this.fileListArea, cloneEl);\r\n            });\r\n      }\r\n    });\r\n    this.renderer.appendChild(this.fileListArea, cloneEl);\r\n  }\r\n\r\n  createFolder(): void {\r\n    console.log('createFolder');\r\n  }\r\n\r\n  rename(): void {\r\n    const cloneEl = this.inputArea.cloneNode(true);\r\n    const id = Object.getOwnPropertyNames(this.selectedArticles)[0];\r\n    const selected = this.selectedArticles[id];\r\n    this.renderer.listen(cloneEl, 'keyup', (ev: KeyboardEvent) => {\r\n      switch (ev.code) {\r\n        case 'Enter':\r\n          selected.data.title = (<HTMLInputElement> ev.target).value;\r\n          this.indexedDB\r\n            .getObjectStore('markdown_article', 'readwrite')\r\n            .update(selected.data)\r\n            .subscribe(value => {\r\n              this.refreshArticles();\r\n              this.renderer.removeChild(this.fileListArea, cloneEl);\r\n              this.selectedArticles[id] = null;\r\n            });\r\n      }\r\n    });\r\n    this.fileListArea.replaceChild(cloneEl, selected.el);\r\n    (<HTMLElement> cloneEl.lastChild).focus();\r\n  }\r\n\r\n  delete(): void {\r\n    this.indexedDB.getObjectStore('markdown_article', 'readwrite')\r\n      .deleteAll(\r\n        ...Object.getOwnPropertyNames(this.selectedArticles)\r\n          .map(value => this.selectedArticles[Number.parseInt(value, 10)].data.id)\r\n      )\r\n      .subscribe(value => this.refreshArticles());\r\n  }\r\n\r\n  close(): void {\r\n    console.log('close');\r\n  }\r\n\r\n  select(el: HTMLElement, article: Article): void {\r\n    console.log('select');\r\n    if (!this.selectedArticles[article.id.toString(10)]) {\r\n      this.selectedArticles[article.id.toString(10)] = {el, data: article};\r\n      el.classList.add('fb-li_selected');\r\n    } else {\r\n      this.selectedArticles[article.id.toString(10)] = null;\r\n      el.classList.remove('fb-li_selected');\r\n    }\r\n  }\r\n\r\n  open(el: HTMLElement, article: Article): void {\r\n    console.log('open');\r\n    this.markdownService.reinitialization(article.content);\r\n  }\r\n\r\n  private refreshArticles(): void {\r\n    this.indexedDB.getObjectStore('markdown_article', 'readwrite')\r\n      .getAll<Article>()\r\n      .subscribe(value => {\r\n        this.articles = value.data;\r\n      });\r\n  }\r\n}\r\n\r\nclass Article {\r\n  static AUTHOR   = 'Author';\r\n  static TITLE    = 'Default Title';\r\n  static CONTENT  = '# Default Title';\r\n\r\n  id: number;\r\n  author: string;\r\n  title: string;\r\n  content: string;\r\n  createTime: Date;\r\n  lastModifiedTime: Date;\r\n\r\n  constructor(author: string  = Article.AUTHOR,\r\n              title: string   = Article.TITLE,\r\n              content: string = Article.CONTENT\r\n  ) {\r\n    this.author           = author;\r\n    this.title            = title;\r\n    this.content          = content;\r\n    this.createTime       = new Date();\r\n    this.lastModifiedTime = this.createTime;\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'nb-status-bar',\r\n  templateUrl: './status-bar.component.html',\r\n  styleUrls: ['./status-bar.component.css']\r\n})\r\nexport class StatusBarComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'nb-control-bar',\r\n  templateUrl: './control-bar.component.html',\r\n  styleUrls: ['./control-bar.component.css']\r\n})\r\nexport class ControlBarComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'nb-menu',\r\n  templateUrl: './menu.component.html',\r\n  styleUrls: ['./menu.component.css']\r\n})\r\nexport class MenuComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import {fromEvent, merge, Observable} from 'rxjs';\r\nimport {filter, map, tap, throttleTime} from 'rxjs/operators';\r\n\r\nexport enum DragAndDropEventType {\r\n  DRAG_START = 'dragstart',\r\n  DRAG = 'drag',\r\n  DRAG_END = 'dragend',\r\n  DRAG_ENTER = 'dragenter',\r\n  DRAG_OVER = 'dragover',\r\n  DRAG_LEAVE = 'dragleave',\r\n  DROP = 'drop'\r\n}\r\n\r\nexport interface DragAndDropEventOptions {\r\n  eventType: DragAndDropEventType;\r\n  listener?: (event: DragEvent) => void | boolean;\r\n  preventDefault?: boolean;\r\n  stopPropagation?: boolean;\r\n  operatorOptions?: {\r\n    throttleTime?: number,\r\n    filter?: (event: DragEvent) => boolean\r\n  };\r\n  eventOptions?: EventListenerOptions;\r\n}\r\n\r\n// @dynamic\r\nexport class DragAndDropEvent {\r\n\r\n  /* tslint:disable */\r\n  static defaultFun = event => { console.group('on ' + event.type); console.groupEnd(); };\r\n  static ALL_OPTIONS: { [key: string]: DragAndDropEventOptions } = {\r\n    'dragstart': {\r\n      eventType: DragAndDropEventType.DRAG_START,\r\n      listener: DragAndDropEvent.defaultFun\r\n    },\r\n    'drag': {\r\n      eventType: DragAndDropEventType.DRAG,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      operatorOptions: {\r\n        throttleTime: 1000\r\n      }\r\n    },\r\n    'dragend': {\r\n      eventType: DragAndDropEventType.DRAG_END,\r\n      listener: DragAndDropEvent.defaultFun,\r\n    },\r\n    'dragenter': {\r\n      eventType: DragAndDropEventType.DRAG_ENTER,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      preventDefault: true\r\n    },\r\n    'dragover': {\r\n      eventType: DragAndDropEventType.DRAG_OVER,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      operatorOptions: {\r\n        throttleTime: 100\r\n      },\r\n      preventDefault: true\r\n    },\r\n    'drop': {\r\n      eventType: DragAndDropEventType.DROP,\r\n      listener: DragAndDropEvent.defaultFun\r\n    }\r\n  };\r\n\r\n  el: Element;\r\n  observable: Observable<DragEvent>;\r\n  options: { [key: string]: DragAndDropEventOptions };\r\n  /*tslint:enable*/\r\n\r\n  // listeners: { [key: string]: (event: DragEvent) => void | boolean };\r\n  // ondragstart:  (event: DragEvent) => void | boolean;\r\n  // ondrag:       (event: DragEvent) => void | boolean;\r\n  // ondragend:    (event: DragEvent) => void | boolean;\r\n  // ondragenter:  (event: DragEvent) => void | boolean;\r\n  // ondragover:   (event: DragEvent) => void | boolean;\r\n  // ondragleave:  (event: DragEvent) => void | boolean;\r\n  // ondrop:       (event: DragEvent) => void | boolean;\r\n\r\n  constructor(el: Element,\r\n              eventOptions: { [key: string]: DragAndDropEventOptions } = DragAndDropEvent.ALL_OPTIONS,\r\n              interceptor?: (event: DragEvent) => boolean\r\n  ) {\r\n    this.el       = el;\r\n    this.options  = eventOptions;\r\n\r\n    this.observable = this.initEvent(interceptor);\r\n  }\r\n\r\n  private initEvent(interceptor?: (event: DragEvent) => boolean): Observable<DragEvent> {\r\n    const observables = Object.getOwnPropertyNames(this.options)\r\n      .reduce<Array<Observable<DragEvent>>>((previousValue, currentValue) => {\r\n        const option = this.options[currentValue];\r\n\r\n        let eventObservable = this.addEventListener(this.el, option);\r\n\r\n        eventObservable = this.addListenFunction(eventObservable, option);\r\n\r\n        previousValue.push(eventObservable);\r\n\r\n        return previousValue;\r\n      }, []);\r\n\r\n    return merge(...observables);\r\n  }\r\n\r\n  private addEventListener(el: Element,\r\n                           option: DragAndDropEventOptions,\r\n                           resultSelector: ((...args: any[]) => any) = (args => args)\r\n  ): Observable<DragEvent> {\r\n    let observable = fromEvent(el, option.eventType, option.eventOptions, resultSelector);\r\n\r\n    observable = this.eventOptions(observable, option);\r\n    observable = this.streamOperator(observable, option);\r\n\r\n    return observable;\r\n  }\r\n\r\n  private addListenFunction(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    if (!option.listener) {\r\n      return observable;\r\n    }\r\n    return observable.pipe(\r\n      tap(option.listener)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®optionè®¾ç½®Eventå¯¹è±¡ä¸çæ¹æ³æå±æ§\r\n   * @param observable\r\n   * @param option\r\n   */\r\n  private eventOptions(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    return observable\r\n      .pipe(\r\n        map((event: DragEvent) => {\r\n          if (option.preventDefault) { event.preventDefault(); }\r\n          if (option.stopPropagation) { event.stopPropagation(); event.cancelBubble = true; }\r\n          return event;\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®optionå¯¹äºä»¶æµè¿è¡optionä¸­è®¾ç½®æä½\r\n   * @param observable\r\n   * @param option\r\n   */\r\n  private streamOperator(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    if (!option.operatorOptions) { return observable; }\r\n    const operator = option.operatorOptions;\r\n\r\n    if (operator.throttleTime && operator.throttleTime > 0) {\r\n      observable = observable\r\n        .pipe(throttleTime(operator.throttleTime));\r\n    }\r\n    if (operator.filter) {\r\n      observable = observable\r\n        .pipe(filter(operator.filter));\r\n    }\r\n\r\n    return observable;\r\n  }\r\n}\r\n","import {DragAndDropContainer} from './dragAndDropContainer';\r\nimport {DragAndDropEvent, DragAndDropEventType} from './dragAndDropEvent';\r\n\r\nexport class DragAndDropElement {\r\n\r\n  static ELEMENT_STYLE: CSSStyle = {\r\n    // cursor: 'grab'\r\n  };\r\n  static DEMO_STYLE: CSSStyle = {\r\n    opacity: '0.5'\r\n  };\r\n\r\n  // å³ä¸, å·¦ä¸, å·¦ä¸, å³ä¸åå«å¯¹åºçè§åº¦å¼\r\n  diagonal: {\r\n    RT_ANGLE,\r\n    LT_ANGLE,\r\n    LB_ANGLE,\r\n    RB_ANGLE\r\n  } = {\r\n    RT_ANGLE: Math.PI / 4,\r\n    LT_ANGLE: Math.PI / 4 * 3,\r\n    LB_ANGLE: Math.PI / 4 * 3 * -1,\r\n    RB_ANGLE: Math.PI / 4 * -1\r\n  };\r\n\r\n  private _el: HTMLElement;\r\n  private _parent: HTMLElement;\r\n  private _dadEvent: DragAndDropEvent;\r\n  parentContainer: DragAndDropContainer;\r\n  status: DragAndDropStatus;\r\n  clone: HTMLElement;\r\n  centerPoint: Point;\r\n  get clientRect(): ClientRect | DOMRect {\r\n    return this._el.getBoundingClientRect();\r\n  }\r\n\r\n  constructor (element: HTMLElement,\r\n               parentContainer: DragAndDropContainer,\r\n               elementStyle: CSSStyle = DragAndDropElement.ELEMENT_STYLE,\r\n               demoStyle: CSSStyle = DragAndDropElement.DEMO_STYLE,\r\n  ) {\r\n    this._el =                element               || null;\r\n    this.parentContainer =    parentContainer       || null;\r\n\r\n    this._parent  = this._el && this._el.parentElement                          || null;\r\n    this.clone    = this._el && (<HTMLElement> this._el.cloneNode(true))  || null;\r\n    Object.getOwnPropertyNames(elementStyle)\r\n      .forEach(value => {\r\n        this._el.style[value] = elementStyle[value];\r\n      });\r\n    Object.getOwnPropertyNames(demoStyle)\r\n      .forEach(value => {\r\n        this.clone.style[value] = demoStyle[value];\r\n      });\r\n\r\n    // set draggable property\r\n    this._el.draggable = true;\r\n    // add drag and drop event handler\r\n    this._dadEvent = new DragAndDropEvent(this._el,\r\n      {\r\n        'dragstart': {\r\n          eventType: DragAndDropEventType.DRAG_START,\r\n          stopPropagation: true,\r\n          listener: this.ondragstart.bind(this)\r\n        },\r\n        'drag': {\r\n          eventType: DragAndDropEventType.DRAG,\r\n          stopPropagation: true,\r\n          listener: this.ondrag.bind(this),\r\n          operatorOptions: {\r\n            throttleTime: 1000\r\n          }\r\n        },\r\n        'dragend': {\r\n          eventType: DragAndDropEventType.DRAG_END,\r\n          stopPropagation: true,\r\n          listener: this.ondragend.bind(this),\r\n        },\r\n        'dragenter': {\r\n          eventType: DragAndDropEventType.DRAG_ENTER,\r\n          listener: this.ondragenter.bind(this),\r\n          preventDefault: true,\r\n          operatorOptions: {\r\n            filter: (event) => {\r\n              if (!this.parentContainer.equals(event)) {\r\n                return false;\r\n              }\r\n              return this._el !== this.parentContainer.getDragElement()._el && this._el === event.target;\r\n            }\r\n          }\r\n        },\r\n        'dragover': {\r\n          eventType: DragAndDropEventType.DRAG_OVER,\r\n          listener: this.ondragover.bind(this),\r\n          operatorOptions: {\r\n            throttleTime: 100,\r\n            filter: (event) => {\r\n              if (!this.parentContainer.equals(event)) {\r\n                return false;\r\n              }\r\n              return this._el !== this.parentContainer.getDragElement()._el;\r\n            }\r\n          },\r\n          preventDefault: true\r\n        },\r\n        'drop': {\r\n          eventType: DragAndDropEventType.DROP,\r\n          stopPropagation: true,\r\n          listener: this.ondrop.bind(this)\r\n        }\r\n      });\r\n    this._dadEvent.observable\r\n      .subscribe(value => {});\r\n\r\n    // initial\r\n    this.status = 'none';\r\n    const rect = this.clientRect;\r\n    this.centerPoint = new Point((rect.left + rect.width / 2),\r\n      (rect.top + rect.height / 2));\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   */\r\n  reset(): void {\r\n    this.transitDemonstrationFinish(this.parentContainer.getDragElement());\r\n  }\r\n\r\n  /**\r\n   * drag start\r\n   * ç¨æ·å¼å§æå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragstart(ev: DragEvent) {\r\n    console.group('on drop start');\r\n    this.status = 'drag';\r\n    this.parentContainer.setDragElement(this, ev);\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag\r\n   * ç¨æ·æ­£å¨æå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondrag(ev: DragEvent) {\r\n    console.group('on drag');\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag end\r\n   * ç¨æ·ç»ææå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragend(ev: DragEvent) {\r\n    console.group('on drag end');\r\n    this.status = 'none';\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag enter\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , è¿å¥æ¬åç´ çå®¹å¨èå´æ¶è§¦å\r\n   * [ç®æ æ¾ç½®è¯´æ]{@link https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API/Drag_operations#droptargets}\r\n   * @param ev - emit event\r\n   */\r\n  private ondragenter(ev: DragEvent) {\r\n    if (!(this.parentContainer.getDragElement()._parent === this._parent && this._el === ev.target)) { return; }\r\n    if (this._el === this.parentContainer.getDragElement()._el) { return; }\r\n    console.group('on drag enter');\r\n    this.status = 'drop';\r\n    this.parentContainer.setDropElement(this);\r\n    const rect = this.clientRect;\r\n    this.diagonal.RT_ANGLE = Math.atan2(rect.height / 2, rect.width / 2);\r\n    this.diagonal.LT_ANGLE = Math.PI - this.diagonal.RT_ANGLE;\r\n    this.diagonal.LB_ANGLE = -this.diagonal.LT_ANGLE;\r\n    this.diagonal.RB_ANGLE = -this.diagonal.RT_ANGLE;\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag over\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , å¨æ¬åç´ çå®¹å¨èå´åæ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragover(ev: DragEvent) {\r\n    console.group('on drag over');\r\n    this.transitDemonstration(this.parentContainer.getDragElement(), new Point(ev.clientX, ev.clientY));\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * drag leave\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , ç¦»å¼æ¬åç´ çå®¹å¨èå´æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragleave(ev: DragEvent) {\r\n    console.group('on drag leave');\r\n    this.status = 'none';\r\n    this.transitDemonstrationFinish(this.parentContainer.getDragElement());\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag exit\r\n   * å½æ¬åç´ åå¾ä¸åå¯æå¨æ¶è§¦å\r\n   * @deprecated\r\n   * [æªè¢«ä»»ä½æµè§å¨å®ç°]{@link https://developer.mozilla.org/zh-CN/docs/Web/API/Document/dragexit_event}\r\n   * @param ev - emit event\r\n   */\r\n  private ondragexit(ev: DragEvent) {\r\n    console.group('on drag exit');\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drop\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , å¨æ¬åç´ çå®¹å¨èå´åéæ¾é¼ æ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondrop(ev: DragEvent) {\r\n    console.group('on drop');\r\n    this.status = 'drop';\r\n    this.replaceElement(this.parentContainer.getDragElement()._el, this.parentContainer.getDragElement().clone);\r\n    console.groupEnd();\r\n  }\r\n\r\n  private insertBefore(el: Element): Element {\r\n    return this._parent.insertBefore(el, this._el);\r\n  }\r\n\r\n  /**\r\n   * `nextElementSibling`: ie8,ie9,safariä¸å¼å®¹\r\n   * è§: https://developer.mozilla.org/en-US/docs/Web/API/NonDocumentTypeChildNode/nextElementSibling\r\n   * @param el - insert element\r\n   * @return - return inserted element\r\n   */\r\n  private insertAfter(el: Element): Element {\r\n    if (!this._el.nextElementSibling) {\r\n      return this._parent.appendChild(el);\r\n    }\r\n    return this._parent.insertBefore(el, this._el.nextElementSibling);\r\n  }\r\n\r\n  private computeDirection(point: Point): DragAndDropDirection {\r\n    this.centerPoint = new Point((this.clientRect.left + this.clientRect.width / 2),\r\n      (this.clientRect.top + this.clientRect.height / 2));\r\n    point.relaitiveTo(this.centerPoint);\r\n    const angle = Math.atan2(point.Y, point.X);\r\n    if (angle >= this.diagonal.RT_ANGLE && angle < this.diagonal.LT_ANGLE) {\r\n      return 'top';\r\n    } else if (angle >= this.diagonal.LT_ANGLE || angle < this.diagonal.LB_ANGLE) {\r\n      return 'left';\r\n    } else if (angle >= this.diagonal.LB_ANGLE && angle < this.diagonal.RB_ANGLE) {\r\n      return 'bottom';\r\n    } else {\r\n      return 'right';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ¼ç¤ºé¼ æ æå¨åç´ éæ¾åçç¶æ\r\n   */\r\n  private transitDemonstration(draggedEl: DragAndDropElement, point: Point) {\r\n    const dir = this.computeDirection(point);\r\n    if ( dir === 'top' || dir === 'left') {\r\n      this.insertBefore(draggedEl._el);\r\n    } else if (dir === 'bottom' || dir === 'right') {\r\n      this.insertAfter(draggedEl._el);\r\n    }\r\n    console.log(dir);\r\n  }\r\n\r\n  /**\r\n   * æ¼ç¤ºç»æ, ç§»é¤åç´ \r\n   */\r\n  private transitDemonstrationFinish(dragElement: DragAndDropElement) {\r\n    this.removeElement(dragElement._el);\r\n  }\r\n\r\n  private removeElement(el: Element): Element {\r\n    for (let i = 0; i < this._parent.children.length; i++) {\r\n      if (this._parent.children[i] === el) {\r\n        this._parent.removeChild(el);\r\n        return el;\r\n      }\r\n    }\r\n  }\r\n\r\n  private replaceElement(newEl: Element, oldEl: Element): Element {\r\n    for (let i = 0; i < this._parent.children.length; i++) {\r\n      if (this._parent.children[i] === oldEl) {\r\n        this._parent.replaceChild(newEl, oldEl);\r\n        return oldEl;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass Point {\r\n  X: number;\r\n  Y: number;\r\n\r\n  constructor(X: number,\r\n              Y: number\r\n  ) {\r\n    this.X = X || null;\r\n    this.Y = Y || null;\r\n  }\r\n\r\n  relaitiveTo(relato: Point) {\r\n    this.X -= relato.X;\r\n    this.Y = relato.Y - this.Y;\r\n  }\r\n}\r\n\r\ntype DragAndDropStatus = 'none' | 'drag' | 'dragOver' | 'drop';\r\ntype DragAndDropDirection = 'top' | 'bottom' | 'left' | 'right' | 'center';\r\ntype CSSStyle = {\r\n  [P in keyof CSSStyleDeclaration]?: CSSStyleDeclaration[P];\r\n};\r\n","import {DragAndDropElement} from './dragAndDrop';\r\nimport {DragAndDropEvent, DragAndDropEventType} from './dragAndDropEvent';\r\nimport {assertNumber} from '@angular/core/src/render3/assert';\r\n\r\nexport class DragAndDropContainer {\r\n\r\n  private _el: HTMLElement;\r\n  private _children: HTMLCollection;\r\n  private _dragEl: DragAndDropElement;\r\n  private _dropEl: DragAndDropElement;\r\n  private _dadEvent: DragAndDropEvent;\r\n  private id: number;\r\n  DADChildren: Array<DragAndDropElement>;\r\n\r\n  constructor(element: HTMLElement\r\n  ) {\r\n    this._el =        element           || null;\r\n    this._children =  element.children  || null;\r\n\r\n    this.DADChildren = [];\r\n    for (let i = 0; i < this._children.length; i++) {\r\n      const el = new DragAndDropElement(\r\n        (<HTMLElement> this._children[i]),\r\n        this\r\n      );\r\n      this.DADChildren.push(el);\r\n    }\r\n  }\r\n\r\n  setDragElement(dragEl: DragAndDropElement, ev: DragEvent): void {\r\n    this._dragEl = dragEl;\r\n    this.id = new Date().getTime();\r\n    ev.dataTransfer.setData('text/containerid:' + this.id.toString(10), this.id.toString(10));\r\n  }\r\n\r\n  getDragElement(): DragAndDropElement {\r\n    return this._dragEl;\r\n  }\r\n\r\n  setDropElement(dropEl: DragAndDropElement): void {\r\n    this._dropEl = dropEl;\r\n  }\r\n\r\n  getDropElement(): DragAndDropElement {\r\n    return this._dropEl;\r\n  }\r\n\r\n  equals(ev: DragEvent): boolean {\r\n    let id = ev.dataTransfer.types[ev.dataTransfer.types.length - 1];\r\n\r\n    if (!id) { return false; }\r\n\r\n    id = id.split(':')[1];\r\n    return this.id === Number.parseInt(id, 10);\r\n  }\r\n}\r\n","import {AfterViewInit, Directive, ElementRef, OnInit} from '@angular/core';\r\nimport {DragAndDropContainer} from './core/dad/dragAndDropContainer';\r\n\r\n@Directive({\r\n  selector: '[nbDragAndDrop]'\r\n})\r\nexport class DragAndDropDirective implements OnInit, AfterViewInit {\r\n\r\n  private DADContainer: DragAndDropContainer;\r\n\r\n  constructor(\r\n    private el: ElementRef\r\n  ) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.DADContainer = new DragAndDropContainer(this.el.nativeElement);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Ngr2MarkdownComponent } from './ngr2-markdown.component';\r\nimport { SideTocComponent } from './side-toc/side-toc.component';\r\nimport { HTMLPipePipe } from './pipe/htmlpipe.pipe';\r\nimport {BrowserModule} from '@angular/platform-browser';\r\nimport { MdPipe } from './pipe/md.pipe';\r\nimport { ToolBarComponent } from './tool-bar/tool-bar.component';\r\nimport { EditBoxComponent } from './edit-box/edit-box.component';\r\nimport { FileBrowserComponent } from './file-browser/file-browser.component';\r\nimport { StatusBarComponent } from './status-bar/status-bar.component';\r\nimport { ControlBarComponent } from './control-bar/control-bar.component';\r\nimport { MenuComponent } from './menu/menu.component';\r\nimport { DragAndDropDirective } from './drag-and-drop.directive';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    Ngr2MarkdownComponent,\r\n    SideTocComponent,\r\n    HTMLPipePipe,\r\n    MdPipe,\r\n    ToolBarComponent,\r\n    EditBoxComponent,\r\n    FileBrowserComponent,\r\n    StatusBarComponent,\r\n    ControlBarComponent,\r\n    MenuComponent,\r\n    DragAndDropDirective\r\n  ],\r\n  imports: [\r\n    BrowserModule\r\n  ],\r\n  exports: [\r\n    Ngr2MarkdownComponent,\r\n    SideTocComponent,\r\n    MdPipe\r\n  ]\r\n})\r\nexport class Ngr2MarkdownModule { }\r\n"]}