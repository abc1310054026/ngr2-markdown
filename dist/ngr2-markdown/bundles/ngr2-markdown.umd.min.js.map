{"version":3,"sources":["ng://ngr2-markdown/lib/core/markdown/markdown.ts","node_modules/tslib/tslib.es6.js","ng://ngr2-markdown/lib/core/fileOperator.ts","ng://ngr2-markdown/lib/utils/textParser.ts","ng://ngr2-markdown/lib/service/ngr2-markdown.service.ts","ng://ngr2-markdown/lib/core/syncScroll.ts","ng://ngr2-markdown/lib/ngr2-markdown.component.ts","ng://ngr2-markdown/lib/side-toc/side-toc.component.ts","ng://ngr2-markdown/lib/pipe/htmlpipe.pipe.ts","ng://ngr2-markdown/lib/pipe/md.pipe.ts","ng://ngr2-markdown/lib/tool-bar/tool-bar.component.ts","ng://ngr2-markdown/lib/core/markdown/markdownMarker.ts","ng://ngr2-markdown/lib/core/markdown/markdwonRenderer.ts","ng://ngr2-markdown/lib/edit-box/edit-box.component.ts","ng://ngr2-markdown/lib/core/indexedDB/indexedDB.ts","ng://ngr2-markdown/lib/core/tree/tree.ts","ng://ngr2-markdown/lib/file-browser/file-browser.component.ts","ng://ngr2-markdown/lib/status-bar/status-bar.component.ts","ng://ngr2-markdown/lib/control-bar/control-bar.component.ts","ng://ngr2-markdown/lib/menu/menu.component.ts","ng://ngr2-markdown/lib/core/dad/dragAndDropEvent.ts","ng://ngr2-markdown/lib/core/dad/dragAndDrop.ts","ng://ngr2-markdown/lib/core/dad/dragAndDropContainer.ts","ng://ngr2-markdown/lib/drag-and-drop.directive.ts","ng://ngr2-markdown/lib/tree/tree-node-directive/tree-node-def.directive.ts","ng://ngr2-markdown/lib/tree/tree/tree.component.ts","ng://ngr2-markdown/lib/tree/tree-node/tree-node.component.ts","ng://ngr2-markdown/lib/tree/tree-node-directive/tree-node-toggle.directive.ts","ng://ngr2-markdown/lib/sync-scroll/sync-scroll.directive.ts","ng://ngr2-markdown/lib/ngr2-markdown.module.ts"],"names":["MarkdownImpl","_this","this","markdownIt","MarkdownIt","highlight","str","lang","hljs.getLanguage","hljs.highlight","value","__","utils","escapeHtml","prototype","render","markdown","options","disable","html","enable","use","fn","md","Observable","subscriber","option","enableRules","Object","keys","filter","disableRules","__read","o","n","m","Symbol","iterator","r","e","i","call","ar","next","done","push","error","__spread","arguments","length","concat","FileOperatorImpl","fileReader","FileReader","toDataURL","fileOrBlob","readAsDataURL","mergeFileReader","toText","encoding","readAsText","toArrayBuffer","readAsArrayBuffer","toDataURLSync","result","window","URL","createObjectURL","revokeDataURLSync","revokeObjectURL","merge","apply","fromEvent","pipe","map","assign","TextParser","parse","text","words","match","WORDS","bytes","lines","charCodeAt","charAt","parseMD","parseHTML","_DIV","innerHTML","textContent","characters","paragraphs","document","createElement","RegExp","Ngr2MarkdownService","originMd","BehaviorSubject","resetMd","renderMd","currentHeading","currentContent","TOCInfo","syncScroll","currentFile","_md","anchor","subscribe","infoList","item","TOCItem","content","indentLevel","root","parent","children","mdText","Markdown","HTML","reinitialization","observerResetMarkdown","updateMarkdown","observeMarkdown","setCurrentHeading","heading","getValue","currentContentToDataUrl","type","file","fileOperator","Blob","observer","core","ruler","state","index","tokens","forEach","token","attrJoin","markup","attrGet","Injectable","args","providedIn","EditorOption","mode","TOC","toolBar","direction","height","themeColor","bodyClassName","MODE","ANCHOR","TOc","TOOL_BAR","DIRECTION","HEIGHT","THEME_COLOR","BODY_CLASS_NAME","instanceOf","Array","SyncScroll","el","suffix","generateIdFun","node","id","_el","generateId","headingsInfo","syncScrollByHeading","headingElType","headingKeys","queryString","join","_update","updateHeadingsInfo","scrollTop","_curHeading","getPairHeading","pairId","headingInfo","reduce","previousValue","currentValue","offsetTop","nodeList","querySelectorAll","curNode","nextNodeOffset","scrollHeight","Ngr2MarkdownComponent","markdownService","defineProperty","_options","ngOnInit","markdownBody","nativeElement","tagName","_html","setTimeout","distinctUntilChanged","Component","selector","template","encapsulation","ViewEncapsulation","None","ViewChild","read","ElementRef","Input","SideTocComponent","HTMLPipePipe","domSanitizer","transform","_i","bypassSecurityTrustHtml","bypassSecurityTrustUrl","Pipe","name","DomSanitizer","MdPipe","ToolBarComponent","MdFileOperator","HTMLFileOperator","titleSubscribe","title","hrefSubscribe","mdHref","htmlHref","ngOnDestroy","unsubscribe","MarkdownMarker","testMarks","headingRegExp","test","MarkType","HEADING","blockQuoteRegExp","BLOCK_QUOTE","listItemRegExp","LIST_ITEM","codeBlockRegExp","CODE_BLOCK","DEFAULT","parseHeading","headingLevel","CODE_INLINE","NOTHING","MarkdownRenderer","renderRange","range","extra","curRange","renderEl","_getRangeEl","curEl","_heading","_default","level","className","_blockQuote","_listItem","_codeBlock","parentElement","offset","startOffset","parEl","appendChild","startContainer","setStart","_codeInline","startEl","nodeType","Node","TEXT_NODE","ELEMENT_NODE","EditBoxComponent","contentChange","Subject","_selection","getRangeAt","console","log","before","_editArea","innerText","after","replace","editAreaRef","focus","getSelection","editWindowRef","marker","renderer","bindMdService","bindMutationObserver","keyUp","event","_range","paste","clipboardData","getData","execCommand","preventDefault","observeText","time","debounceTime","asObservable","MutationObserver","mutations","observe","subtree","childList","characterData","attributes","IndexedDB","dbName","objectStoreStructs","O_S_STRUCT","request","indexedDB","open","onerror","alert","onsuccess","_db","onupgradeneeded","store","objectStore","createObjectStore","optionalParameters","indexes","createIndex","keyPath","instenceof","getObjectStore","storeName","IndexedDBStore","transaction","unique","add","data","initRequest","addAll","addObservables","_concat_scan","getById","key","get","getAll","observable","openCursor","cursor","IndexedDBEvent","IndexedDBEventType","COMPLETE","continue","complete","ERROR","getCount","mergeMap","_from_scan","getAllById","getObservables","getAllByIndex","indexName","update","put","updateAll","updateObservables","delete","deleteAll","deleteObservables","object","undefined","count","total","scan","acc","loaded","PENDING","observables","SUCCESS","Tree","nodes","nodeMap","initMap","rootNode","generateTree","parentId","TreeNode","recursionChildNodes","arr","FileBrowserComponent","indexedDBStructs","autoIncrement","inputAreaLi","addClass","inputAreaI","createText","inputAreaInput","inputArea","db","concatMap","Folder","Article","of","refreshArticles","then","fileTree","lastModifiedTime","createFile","prtId","selectedNode","querySelector","cloneEl","cloneNode","listen","ev","code","removeChild","createFolder","rename","replaceChild","_a","close","select","classList","remove","_save","expanded","treeNode","isExpanded","Promise","resolve","reject","Renderer2","author","AUTHOR","TITLE","CONTENT","createTime","Date","NAME","StatusBarComponent","allinfo","mdInfo","htmlInfo","info","fileInfo","ControlBarComponent","MenuComponent","downloadMarkdown","dataUrl","download","href","click","downloadHTML","htmlWindow","head","outerHTML","body","documentElement","downloadPDF","print","DragAndDropEvent","eventOptions","interceptor","ALL_OPTIONS","initEvent","getOwnPropertyNames","eventObservable","addEventListener","addListenFunction","resultSelector","eventType","streamOperator","listener","tap","stopPropagation","cancelBubble","operatorOptions","operator","throttleTime","dragstart","DragAndDropEventType","defaultFun","group","groupEnd","drag","dragend","dragenter","dragover","drop","DragAndDropElement","element","parentContainer","elementStyle","demoStyle","ELEMENT_STYLE","DEMO_STYLE","diagonal","RT_ANGLE","Math","PI","LT_ANGLE","LB_ANGLE","RB_ANGLE","_parent","clone","style","draggable","_dadEvent","ondragstart","bind","ondrag","ondragend","ondragenter","equals","getDragElement","target","ondragover","ondrop","status","rect","clientRect","centerPoint","Point","left","width","top","getBoundingClientRect","reset","transitDemonstrationFinish","setDragElement","setDropElement","atan2","transitDemonstration","clientX","clientY","ondragleave","ondragexit","replaceElement","insertBefore","insertAfter","nextElementSibling","computeDirection","point","relaitiveTo","angle","Y","X","draggedEl","dir","dragElement","removeElement","newEl","oldEl","opacity","relato","DragAndDropContainer","_children","DADChildren","dragEl","_dragEl","getTime","dataTransfer","setData","toString","dropEl","_dropEl","getDropElement","types","split","Number","parseInt","DragAndDropDirective","ngAfterViewInit","DADContainer","Directive","TreeNodeOutletDirective","viewContainer","ViewContainerRef","TreeNodeDefDirective","templateRef","TemplateRef","TreeComponent","differs","_dataDiffer","find","create","_ds","ds","renderNodeChanges","outlet","dataDiffer","changes","diff","forEachOperation","record","previousIndex","currentIndex","createEmbeddedView","def","first","TreeControl","mostRecentTreeNode","view","move","IterableDiffers","ContentChildren","TreeNodeComponent","_tree","_differs","_isExpanded","updateChildrenNodes","clear","_data","ngAfterContentInit","ContentChild","TreeNodeToggleDirective","callbackFn","EventEmitter","toggle","emit","HostListener","Output","SyncScrollDirective","scroll","onScroll","subscription","curHeading","syncScrollInfo","deltaHeight","mutexLock","Ngr2MarkdownModule","NgModule","declarations","imports","BrowserModule","exports"],"mappings":"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","sourcesContent":["// import * as MarkdownIt from 'markdown-it';\r\n// å¦ä¸ç¨TSç@typesåè£å¼å¥å¨ie11ä¸­æ æ³å¼å®¹, å¨æååºæ¥çvendor.jsä¸­ä¼æä¸è¡ä½¿ç¨äºç®­å¤´å½æ°çä»£ç æ¥(è¯­æ³éè¯¯)\r\n// ç´æ¥å¼å¥markdown-it.min.jså¯ä»¥é¿å\r\nimport * as MarkdownIt from 'node_modules/markdown-it/dist/markdown-it.min.js';\r\nimport {Observable, Observer} from 'rxjs';\r\nimport * as hljs from 'highlight.js';\r\n\r\nexport class MarkdownImpl implements Markdown {\r\n  markdownIt: MarkdownIt;\r\n\r\n  constructor() {\r\n    this.markdownIt = new MarkdownIt({\r\n      highlight: (str: string, lang: string) => {\r\n        if (lang && hljs.getLanguage(lang)) {\r\n          try {\r\n            return '<pre class=\"hljs\"><code>' +\r\n              hljs.highlight(lang, str).value +\r\n              '</code></pre>';\r\n          } catch (__) {}\r\n        }\r\n        return '<pre class=\"hljs\"><code>' + this.markdownIt.utils.escapeHtml(str) + '</code>';\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * render markdown text function\r\n   * æ¸²æå½æ°\r\n   * @param markdown - markdown format text - markdownæ ¼å¼çææ¬\r\n   * @param options - use to open or close plugins\r\n   * @return - return transformation html - è¿åæ¸²æåçhtml\r\n   */\r\n  render(markdown: string, options?: MarkdownOption) {\r\n    this.disable(options);\r\n    const html = this.markdownIt.render(markdown);\r\n    this.enable(options);\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * fn: ä¼ å¥çæ¹æ³å¯ä»¥å¯¹mdçåå®¹è¿è¡å¤ç, å¤çç»æç±subjectååº\r\n   * fn.md: Markdownå¯¹è±¡åå®¹é½å¨éé¢\r\n   * fm.subject: è§å¯è, å¤çç»æç±æ­¤ä¼ åº\r\n   * @param fn\r\n   */\r\n  use<T>(fn: (md: MarkdownIt, subject: Observer<T>) => void): Observable<T> {\r\n    const md = this.markdownIt;\r\n    const observable = new Observable<T>(function (subscriber) {\r\n      md.use(fn, subscriber);\r\n    });\r\n    return observable;\r\n  }\r\n\r\n  enable(option: MarkdownOption) {\r\n    if (!option) { return; }\r\n    const enableRules = Object.keys(option).filter((value => {\r\n      return !option[value];\r\n    }));\r\n    this.markdownIt.enable(enableRules);\r\n  }\r\n\r\n  disable(option: MarkdownOption) {\r\n    if (!option) { return; }\r\n    const disableRules = Object.keys(option).filter((value => {\r\n      return !option[value];\r\n    }));\r\n    this.markdownIt.disable(disableRules);\r\n  }\r\n}\r\n\r\nexport class MarkdownOptionImpl implements MarkdownOption {\r\n  anchor: boolean;\r\n}\r\n\r\ninterface Markdown {\r\n  render(markdown: string, options: any);\r\n  use<T>(fn: (md: any, observer: Observer<T>) => void);\r\n  enable(option: MarkdownOption);\r\n  disable(option: MarkdownOption);\r\n}\r\n\r\ninterface MarkdownOption {\r\n  anchor: boolean;\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import {fromEvent, merge, Observable} from 'rxjs';\r\nimport {map} from 'rxjs/operators';\r\n\r\nexport class FileOperatorImpl implements FileOperator {\r\n  result: string;\r\n  private fileReader = new FileReader();\r\n  toDataURL(fileOrBlob: File | Blob): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsDataURL(fileOrBlob);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toText(fileOrBlob: File | Blob, encoding?: string): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsText(fileOrBlob, encoding);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toArrayBuffer(fileOrBlob: File | Blob): Observable<FileProgressEvent> {\r\n    this.fileReader.readAsArrayBuffer(fileOrBlob);\r\n    return this.mergeFileReader(this.fileReader);\r\n  }\r\n\r\n  toDataURLSync(fileOrBlob: File | Blob): string {\r\n    this.result = window.URL.createObjectURL(fileOrBlob);\r\n    return this.result;\r\n  }\r\n\r\n  revokeDataURLSync(): void {\r\n    window.URL.revokeObjectURL(this.result);\r\n  }\r\n\r\n  private mergeFileReader(fileReader: FileReader): Observable<FileProgressEvent> {\r\n    return merge(...[fromEvent(fileReader, 'load'),\r\n      fromEvent(fileReader, 'loadstart'),\r\n      fromEvent(fileReader, 'loadend'),\r\n      fromEvent(fileReader, 'progress'),\r\n      fromEvent(fileReader, 'error'),\r\n      fromEvent(fileReader, 'abort')])\r\n      .pipe(\r\n        map((value: ProgressEvent): FileProgressEvent => {\r\n          return Object.assign(value, {\r\n            result: fileReader.result || '',\r\n            error: fileReader.error || null\r\n          });\r\n        })\r\n      );\r\n  }\r\n}\r\n\r\nexport interface FileOperator {\r\n  toDataURL(fileOrBlob: File | Blob): Observable<FileProgressEvent>;\r\n  toText(fileOrBlob: File | Blob, encoding?: string): Observable<FileProgressEvent>;\r\n  toArrayBuffer(fileOrBlob: File | Blob): Observable<FileProgressEvent>;\r\n  toDataURLSync(fileOrBlob: File | Blob): string;\r\n  revokeDataURLSync(): void;\r\n}\r\n\r\nexport interface FileProgressEvent extends ProgressEvent {\r\n  result?: string | ArrayBuffer | null;\r\n  error?: DOMException | null;\r\n}\r\n","// @dynamic\r\nexport class TextParser {\r\n\r\n  private static _DIV = document.createElement('DIV');\r\n  static WORDS = new RegExp(/([a-zA-Z]+)|([\\u4e00-\\u9fa5])/g);\r\n\r\n  private static parse(text: string = ''): {\r\n    text: string,\r\n    words: number,\r\n    bytes: number,\r\n    lines: number\r\n  } {\r\n    const words = (text.match(TextParser.WORDS) || []).length;\r\n    let bytes = 0;\r\n    let lines = 0;\r\n    for (let i = 0; i < text.length; i++) {\r\n      if (text.charCodeAt(i) & 0xff00) {\r\n        bytes++;\r\n      } else if (text.charAt(i) === '\\n') {\r\n        lines++;\r\n      }\r\n      bytes++;\r\n    }\r\n    return {\r\n      text: text,\r\n      words: words,\r\n      bytes: bytes,\r\n      lines: lines\r\n    };\r\n  }\r\n\r\n  static parseMD(markdown: string): any {\r\n    return this.parse(markdown);\r\n  }\r\n\r\n  static parseHTML(html: string): any {\r\n    TextParser._DIV.innerHTML = html;\r\n\r\n    const result = this.parse(TextParser._DIV.textContent);\r\n    return {\r\n      text: html,\r\n      characters: result.bytes,\r\n      words: result.words,\r\n      paragraphs: result.lines\r\n    };\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport * as MarkdownIt from 'markdown-it/lib/index';\r\nimport {BehaviorSubject, Observable, Observer} from 'rxjs';\r\nimport {MarkdownImpl, MarkdownOptionImpl} from '../core/markdown/markdown';\r\nimport {FileOperatorImpl} from '../core/fileOperator';\r\nimport {map} from 'rxjs/operators';\r\nimport {TextParser} from '../utils/textParser';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class Ngr2MarkdownService {\r\n\r\n  /**\r\n   * æ¥æ¶Markdownæºææ¬\r\n   */\r\n  originMd: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n  private resetMd: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n  /**\r\n   * è§å¯`originMd`éè¿`render`æ¹æ³æ¸²æåºçHTML\r\n   */\r\n  private renderMd: BehaviorSubject<MarkdownContent> = new BehaviorSubject(null);\r\n  private _md: MarkdownImpl;\r\n  /**\r\n   * å½åæµè§çæ é¢çSubject, BehaviorSubjectå¯æ¯æå¤æ­(å¨å¤å¤è®¢é)\r\n   */\r\n  currentHeading: BehaviorSubject<string> = new BehaviorSubject<string>(null);\r\n  /**\r\n   * @deprecated\r\n   */\r\n  currentContent: BehaviorSubject<{md: string, html: string}> = new BehaviorSubject<{md: string, html: string}>({md: '', html: ''});\r\n  /**\r\n   * åéç®å½ä¿¡æ¯çSubject\r\n   */\r\n  TOCInfo: BehaviorSubject<TOCItem> = new BehaviorSubject<TOCItem>(null);\r\n  syncScroll: BehaviorSubject<any> = new BehaviorSubject<any>(null);\r\n  currentFile: BehaviorSubject<any> = new BehaviorSubject<any>(null);\r\n\r\n  constructor() {\r\n    this._md = new MarkdownImpl();\r\n    this._md.use(this.anchor)\r\n      .subscribe((value: Array<any>) => {\r\n        const infoList = value.map((item) => {\r\n          return new TOCItem(item.content, item.indentLevel);\r\n        });\r\n        const root = new TOCItem('root', 0);\r\n        let TOCInfo = root;\r\n        for (let i = 0; i < infoList.length; i++) {\r\n          while (TOCInfo && TOCInfo.indentLevel >= infoList[i].indentLevel) {\r\n            TOCInfo = TOCInfo.parent;\r\n          }\r\n          infoList[i].parent = TOCInfo;\r\n          TOCInfo.children.push(infoList[i]);\r\n          TOCInfo = infoList[i];\r\n        }\r\n        this.TOCInfo.next(root);\r\n      });\r\n\r\n    this.originMd\r\n      .pipe(\r\n        map(mdText => {\r\n          const html = this.render(mdText);\r\n          return {\r\n            md:   mdText || null,\r\n            html,\r\n            Markdown: TextParser.parseMD(mdText),\r\n            HTML: TextParser.parseHTML(html)\r\n          };\r\n        })\r\n      ).subscribe(this.renderMd);\r\n\r\n    this.resetMd\r\n      .subscribe(this.originMd);\r\n  }\r\n\r\n  /**\r\n   * éç½®markdownææ¬\r\n   * @param md\r\n   */\r\n  reinitialization(md: string): void {\r\n    if (!md) { return; }\r\n    this.resetMd.next(md);\r\n  }\r\n\r\n  /**\r\n   * markdownææ¬éç½®å, ååºæ¶æ¯\r\n   */\r\n  observerResetMarkdown(): Observable<string> {\r\n    return this.resetMd;\r\n  }\r\n\r\n  /**\r\n   * æ´æ°markdownææ¬, ç¨äºå®æ¶é¢è§åè½\r\n   * @param md\r\n   */\r\n  updateMarkdown(md: string | Observable<string>): void {\r\n    if (!md) { return; }\r\n\r\n    if (md instanceof Observable) {\r\n      md.subscribe(this.originMd);\r\n    } else {\r\n      this.originMd.next(md);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * markdownææ¬æ´æ°å, ååºæ¶æ¯\r\n   */\r\n  observeMarkdown(): Observable<MarkdownContent> {\r\n    return this.renderMd;\r\n  }\r\n\r\n  /**\r\n   * å°Markdownåå§ææ¬æ¸²ææHTMLæ ¼å¼\r\n   * @param markdown\r\n   * @param options\r\n   */\r\n  render(markdown: string, options?: MarkdownOptionImpl): string {\r\n    if (!markdown) {\r\n      markdown = '';\r\n    }\r\n    const html = this._md.render(markdown, options);\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®å½åæµè§çæ é¢\r\n   * @param heading - æ é¢æ ç­¾çid\r\n   */\r\n  setCurrentHeading(heading: string): void {\r\n    if (this.currentHeading.getValue() !== heading) {\r\n      this.currentHeading.next(heading);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å°å½åæ¾ç¤ºçåå®¹è½¬æ¢æ`data:`url\r\n   * @param type - `markdown`/`html`: è¦è½¬æ¢çåå®¹\r\n   */\r\n  currentContentToDataUrl(type: string): FileOperatorImpl {\r\n    const fileOperator = new FileOperatorImpl();\r\n    // å¼å®¹ie11-10, ie10ä¸æ¯æFileå¯¹è±¡çæé å½æ°, æ æ³æ°å»ºFileå¯¹è±¡, æä½¿ç¨Blob\r\n    let file: Blob | File;\r\n    switch (type) {\r\n      case 'markdown':\r\n        file = new Blob([this.currentContent.getValue().md], {type: 'text/plain'});\r\n        break;\r\n      case `html`:\r\n        file = new Blob([this.currentContent.getValue().html], {type: 'text/html'});\r\n        break;\r\n      default:\r\n        file = new Blob(['null'], {type: 'text/html'});\r\n        break;\r\n    }\r\n    fileOperator.toDataURLSync(file);\r\n    return fileOperator;\r\n  }\r\n\r\n  /**\r\n   * Plugin: anchor\r\n   * è¿ä¸ªæ¹æ³åç±»åä¸ºheading_opençtokenæ·»å id, ç¨äºéç¹å®ä½\r\n   * @param md - MarkdownIt instance\r\n   * @param observer - use to push info\r\n   */\r\n  private anchor(md: MarkdownIt, observer: Observer<Array<any>>) {\r\n    md.core.ruler.push('anchor', (state => {\r\n      const infoList: Array<any> = [];\r\n      let index = 0;\r\n      state.tokens.forEach((token) => {\r\n        if (token.type === 'heading_open') {\r\n          token.attrJoin('id', index++ + '-' + token.markup.length);\r\n          infoList.push({\r\n            content: token.attrGet('id'),\r\n            indentLevel: token.markup.length\r\n          });\r\n        }\r\n      });\r\n      observer.next(infoList);\r\n    }));\r\n  }\r\n}\r\n\r\nexport interface MarkdownContent {\r\n  md: string;\r\n  html?: string;\r\n  Markdown?: {\r\n    text:   string,\r\n    bytes:  number,\r\n    words:  number,\r\n    lines:  number\r\n  };\r\n  HTML?: {\r\n    text:       string,\r\n    characters: number,\r\n    words:      number,\r\n    paragraphs: number\r\n  };\r\n}\r\n/**\r\n * ç®å½(TOC)çæçä½ç½®\r\n * start: TOCå¨åå®¹å·¦è¾¹\r\n * end: å³è¾¹\r\n */\r\ntype TocPos = 'left' | 'right';\r\n/**\r\n * æ¨¡å¼\r\n * preview: é¢è§æ¨¡å¼\r\n * edit: ç¼è¾æ¨¡å¼\r\n */\r\ntype Mode = 'preview' | 'edit';\r\n\r\nexport class EditorOption {\r\n  static MODE: Mode = 'edit';\r\n  static ANCHOR = false;\r\n  static TOc = false;\r\n  static TOOL_BAR = false;\r\n  static DIRECTION: TocPos = 'left';\r\n  static HEIGHT = '800px';\r\n  static THEME_COLOR = '#3f51b5';\r\n  static BODY_CLASS_NAME = 'markdown-body';\r\n\r\n  mode: Mode;\r\n  anchor: boolean;\r\n  TOC: boolean;\r\n  toolBar: boolean;\r\n  direction: TocPos;\r\n  /**\r\n   * container height property\r\n   */\r\n  height: string;\r\n  /**\r\n   * container toc active color property\r\n   */\r\n  themeColor: string;\r\n  bodyClassName: string;\r\n\r\n  constructor(mode: Mode            = EditorOption.MODE,\r\n            anchor: boolean         = EditorOption.ANCHOR,\r\n              TOC: boolean          = EditorOption.TOc,\r\n              toolBar: boolean      = EditorOption.TOOL_BAR,\r\n              direction: TocPos     = EditorOption.DIRECTION,\r\n              height: string        = EditorOption.HEIGHT,\r\n              themeColor: string    = EditorOption.THEME_COLOR,\r\n              bodyClassName: string = EditorOption.BODY_CLASS_NAME\r\n  ) {\r\n    this.mode =           mode;\r\n    this.anchor =         anchor;\r\n    this.TOC =            TOC;\r\n    this.toolBar =        toolBar;\r\n    this.direction =      direction;\r\n    this.height =         height;\r\n    this.themeColor =     themeColor;\r\n    this.bodyClassName =  bodyClassName;\r\n  }\r\n\r\n  static instanceOf(value: EditorOption) {\r\n    return new EditorOption(\r\n      value.mode          || EditorOption.MODE,\r\n      value.anchor        || EditorOption.ANCHOR,\r\n      value.TOC           || EditorOption.TOc,\r\n      value.toolBar       || EditorOption.TOOL_BAR,\r\n      value.direction     || EditorOption.DIRECTION,\r\n      value.height        || EditorOption.HEIGHT,\r\n      value.themeColor    || EditorOption.THEME_COLOR,\r\n      value.bodyClassName || EditorOption.BODY_CLASS_NAME,\r\n    );\r\n  }\r\n}\r\n\r\nexport class TOCItem {\r\n  content: string;\r\n  indentLevel: number;\r\n  parent: TOCItem;\r\n  children: Array<TOCItem>;\r\n\r\n  constructor(content: string, indentLevel: number) {\r\n    this.content      = content;\r\n    this.indentLevel  = indentLevel;\r\n    this.children     = new Array<TOCItem>();\r\n  }\r\n}\r\n","export class SyncScroll {\r\n\r\n  private _el: HTMLElement;\r\n  queryString: string;\r\n  headingsInfo: Array<{\r\n    id: string,\r\n    pairId: string,\r\n    el: HTMLElement,\r\n    offsetTop: number,\r\n    height: number\r\n  }>;\r\n  suffix: string;\r\n\r\n  generateId: (node: Node, index: number, nodeList: NodeListOf<Node>) => string;\r\n\r\n  constructor(el: HTMLElement,\r\n              suffix: string,\r\n              generateIdFun: (node: Node, index: number, nodeList: NodeListOf<Node>) => string = node => (node as HTMLElement).id) {\r\n    this._el          = el;\r\n    this.suffix       = suffix;\r\n    this.generateId   = generateIdFun;\r\n\r\n    this.headingsInfo = [];\r\n  }\r\n\r\n  syncScrollByHeading(headingElType: 'tag' | 'class' = 'tag',\r\n                      headingKeys: Array<string> = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6']) {\r\n\r\n    switch (headingElType) {\r\n      case 'class':\r\n        this.queryString = headingKeys.map(value => '.' + value).join(',');\r\n        break;\r\n      case 'tag':\r\n      default:\r\n        this.queryString = headingKeys.join(',');\r\n    }\r\n\r\n    this._update(this.queryString);\r\n  }\r\n\r\n  updateHeadingsInfo() {\r\n    this._update(this.queryString);\r\n  }\r\n\r\n  currentHeading(scrollTop: number = this._el.scrollTop): {\r\n    headingInfo: {\r\n      id: string,\r\n      pairId: string,\r\n      el: HTMLElement,\r\n      offsetTop: number,\r\n      height: number\r\n    },\r\n    scrollTop: number\r\n  } {\r\n    if (this.headingsInfo) { return this._curHeading(scrollTop); }\r\n    return null;\r\n  }\r\n\r\n  getPairHeading(pairId: string): {\r\n    headingInfo: {\r\n      id: string,\r\n      pairId: string,\r\n      el: HTMLElement,\r\n      offsetTop: number,\r\n      height: number\r\n    },\r\n    scrollTop: number\r\n  } {\r\n    for (let i = 0; i < this.headingsInfo.length; i++) {\r\n      if (this.headingsInfo[i].pairId === pairId) {\r\n        return {\r\n          headingInfo: this.headingsInfo[i],\r\n          scrollTop: this._el.scrollTop\r\n        };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private _curHeading(scrollTop: number): {\r\n    headingInfo: {\r\n      id: string,\r\n      pairId: string,\r\n      el: HTMLElement,\r\n      offsetTop: number,\r\n      height: number\r\n    },\r\n    scrollTop: number\r\n  } {\r\n    if (this.headingsInfo.length <= 0) { return null; }\r\n\r\n    const el = this.headingsInfo.reduce((previousValue, currentValue) => {\r\n      if (currentValue.offsetTop > scrollTop) {\r\n        return previousValue;\r\n      }\r\n      if ((scrollTop - previousValue.offsetTop) > (scrollTop - currentValue.offsetTop)) {\r\n        return currentValue;\r\n      } else {\r\n        return previousValue;\r\n      }\r\n    });\r\n\r\n    return {\r\n      headingInfo: el,\r\n      scrollTop: scrollTop\r\n    };\r\n  }\r\n\r\n  private _update(queryString: string) {\r\n    const nodeList = this._el.querySelectorAll(queryString);\r\n\r\n    if (!nodeList || nodeList.length <= 0) { return; }\r\n\r\n    this.headingsInfo = [];\r\n\r\n    for (let i = 0; i < nodeList.length; i++) {\r\n      const curNode = nodeList[i] as HTMLElement;\r\n      const nextNodeOffset = (i + 1) >= nodeList.length ? this._el.scrollHeight : (nodeList[i + 1] as HTMLElement).offsetTop;\r\n\r\n      const pairId = this.generateId(curNode, i, nodeList);\r\n\r\n      this.headingsInfo.push({\r\n        id: pairId + '-' + this.suffix,\r\n        pairId: pairId,\r\n        el: curNode,\r\n        offsetTop: curNode.offsetTop,\r\n        height: nextNodeOffset - curNode.offsetTop\r\n      });\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component, ElementRef,\r\n  Input, OnInit, ViewChild,\r\n  ViewEncapsulation\r\n} from '@angular/core';\r\nimport {EditorOption, Ngr2MarkdownService} from './service/ngr2-markdown.service';\r\nimport {fromEvent} from 'rxjs';\r\nimport {distinctUntilChanged, filter, map} from 'rxjs/operators';\r\nimport {SyncScroll} from './core/syncScroll';\r\n\r\n@Component({\r\n  selector: 'nb-ngr2-markdown',\r\n  templateUrl: './ngr2-markdown.component.html',\r\n  styleUrls: [\r\n    './ngr2-markdown.component.css',\r\n  ],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class Ngr2MarkdownComponent implements OnInit {\r\n  @ViewChild('markdownBody', {\r\n    read: ElementRef\r\n  }) markdownBody: ElementRef;\r\n  /**\r\n   * markdownè½¬æ¢åçhtmlææ¬\r\n   */\r\n  _html: string;\r\n  /**\r\n   * éç½®åæ°\r\n   */\r\n  _options: EditorOption;\r\n\r\n  syncScroll: SyncScroll;\r\n\r\n  @Input()\r\n  set markdown(value: string) {\r\n    this.markdownService.updateMarkdown(value);\r\n  }\r\n  @Input()\r\n  set options(value: EditorOption) {\r\n    this._options = EditorOption.instanceOf(value);\r\n  }\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.syncScroll = new SyncScroll(\r\n      this.markdownBody.nativeElement,\r\n      'pre',\r\n      (node, index) => index + '-' + ((node as HTMLElement).tagName.charCodeAt(1) - 48)\r\n    );\r\n    this.syncScroll.syncScrollByHeading();\r\n\r\n    this.markdownService.observeMarkdown()\r\n      .subscribe(value => {\r\n        // æ´æ°innerHTML\r\n        this._html = value.html;\r\n        // this.updateHeadingsInfo();\r\n        // éæ°åå§åä¸äºéè¦è§å¾æ¸²æç»ææè½è·åçå¯¹è±¡çå¼\r\n        // this.reinitialization();\r\n        setTimeout(() => {\r\n          this.syncScroll.updateHeadingsInfo();\r\n        });\r\n      });\r\n\r\n    fromEvent(this.markdownBody.nativeElement, 'scroll')\r\n      .pipe(\r\n        filter(() => this.syncScroll.headingsInfo && this.syncScroll.headingsInfo.length > 0),\r\n        map(() => this.syncScroll.currentHeading()),\r\n        distinctUntilChanged()\r\n      )\r\n      .subscribe(value => {\r\n      });\r\n  }\r\n}\r\n","import {Component, Input, OnInit} from '@angular/core';\r\nimport {Ngr2MarkdownService, TOCItem} from '../service/ngr2-markdown.service';\r\n\r\n@Component({\r\n  selector: 'nb-side-toc',\r\n  templateUrl: './side-toc.component.html',\r\n  styleUrls: ['./side-toc.component.css']\r\n})\r\nexport class SideTocComponent implements OnInit {\r\n  @Input() currentHeading: string;\r\n  @Input() themeColor = '#3f51b5';\r\n  TOCInfo: TOCItem;\r\n  constructor(\r\n    private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.markdownService.currentHeading.subscribe({\r\n      next: (value => {\r\n        this.currentHeading = value;\r\n      })\r\n    });\r\n    this.markdownService.TOCInfo.subscribe({\r\n      next: (value => {\r\n        this.TOCInfo = value;\r\n      })\r\n    });\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport {DomSanitizer, SafeHtml, SafeUrl} from '@angular/platform-browser';\r\n\r\n@Pipe({\r\n  name: 'safe'\r\n})\r\nexport class HTMLPipePipe implements PipeTransform {\r\n\r\n  constructor(private domSanitizer: DomSanitizer) {\r\n  }\r\n\r\n  /**\r\n   * use DomSanitizer allow insert outside HTML\r\n   * ä½¿ç¨DomSanitizeråè®¸æå¥å¤é¨çHTML\r\n   * @param value - html content htmlåå®¹\r\n   * @param args = ç¬¬ä¸ä¸ªåæ°æ¯åå®¹ç±»å`html/url` é»è®¤ä¸º `html`\r\n   * @return - transformed html content htmlåæ¢åçåå®¹\r\n   */\r\n  transform(value: any, ...args: any[]): SafeHtml | SafeUrl {\r\n    const type = args[0];\r\n    switch (type) {\r\n      case 'html':\r\n        return this.domSanitizer.bypassSecurityTrustHtml(value);\r\n      case 'url':\r\n        return this.domSanitizer.bypassSecurityTrustUrl(value);\r\n      default:\r\n        return this.domSanitizer.bypassSecurityTrustHtml(value);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\n\r\n@Pipe({\r\n  name: 'md'\r\n})\r\nexport class MdPipe implements PipeTransform {\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService) {\r\n  }\r\n\r\n  transform(value: string, args?: any): any {\r\n    return this.markdownService.render(value, {anchor: false});\r\n  }\r\n\r\n}\r\n","import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {Subscription} from 'rxjs';\r\nimport {FileOperatorImpl} from '../core/fileOperator';\r\n\r\n@Component({\r\n  selector: 'nb-tool-bar',\r\n  templateUrl: './tool-bar.component.html',\r\n  styleUrls: ['./tool-bar.component.css']\r\n})\r\nexport class ToolBarComponent implements OnInit, OnDestroy {\r\n\r\n  mdHref: string;\r\n  htmlHref: string;\r\n  title: string;\r\n  titleSubscribe: Subscription;\r\n  hrefSubscribe: Subscription;\r\n  constructor(\r\n    private markdownService: Ngr2MarkdownService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.titleSubscribe = this.markdownService.TOCInfo\r\n      .subscribe(value => this.title = value.content);\r\n    let MdFileOperator: FileOperatorImpl;\r\n    let HTMLFileOperator: FileOperatorImpl;\r\n    this.hrefSubscribe = this.markdownService.currentContent\r\n      .subscribe(value => {\r\n        if (MdFileOperator) { MdFileOperator.revokeDataURLSync(); }\r\n        if (HTMLFileOperator) { HTMLFileOperator.revokeDataURLSync(); }\r\n        MdFileOperator = this.markdownService.currentContentToDataUrl('markdown');\r\n        HTMLFileOperator = this.markdownService.currentContentToDataUrl('html');\r\n        this.mdHref = MdFileOperator.result;\r\n        this.htmlHref = HTMLFileOperator.result;\r\n      });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.titleSubscribe.unsubscribe();\r\n    this.hrefSubscribe.unsubscribe();\r\n  }\r\n}\r\n","import {ExtRenderInfo} from './markdwonRenderer';\r\n\r\n// @dynamic\r\nexport class MarkdownMarker {\r\n\r\n  static headingRegExp = new RegExp(/^\\s*(#{1,6})\\s+.*\\s*$/);\r\n  static blockQuoteRegExp = new RegExp(/^\\s*>.*/);\r\n  static listItemRegExp = new RegExp(/^(\\d+|[*+\\-])\\s.*/);\r\n  static codeBlockRegExp = new RegExp(/^`{1,3}\\w*$/);\r\n\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * å¤æ­æ¯å¦ç¬¦åMarkdownè§å\r\n   * @param text - è¦å¤æ­çå­ç¬¦ä¸²\r\n   */\r\n  testMarks(text: string): MarkType {\r\n    if (MarkdownMarker.headingRegExp.test(text)) {\r\n      return MarkType.HEADING;\r\n    } else if (MarkdownMarker.blockQuoteRegExp.test(text)) {\r\n      return MarkType.BLOCK_QUOTE;\r\n    } else if (MarkdownMarker.listItemRegExp.test(text)) {\r\n      return MarkType.LIST_ITEM;\r\n    } else if (MarkdownMarker.codeBlockRegExp.test(text)) {\r\n      return MarkType.CODE_BLOCK;\r\n    } else {\r\n      return MarkType.DEFAULT;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¼ å¥ç¬¦åheadingçå­ç¬¦ä¸²ï¼è¿åè§£æçæ°æ®(`#`å·ä¸ªæ°)\r\n   * @param text - headingå­ç¬¦ä¸²\r\n   */\r\n  parseHeading(text: string): ExtRenderInfo {\r\n    if (!text) { return; }\r\n    let length;\r\n    length = MarkdownMarker.headingRegExp[Symbol.match](text)[1].length;\r\n\r\n    return {\r\n      headingLevel: length\r\n    };\r\n  }\r\n}\r\n\r\nexport enum MarkType {\r\n  HEADING     = 'heading',\r\n  BLOCK_QUOTE = 'block quote',\r\n  LIST_ITEM   = 'list item',\r\n  CODE_BLOCK  = 'code block',\r\n  CODE_INLINE = 'code inline',\r\n  NOTHING     = 'nothing',\r\n  DEFAULT     = 'default'\r\n}\r\n","import {MarkType} from './markdownMarker';\r\n\r\nexport class MarkdownRenderer {\r\n\r\n  curEl: HTMLElement;\r\n  curRange: Range;\r\n\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * æ¸²æ`Range`\r\n   * @param range - è¦æ¸²æç`Range`\r\n   * @param type - æ¸²æçç±»å\r\n   * @param extra - é¢å¤ä¿¡æ¯\r\n   */\r\n  renderRange(range: Range, type: MarkType, extra?: ExtRenderInfo) {\r\n    this.curRange = range;\r\n    return this.renderEl(this._getRangeEl(range), type, extra);\r\n  }\r\n\r\n  /**\r\n   * æ¸²æ`HTMLElement`\r\n   * @param el - è¦æ¸²æç`HTMLElement`\r\n   * @param type - æ¸²æç±»å\r\n   * @param extra - é¢å¤ä¿¡æ¯\r\n   */\r\n  renderEl(el: HTMLElement, type: MarkType, extra?: ExtRenderInfo) {\r\n    this.curEl = el;\r\n    switch (type) {\r\n      case MarkType.HEADING:\r\n        this._heading(extra);\r\n        break;\r\n      // case MarkType.BLOCK_QUOTE:\r\n      //   this._blockQuote(extra);\r\n      //   break;\r\n      // case MarkType.LIST_ITEM:\r\n      //   this._listItem(extra);\r\n      //   break;\r\n      // case MarkType.CODE_BLOCK:\r\n      //   this._codeBlock(extra);\r\n      //   break;\r\n      // case MarkType.CODE_INLINE:\r\n      //   this._codeInline(extra);\r\n      //   break;\r\n      case MarkType.DEFAULT:\r\n      default:\r\n        this._default(extra);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private _heading(extra?: ExtRenderInfo) {\r\n    const level = extra && extra.headingLevel || 1;\r\n    if (this.curEl.className === 'h' + level) { return; }\r\n    this.curEl.className = 'h' + level;\r\n  }\r\n\r\n  private _blockQuote(extra?: ExtRenderInfo) {\r\n    if (this.curEl.className === 'blockquote') { return; }\r\n    this.curEl.className = 'blockquote';\r\n  }\r\n\r\n  private _listItem(extra?: ExtRenderInfo) {\r\n    if (this.curEl.className === 'li') { return; }\r\n    this.curEl.className = 'li';\r\n  }\r\n\r\n  private _codeBlock(extra?: ExtRenderInfo) {\r\n    if (this.curEl.className === 'code') { return; }\r\n\r\n    if (this.curEl.parentElement.className !== 'pre') {\r\n      this.curEl.className = 'pre';\r\n      const offset = this.curRange.startOffset;\r\n      const parEl = document.createElement('DIV');\r\n      parEl.appendChild(this.curRange.startContainer);\r\n      parEl.className = 'code';\r\n\r\n      this.curEl.appendChild(parEl);\r\n      this.curRange.setStart(parEl, offset);\r\n    } else {\r\n      this.curEl.className = 'code';\r\n    }\r\n  }\r\n\r\n  private _codeInline(extra?: ExtRenderInfo) {\r\n  }\r\n\r\n  private _default(extra?: ExtRenderInfo) {\r\n    if (this.curEl.className !== 'p') {\r\n      this.curEl.className = 'p';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åRangeçæå¨çåç´ èç¹(éææ¬èç¹)\r\n   * @param range - range\r\n   */\r\n  private _getRangeEl(range: Range): HTMLElement {\r\n    const startEl = range.startContainer;\r\n    let el: HTMLElement;\r\n\r\n    if (startEl.nodeType === Node.TEXT_NODE) {\r\n      el = startEl.parentElement;\r\n    } else if (startEl.nodeType === Node.ELEMENT_NODE) {\r\n      el = startEl as HTMLElement;\r\n    }\r\n\r\n    return el;\r\n  }\r\n}\r\n\r\nexport interface ExtRenderInfo {\r\n  headingLevel?: number;\r\n  [key: string]: any;\r\n}\r\n","import {Component, ElementRef, OnInit, ViewChild, ViewEncapsulation} from '@angular/core';\r\nimport {Observable, Subject} from 'rxjs';\r\nimport {debounceTime, distinctUntilChanged} from 'rxjs/operators';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {MarkdownMarker, MarkType} from '../core/markdown/markdownMarker';\r\nimport {MarkdownRenderer} from '../core/markdown/markdwonRenderer';\r\nimport {SyncScroll} from '../core/syncScroll';\r\n\r\n@Component({\r\n  selector: 'nb-edit-box',\r\n  templateUrl: './edit-box.component.html',\r\n  styleUrls: ['./edit-box.component.css'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class EditBoxComponent implements OnInit {\r\n\r\n  @ViewChild('editArea', {read: ElementRef}) editAreaRef: ElementRef;\r\n  @ViewChild('editWindow', {read: ElementRef}) editWindowRef: ElementRef;\r\n\r\n  private _editArea: HTMLElement;\r\n  private _selection: Selection;\r\n  private contentChange: Subject<string> = new Subject<string>();\r\n  private marker: MarkdownMarker;\r\n  private renderer: MarkdownRenderer;\r\n\r\n  private get _range() { return this._selection.getRangeAt(0); }\r\n\r\n  syncScroll: SyncScroll;\r\n\r\n  set content(value: string) {\r\n    if (!value || value.length <= 0) {\r\n      this._editArea.innerHTML = '<div><br></div>';\r\n    } else {\r\n      this._editArea.innerText = value;\r\n    }\r\n  }\r\n  get content(): string {\r\n    console.log({\r\n      before: this._editArea.innerText,\r\n      after: this._editArea.innerText.replace(/\\n\\n/g, '\\n')\r\n    });\r\n    return this._editArea.innerText.replace(/\\n\\n/g, '\\n');\r\n  }\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this._editArea  = this.editAreaRef.nativeElement;\r\n    this._editArea.focus();\r\n    this._selection = document.getSelection();\r\n\r\n    this.syncScroll = new SyncScroll(\r\n      this.editWindowRef.nativeElement,\r\n      'edit',\r\n      (node, index) => index + '-' + ((node as HTMLElement).className.charCodeAt(1) - 48)\r\n    );\r\n    this.syncScroll.syncScrollByHeading('class');\r\n    // const sk = new ShortcutKey(this._editArea);\r\n\r\n    this.marker   = new MarkdownMarker();\r\n    this.renderer = new MarkdownRenderer();\r\n\r\n    this.bindMdService();\r\n    this.bindMutationObserver();\r\n  }\r\n\r\n  keyUp(event: KeyboardEvent) {\r\n    const text = this._range.startContainer.textContent;\r\n    const type = this.marker.testMarks(text);\r\n\r\n    switch (type) {\r\n      case MarkType.HEADING:\r\n        this.renderer.renderRange(this._range, type, this.marker.parseHeading(text));\r\n        break;\r\n      default:\r\n        this.renderer.renderRange(this._range, type);\r\n        break;\r\n    }\r\n  }\r\n\r\n  paste(event: ClipboardEvent) {\r\n    const text = event.clipboardData.getData('text');\r\n    document.execCommand('insertText', false, text);\r\n    const children = this._editArea.children;\r\n    for (let i = 0; i < children.length; i++) {\r\n      const type = this.marker.testMarks(children[i].textContent);\r\n\r\n      switch (type) {\r\n        case MarkType.HEADING:\r\n          this.renderer.renderEl(children[i] as HTMLElement, type, this.marker.parseHeading(children[i].textContent));\r\n          break;\r\n        default:\r\n          this.renderer.renderEl(children[i] as HTMLElement, type);\r\n          break;\r\n      }\r\n    }\r\n    this.syncScroll.updateHeadingsInfo();\r\n    event.preventDefault();\r\n  }\r\n  /**\r\n   * è®¢éMarkdownServiceçä¸äºSubject/Observable\r\n   */\r\n  private bindMdService(): void {\r\n    // è®¢ééç½®äºä»¶\r\n    this.markdownService.observerResetMarkdown()\r\n      .subscribe(md => {\r\n        this._editArea.innerHTML = '<div><br></div>';\r\n        this._editArea.focus();\r\n\r\n        document.execCommand('insertText', false, md);\r\n        const children = this._editArea.children;\r\n        for (let i = 0; i < children.length; i++) {\r\n          const type = this.marker.testMarks(children[i].textContent);\r\n\r\n          switch (type) {\r\n            case MarkType.HEADING:\r\n              this.renderer.renderEl(children[i] as HTMLElement, type, this.marker.parseHeading(children[i].textContent));\r\n              break;\r\n            default:\r\n              this.renderer.renderEl(children[i] as HTMLElement, type);\r\n              break;\r\n          }\r\n        }\r\n        this.syncScroll.updateHeadingsInfo();\r\n        // this.content = md;\r\n      });\r\n\r\n    this.markdownService\r\n      .updateMarkdown(this.observeText(200));\r\n  }\r\n\r\n  /**\r\n   * è§å¯ææ¬çåå\r\n   * @param time - å»¶è¿ååºçæ¶é´\r\n   */\r\n  private observeText(time?: number): Observable<string> {\r\n    if (!time) {\r\n      return this.contentChange.asObservable();\r\n    }\r\n    return this.contentChange\r\n      .pipe(\r\n        distinctUntilChanged(),\r\n        debounceTime(time)\r\n      );\r\n  }\r\n\r\n  /**\r\n   * ç»å®å¹¶å¼å¯MutationObserver, è§¦åæ¶å°markdownææ¬åéå°`mdChange`\r\n   */\r\n  private bindMutationObserver() {\r\n    const _observer = new MutationObserver((mutations: Array<MutationRecord>, observer: MutationObserver) => {\r\n      this.syncScroll.updateHeadingsInfo();\r\n      this.contentChange.next(this.content);\r\n    });\r\n\r\n    _observer.observe(this._editArea, {\r\n      subtree: true,\r\n      childList: true,\r\n      characterData: true,\r\n      attributes: true\r\n    });\r\n  }\r\n}\r\n","import {concat, from, Observable, Subscriber} from 'rxjs';\r\nimport {mergeMap, scan} from 'rxjs/operators';\r\nimport {el} from '@angular/platform-browser/testing/src/browser_util';\r\n\r\n// @dynamic\r\nexport class IndexedDB {\r\n  static O_S_STRUCT = [\r\n    {\r\n      name: 'testStore',\r\n      optionalParameters: {\r\n        keyPath: 'id'\r\n      },\r\n      indexes: [\r\n        {\r\n          name: 'storeName',\r\n          keyPath: 'storeName',\r\n          options: {\r\n            unique: false\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  private _db: IDBDatabase;\r\n  private objectStoreStructs: Array<IndexedDBStruct>;\r\n\r\n  private constructor(dbName: string = 'testDB',\r\n                      objectStoreStructs: Array<IndexedDBStruct> = IndexedDB.O_S_STRUCT,\r\n                      subscriber: Subscriber<IndexedDB>\r\n  ) {\r\n    this.objectStoreStructs = objectStoreStructs;\r\n\r\n    const request = window.indexedDB.open(dbName);\r\n    request.onerror = (event: Event) => {\r\n      alert('Database error: ' + (<IDBOpenDBRequest> event.target).error);\r\n    };\r\n\r\n    request.onsuccess  = (event: Event): any => {\r\n      console.log(`IndexedDB open success`);\r\n      this._db = request.result;\r\n      subscriber.next(this);\r\n    };\r\n\r\n    /**\r\n     * use to initial database\r\n     * @param event\r\n     */\r\n    request.onupgradeneeded = (event: IDBVersionChangeEvent) => {\r\n      console.log(`IndexedDB upgrade need`);\r\n      this._db = request.result;\r\n\r\n      this.objectStoreStructs.forEach(store => {\r\n        const objectStore: IDBObjectStore = this._db.createObjectStore(store.name, store.optionalParameters);\r\n        if (store.indexes) {\r\n          store.indexes.forEach(index => {\r\n            objectStore.createIndex(\r\n              index.name,\r\n              index.keyPath || index.name,\r\n              index.options);\r\n          });\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  static instenceof(dbName: string = 'testDB',\r\n                    objectStoreStructs: Array<IndexedDBStruct> = IndexedDB.O_S_STRUCT\r\n  ): Observable<IndexedDB> {\r\n    return new Observable(subscriber => {\r\n      const indexedDB = new IndexedDB(dbName, objectStoreStructs, subscriber);\r\n    });\r\n  }\r\n  /**\r\n   * get object store specify name and mode\r\n   * @param storeName\r\n   * @param mode\r\n   */\r\n  getObjectStore(storeName: string, mode: IDBTransactionMode): IndexedDBStore {\r\n    return new IndexedDBStore(this._db.transaction(storeName, mode).objectStore(storeName));\r\n  }\r\n}\r\n\r\nexport class IndexedDBStore {\r\n  /**\r\n   * IndexedDB ObjectStore represent a object store (like table in sql database)\r\n   */\r\n  objectStore: IDBObjectStore;\r\n\r\n  constructor(objectStore: IDBObjectStore) {\r\n    this.objectStore = objectStore;\r\n  }\r\n\r\n  add<T>(data: T): Observable<IndexedDBEvent<IDBValidKey>> {\r\n    return new Observable<IndexedDBEvent<IDBValidKey>>((subscriber: Subscriber<IndexedDBEvent<IDBValidKey>>) => {\r\n      const request: IDBRequest<IDBValidKey> = this.objectStore.add(data);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * return Observable object send IndexedDBEvent multiple time\r\n   * @param data - add to store object array\r\n   */\r\n  addAll<T>(data: T[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const addObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = data.map(\r\n      (item: T): Observable<IndexedDBEvent<IDBValidKey>> => this.add(item));\r\n    return this._concat_scan<IDBValidKey>(...addObservables);\r\n  }\r\n\r\n  /**\r\n   * return Observable object send IndexedDBEvent\r\n   * if IndexedDBEvent.type is IndexedDBEventType.SUCCESS then get data from IndexedDBEvent.data\r\n   * @param key\r\n   */\r\n  getById<T>(key: IDBValidKey): Observable<IndexedDBEvent<T>> {\r\n    return new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<T> = this.objectStore.get(key);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å¼å®¹ie11-10, ie10ä¸æ¯æIndexedDB.getAll()æ¹æ³, ç¨openCursoræ¿ä»£\r\n   * [IndexedDB.IDBObjectStore]{@link https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore}\r\n   */\r\n  getAll<T>(): Observable<IndexedDBEvent<Array<T>>> {\r\n    const observable = new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<IDBCursorWithValue> = this.objectStore.openCursor();\r\n\r\n      request.onsuccess = (event: Event) => {\r\n        const cursor = request.result;\r\n        if (cursor) {\r\n          subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, cursor.value));\r\n          cursor.continue();\r\n        } else {\r\n          subscriber.complete();\r\n        }\r\n      };\r\n      request.onerror = (event: Event) => {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n        subscriber.complete();\r\n      };\r\n      // this.initRequest<Array<T>>(request, subscriber);\r\n    });\r\n    return this.getCount()\r\n      .pipe(\r\n        mergeMap((value: IndexedDBEvent<number>) => this._from_scan(observable, value.data))\r\n      );\r\n  }\r\n  /**\r\n   * return Observable object will send IndexedDBEvent multiple time\r\n   * will add T to IndexedDBEvent.data every time\r\n   * @param keys - ids\r\n   */\r\n  getAllById<T>(...keys: Array<IDBValidKey>): Observable<IndexedDBEvent<Array<T>>> {\r\n    const getObservables: Array<Observable<IndexedDBEvent<T>>> = keys.map(\r\n      (item: IDBValidKey): Observable<IndexedDBEvent<T>> => this.getById(item));\r\n    return this._concat_scan(...getObservables);\r\n  }\r\n\r\n  /**\r\n   * like getAllById but parameter type is IDBIndex\r\n   * @param indexName - index name\r\n   */\r\n  getAllByIndex<T>(indexName: string): Observable<IndexedDBEvent<Array<T>>> {\r\n    const index = this.objectStore.index(indexName);\r\n    const observable = new Observable<IndexedDBEvent<T>>((subscriber: Subscriber<IndexedDBEvent<T>>) => {\r\n      const request: IDBRequest<IDBCursorWithValue> = index.openCursor();\r\n      request.onsuccess = (event: Event) => {\r\n        const cursor: IDBCursorWithValue = request.result;\r\n        if (cursor) {\r\n          subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, <T> cursor.value));\r\n          cursor.continue();\r\n        } else {\r\n          subscriber.complete();\r\n        }\r\n      };\r\n      request.onerror = (event: Event) => {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n        subscriber.complete();\r\n      };\r\n    });\r\n\r\n    return this.getCount(index)\r\n      .pipe(\r\n        mergeMap((value: IndexedDBEvent<number>) => this._from_scan(observable, value.data))\r\n      );\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent\r\n   * if success IndexedDBEvent.data is updated object primary key\r\n   * @param data\r\n   */\r\n  update<T>(data: T): Observable<IndexedDBEvent<IDBValidKey>> {\r\n    return new Observable<IndexedDBEvent<IDBValidKey>>((subscriber: Subscriber<IndexedDBEvent<IDBValidKey>>) => {\r\n      const request: IDBRequest<IDBValidKey> = this.objectStore.put(data);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent multiple time\r\n   * every time will add success updated object primary key to IndexedDBEvent.data\r\n   * @param data\r\n   */\r\n  updateAll<T>(data: T[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const updateObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = data.map(\r\n      (item: T): Observable<IndexedDBEvent<IDBValidKey>> => this.update(item));\r\n    return this._concat_scan<IDBValidKey>(...updateObservables);\r\n  }\r\n\r\n  /**\r\n   * delete\r\n   * if success return IndexedDBEvent.data type is undefined\r\n   * @param key\r\n   */\r\n  delete(key: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<undefined>> {\r\n    return new Observable<IndexedDBEvent<undefined>>((subscriber: Subscriber<IndexedDBEvent<undefined>>) => {\r\n      const request: IDBRequest<undefined> = this.objectStore.delete(key);\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  deleteAll(...keys: (IDBValidKey | IDBKeyRange)[]): Observable<IndexedDBEvent<Array<IDBValidKey>>> {\r\n    const deleteObservables: Array<Observable<IndexedDBEvent<IDBValidKey>>> = keys.map(\r\n      (item: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<IDBValidKey>> => this.delete(item));\r\n    return this._concat_scan<IDBValidKey>(...deleteObservables);\r\n  }\r\n\r\n  /**\r\n   * return observable object send IndexedDBEvent, IndexedDBEvent.data is IDBObjectStore or IDBIndex contain element's count\r\n   * @param object\r\n   * @param key\r\n   */\r\n  getCount(object?: IDBIndex, key?: IDBValidKey | IDBKeyRange): Observable<IndexedDBEvent<number>> {\r\n    return new Observable((subscriber: Subscriber<IndexedDBEvent<number>>) => {\r\n      const request: IDBRequest<number> = object === undefined ? this.objectStore.count() : object.count();\r\n      this.initRequest(request, subscriber);\r\n    });\r\n  }\r\n\r\n  private initRequest<T>(request: IDBRequest<T>, subscriber: Subscriber<IndexedDBEvent<T | DOMException>>): void {\r\n    request.onsuccess = () => {\r\n      if (request.result !== undefined) {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.COMPLETE, 1, 1, request.result));\r\n      } else {\r\n        subscriber.next(new IndexedDBEvent<T>(IndexedDBEventType.ERROR, 0, 0));\r\n      }\r\n      subscriber.complete();\r\n    };\r\n    // requeståºéè¿åéè¯¯ä¿¡æ¯\r\n    request.onerror = (event: Event) => {\r\n      subscriber.next(new IndexedDBEvent<DOMException>(IndexedDBEventType.ERROR, 0, 0, request.error));\r\n      subscriber.complete();\r\n    };\r\n  }\r\n\r\n  /**\r\n   * create observable use rxjs from function then use scan operator\r\n   * return custom event(IndexedDBEvent)\r\n   * @param observable\r\n   * @param total\r\n   */\r\n  private _from_scan<T>(observable: Observable<IndexedDBEvent<T>>, total: number): Observable<IndexedDBEvent<Array<T>>> {\r\n    return observable\r\n      .pipe(\r\n        scan<IndexedDBEvent<T>, IndexedDBEvent<Array<T>>>(\r\n          (acc: IndexedDBEvent<Array<T>>, value: IndexedDBEvent<T>): IndexedDBEvent<Array<T>> => {\r\n            if (value.type !== IndexedDBEventType.ERROR) {\r\n              acc.loaded++;\r\n              acc.data.push(value.data);\r\n              if (acc.loaded === acc.total) { acc.type = IndexedDBEventType.COMPLETE; }\r\n            } else {\r\n              acc.type = IndexedDBEventType.ERROR;\r\n              acc.loaded = 0;\r\n            }\r\n            return acc;\r\n          },\r\n          new IndexedDBEvent<Array<T>>(IndexedDBEventType.PENDING, 0, total, new Array<T>()))\r\n      );\r\n  }\r\n\r\n  /**\r\n   * connect observable use rxjs concat function(not Operator) then use scan operator\r\n   * return custom event(event: IndexedDBEvent)\r\n   * @param observables\r\n   */\r\n  private _concat_scan<T>(...observables: Array<Observable<IndexedDBEvent<T>>>): Observable<IndexedDBEvent<Array<T>>> {\r\n    const total = observables.length;\r\n    return concat(...observables)\r\n      .pipe(\r\n        scan<IndexedDBEvent<T>, IndexedDBEvent<Array<T>>>(\r\n          (acc: IndexedDBEvent<Array<T>>, value: IndexedDBEvent<T>): IndexedDBEvent<Array<T>> => {\r\n            if (value.type !== IndexedDBEventType.ERROR) {\r\n              acc.loaded++;\r\n              acc.data.push(value.data);\r\n              if (acc.loaded === acc.total) { acc.type = IndexedDBEventType.COMPLETE; }\r\n            } else {\r\n              acc.type = IndexedDBEventType.ERROR;\r\n              acc.loaded = 0;\r\n            }\r\n            return acc;\r\n          },\r\n          new IndexedDBEvent<Array<T>>(IndexedDBEventType.PENDING, 0, total, new Array<T>()))\r\n      );\r\n  }\r\n}\r\n\r\nexport interface IndexedDBStruct {\r\n  name: string;\r\n  optionalParameters: IDBObjectStoreParameters;\r\n  indexes: Array<{\r\n    name: string,\r\n    keyPath?: string,\r\n    options: IDBIndexParameters\r\n  }>;\r\n}\r\n/**\r\n * IndexedDB function return value\r\n * use to flag IndexedDB event status and loaded status\r\n */\r\nexport class IndexedDBEvent<T> {\r\n  type: IndexedDBEventType;\r\n  loaded: number;\r\n  total: number;\r\n  data: T;\r\n\r\n  constructor(type: IndexedDBEventType, loaded: number, total: number, data?: T) {\r\n    this.type = type;\r\n    this.loaded = loaded;\r\n    this.total = total;\r\n    this.data = data === undefined ? undefined : data;\r\n  }\r\n}\r\n\r\nexport enum IndexedDBEventType {\r\n  PENDING = 'Pending',\r\n  SUCCESS = 'Success',\r\n  ERROR = 'Error',\r\n  COMPLETE = 'Complete'\r\n}\r\n","export class Tree<T extends TreeableNode> {\r\n\r\n  private nodeMap: { [key: number]: Array<T> };\r\n  private nodes: Array<T>;\r\n  rootNode: TreeNode<T>;\r\n\r\n  constructor(nodes: Array<T>\r\n  ) {\r\n    this.nodes = nodes;\r\n\r\n    this.nodeMap = {};\r\n    this.initMap();\r\n    this.rootNode = this.generateTree();\r\n  }\r\n\r\n  /**\r\n   * çækey: ç¶èç¹id, value: ç¶èç¹idä¸ºkeyçèç¹çMap\r\n   */\r\n  private initMap(): void {\r\n    for (let i = 0; i < this.nodes.length; i++) {\r\n      const node = this.nodes[i];\r\n\r\n      if (!this.nodeMap[node.parentId]) { this.nodeMap[node.parentId] = []; }\r\n      this.nodeMap[node.parentId].push(node);\r\n    }\r\n  }\r\n\r\n  private generateTree(id: number = -1, data?: T, parentId: number = -1, type: string = 'root'): TreeNode<T> {\r\n    const node = new TreeNode<T>();\r\n    node.id       = id;\r\n    node.data     = data;\r\n    node.parentId = parentId;\r\n    node.type     = type;\r\n    node.children = [];\r\n\r\n    const children = this.nodeMap[id];\r\n    if (!children) { return node; }\r\n\r\n    for (let i = 0; i < children.length; i++) {\r\n      node.push(this.generateTree(children[i].id, children[i], id, children[i].type));\r\n    }\r\n    return node;\r\n  }\r\n\r\n  recursionChildNodes(parentId: number): Array<T> {\r\n    if (!this.nodeMap[parentId]) { return []; }\r\n    const arr = [];\r\n    for (let i = 0; i < this.nodeMap[parentId].length; i++) {\r\n      const node = this.nodeMap[parentId][i];\r\n      arr.push(node);\r\n      arr.push(...this.recursionChildNodes(node.id));\r\n    }\r\n    return arr;\r\n  }\r\n}\r\n\r\nexport class TreeNode<T extends TreeableNode> implements TreeableNode {\r\n\r\n  id: number;\r\n  parentId: number;\r\n  type: string;\r\n  children: Array<TreeNode<T>>;\r\n  data: T;\r\n\r\n  constructor(id?: number,\r\n              parentId?: number,\r\n              type?: string,\r\n              data?: T\r\n  ) {\r\n    this.id       = id;\r\n    this.parentId = parentId;\r\n    this.type     = type;\r\n    this.data     = data;\r\n  }\r\n\r\n  push(node: TreeNode<T>): TreeNode<T> {\r\n    this.children.push(node);\r\n    return node;\r\n  }\r\n}\r\n\r\nexport interface TreeableNode {\r\n  id: number;\r\n  parentId: number;\r\n  type: string;\r\n  [key: string]: any;\r\n}\r\n","import {Component, OnInit, Renderer2, ViewEncapsulation} from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {IndexedDB, IndexedDBEvent, IndexedDBEventType, IndexedDBStruct} from '../core/indexedDB/indexedDB';\r\nimport {Tree, TreeableNode} from '../core/tree/tree';\r\nimport {concatMap} from 'rxjs/operators';\r\nimport {of} from 'rxjs';\r\nimport {TreeNodeComponent} from '../tree/tree-node/tree-node.component';\r\n\r\n@Component({\r\n  selector: 'nb-file-browser',\r\n  templateUrl: './file-browser.component.html',\r\n  styleUrls: [\r\n    './file-browser.component.css'\r\n  ],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class FileBrowserComponent implements OnInit {\r\n\r\n  /**\r\n   * è¾å¥æ¡æ¨¡æ¿\r\n   */\r\n  private inputArea: HTMLInputElement;\r\n  /**\r\n   * ç¨äºåå§åçIndexedDBæ°æ®åºç»æ\r\n   */\r\n  private indexedDBStructs: Array<IndexedDBStruct> = [\r\n    {\r\n      name: 'markdown_article',\r\n      optionalParameters: {\r\n        keyPath: 'id',\r\n        autoIncrement: true\r\n      },\r\n      indexes: [\r\n        {\r\n          name: 'parentId',\r\n          keyPath: 'parentId',\r\n          options: {\r\n            unique: false\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n  private indexedDB: IndexedDB;\r\n  /**\r\n   * è¢«éæ©çèç¹\r\n   */\r\n  private selectedNode: {el: Element, data: TreeableNode};\r\n  fileTree: Tree<TreeableNode>;\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService,\r\n              private renderer: Renderer2\r\n  ) {\r\n    // åå»ºè¾å¥æ¡æ¨¡æ¿\r\n    const inputAreaLi: HTMLInputElement = renderer.createElement('LI');\r\n    this.renderer.addClass(inputAreaLi, 'fb-li');\r\n    this.renderer.addClass(inputAreaLi, 'fb-li_create');\r\n    const inputAreaI: HTMLElement = renderer.createElement('I');\r\n    this.renderer.addClass(inputAreaI, 'material-icons');\r\n    this.renderer.addClass(inputAreaI, 'md-18');\r\n    this.renderer.addClass(inputAreaI, 'md-dark');\r\n    this.renderer.appendChild(inputAreaI, this.renderer.createText('edit'));\r\n    const inputAreaInput: HTMLElement = renderer.createElement('INPUT');\r\n    this.renderer.addClass(inputAreaInput, 'fb-li_create-input');\r\n    this.renderer.appendChild(inputAreaLi, inputAreaI);\r\n    this.renderer.appendChild(inputAreaLi, inputAreaInput);\r\n\r\n    this.inputArea = inputAreaLi;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // è·åæ°æ®åºå®ä¾\r\n    IndexedDB.instenceof('ngr2-markdown-db', this.indexedDBStructs)\r\n      .subscribe(db => {\r\n        this.indexedDB = db;\r\n\r\n        const store = this.indexedDB.getObjectStore('markdown_article', 'readwrite');\r\n        // æ°æ®åºä¸ºç©ºé»è®¤æå¥ä¸¤æ¡æ°æ®\r\n        store.getCount()\r\n          .pipe(\r\n            concatMap(value => {\r\n              if (value.data === 0) {\r\n                return store.addAll([new Folder(), new Article()]);\r\n              }\r\n              return of(new IndexedDBEvent(IndexedDBEventType.COMPLETE, 1, 1));\r\n            })\r\n          )\r\n          .subscribe(value => {\r\n            // è·åæ°æ®åºä¸­çæææä»¶\r\n            this.refreshArticles().then(() => {\r\n              // æ¾å°æè¿ä¿®æ¹çArticle\r\n              const currentFile = this.fileTree.recursionChildNodes(-1)\r\n                .filter((file: TreeableNode) => file.type !== 'folder')\r\n                .reduce(\r\n                  (previousValue: Article, currentValue: Article) =>\r\n                    previousValue.lastModifiedTime > currentValue.lastModifiedTime ? previousValue : currentValue\r\n                );\r\n\r\n              // åéå½åçArticle\r\n              this.markdownService.currentFile.next(currentFile);\r\n              this.markdownService.reinitialization((currentFile as Article).content);\r\n            });\r\n          });\r\n      });\r\n  }\r\n\r\n  createFile(): void {\r\n    const prtId = this.selectedNode &&\r\n      (this.selectedNode.data.type === 'folder' ? this.selectedNode.data.id : this.selectedNode.data.parentId) ||\r\n      null;\r\n    const parent = this.selectedNode &&\r\n      (this.selectedNode.data.type === 'folder' ?\r\n        this.selectedNode.el.parentElement.querySelector('ul') : this.selectedNode.el.parentElement.parentElement) ||\r\n      null;\r\n\r\n    const cloneEl = this.inputArea.cloneNode(true);\r\n\r\n    if (!parent || !prtId || !cloneEl) { console.error('unable create file'); }\r\n\r\n    this.renderer.listen(cloneEl, 'keyup', (ev: KeyboardEvent) => {\r\n      switch (ev.code) {\r\n        case 'Enter':\r\n          this.indexedDB\r\n            .getObjectStore('markdown_article', 'readwrite')\r\n            .add(new Article(prtId, 'article', 'ce', (<HTMLInputElement> ev.target).value))\r\n            .subscribe(value => {\r\n              this.refreshArticles();\r\n              this.renderer.removeChild(parent, cloneEl);\r\n            });\r\n      }\r\n    });\r\n    this.renderer.appendChild(parent, cloneEl);\r\n    (<HTMLElement> cloneEl).querySelector('input').focus();\r\n  }\r\n\r\n  createFolder(): void {\r\n    if (this.selectedNode.data.type !== 'folder') { return; }\r\n\r\n    const prtId = this.selectedNode &&\r\n      this.selectedNode.data.id ||\r\n      null;\r\n    const parent = this.selectedNode &&\r\n      this.selectedNode.el.parentElement.querySelector('ul') ||\r\n      null;\r\n\r\n    const cloneEl = this.inputArea.cloneNode(true);\r\n\r\n    if (!parent || !prtId || !cloneEl) { console.error('unable create folder'); }\r\n\r\n    this.renderer.listen(cloneEl, 'keyup', (ev: KeyboardEvent) => {\r\n      switch (ev.code) {\r\n        case 'Enter':\r\n          this.indexedDB\r\n            .getObjectStore('markdown_article', 'readwrite')\r\n            .add(new Folder(prtId, 'folder', (<HTMLInputElement> ev.target).value))\r\n            .subscribe(value => {\r\n              this.refreshArticles();\r\n              this.renderer.removeChild(parent, cloneEl);\r\n            });\r\n      }\r\n    });\r\n    this.renderer.appendChild(parent, cloneEl);\r\n    (<HTMLElement> cloneEl).querySelector('input').focus();\r\n  }\r\n\r\n  rename(): void {\r\n    const parent = (this.selectedNode && this.selectedNode.el.parentElement) ||\r\n      null;\r\n\r\n    const type = this.selectedNode.data.type;\r\n\r\n    const cloneEl = this.inputArea.cloneNode(true);\r\n\r\n    this.renderer.listen(cloneEl, 'keyup', (ev: KeyboardEvent) => {\r\n      switch (ev.code) {\r\n        case 'Enter':\r\n          const value = (<HTMLInputElement> ev.target).value;\r\n          this.selectedNode.data[type === 'folder' ? 'name' : 'title'] = value;\r\n          this.indexedDB\r\n            .getObjectStore('markdown_article', 'readwrite')\r\n            .update(this.selectedNode.data)\r\n            .subscribe(() => {\r\n              this.refreshArticles();\r\n              this.renderer.removeChild(parent, cloneEl);\r\n              this.selectedNode = null;\r\n            });\r\n      }\r\n    });\r\n    parent.replaceChild(cloneEl, this.selectedNode.el);\r\n    (<HTMLElement> cloneEl.lastChild).focus();\r\n  }\r\n\r\n  delete(): void {\r\n    const children = this.fileTree.recursionChildNodes(this.selectedNode.data.id);\r\n    this.indexedDB.getObjectStore('markdown_article', 'readwrite')\r\n      .deleteAll(...children.map(value => value.id), this.selectedNode.data.id)\r\n      .subscribe(value => this.refreshArticles());\r\n  }\r\n\r\n  close(): void {\r\n    console.log('close');\r\n  }\r\n\r\n  select(el: HTMLElement, node: TreeableNode): void {\r\n\r\n    if (this.selectedNode) {\r\n      if (this.selectedNode.el === el) {\r\n        this.selectedNode.el.classList.remove('fb-li_selected');\r\n        this.selectedNode = null;\r\n      } else {\r\n        el.classList.add('fb-li_selected');\r\n        this.selectedNode.el.classList.remove('fb-li_selected');\r\n        this.selectedNode = {el, data: node};\r\n      }\r\n    } else {\r\n      el.classList.add('fb-li_selected');\r\n      this.selectedNode = {el, data: node};\r\n    }\r\n    console.log(this.selectedNode);\r\n  }\r\n\r\n  open(el: HTMLElement, node: TreeableNode): void {\r\n    this._save(this.markdownService.currentFile.value);\r\n    this.markdownService.reinitialization(node.content);\r\n    this.markdownService.currentFile.next(node);\r\n  }\r\n\r\n  expanded(treeNode: TreeNodeComponent) {\r\n    const data = <Folder> treeNode.data.data;\r\n    data.isExpanded = treeNode.isExpanded;\r\n    this.indexedDB.getObjectStore('markdown_article', 'readwrite')\r\n      .update(data)\r\n      .subscribe(value => console.log(value));\r\n  }\r\n\r\n  private _save(data: TreeableNode) {\r\n    (data as Article).content = this.markdownService.originMd.value;\r\n    this.indexedDB\r\n      .getObjectStore('markdown_article', 'readwrite')\r\n      .update(data)\r\n      .subscribe(() => {\r\n        this.refreshArticles();\r\n        console.log('save success');\r\n      });\r\n  }\r\n  private refreshArticles(): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      this.indexedDB.getObjectStore('markdown_article', 'readwrite')\r\n        .getAll<any>()\r\n        .subscribe(value => {\r\n          if (value.type === IndexedDBEventType.COMPLETE) {\r\n            console.log(value);\r\n            this.fileTree = new Tree(value.data);\r\n            resolve(value);\r\n          }\r\n        }, error => reject(error));\r\n    });\r\n  }\r\n}\r\n\r\nexport class Article implements TreeableNode {\r\n  static AUTHOR   = 'Author';\r\n  static TITLE    = 'Default Title';\r\n  static CONTENT  = '# Default Title';\r\n\r\n  id: number;\r\n  parentId: number;\r\n  type: string;\r\n  author: string;\r\n  title: string;\r\n  content: string;\r\n  createTime: Date;\r\n  lastModifiedTime: Date;\r\n\r\n  constructor(parentId: number  = -1,\r\n              type: string      = 'article',\r\n              author: string    = Article.AUTHOR,\r\n              title: string     = Article.TITLE,\r\n              content: string   = Article.CONTENT,\r\n  ) {\r\n    this.parentId         = parentId;\r\n    this.type             = type;\r\n    this.author           = author;\r\n    this.title            = title;\r\n    this.content          = content;\r\n    this.createTime       = new Date();\r\n    this.lastModifiedTime = this.createTime;\r\n  }\r\n}\r\n\r\nexport class Folder implements TreeableNode {\r\n  static NAME = 'folderName';\r\n\r\n  id: number;\r\n  parentId: number;\r\n  type: string;\r\n  name: string;\r\n  isExpanded: boolean;\r\n\r\n  constructor(parentId: number    = -1,\r\n              type: string        = 'folder',\r\n              name: string        = Folder.NAME,\r\n              isExpanded: boolean = true\r\n  ) {\r\n    this.parentId   = parentId;\r\n    this.type       = type;\r\n    this.name       = name;\r\n    this.isExpanded = isExpanded;\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {filter} from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'nb-status-bar',\r\n  templateUrl: './status-bar.component.html',\r\n  styleUrls: ['./status-bar.component.css']\r\n})\r\nexport class StatusBarComponent implements OnInit {\r\n\r\n  mdInfo;\r\n  htmlInfo;\r\n  fileInfo;\r\n\r\n  constructor(private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.markdownService.observeMarkdown()\r\n      .subscribe(allinfo => {\r\n        this.mdInfo   = allinfo.Markdown;\r\n        this.htmlInfo = allinfo.HTML;\r\n      });\r\n\r\n    this.markdownService.currentFile\r\n      .subscribe(info => this.fileInfo = info);\r\n  }\r\n\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'nb-control-bar',\r\n  templateUrl: './control-bar.component.html',\r\n  styleUrls: ['./control-bar.component.css']\r\n})\r\nexport class ControlBarComponent implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\r\nimport {FileOperatorImpl} from '../core/fileOperator';\r\n\r\n@Component({\r\n  selector: 'nb-menu',\r\n  templateUrl: './menu.component.html',\r\n  styleUrls: ['./menu.component.css']\r\n})\r\nexport class MenuComponent implements OnInit {\r\n\r\n  private fileOperator: FileOperatorImpl;\r\n  constructor(private markdownService: Ngr2MarkdownService\r\n  ) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fileOperator = new FileOperatorImpl();\r\n  }\r\n\r\n  downloadMarkdown() {\r\n    const unsubscribe = this.markdownService.observeMarkdown()\r\n      .subscribe(value => {\r\n        console.log(value);\r\n        const file = new Blob([value.Markdown.text], {type: 'text/plain'});\r\n        const dataUrl = this.fileOperator.toDataURLSync(file);\r\n        const anchor: HTMLAnchorElement = <HTMLAnchorElement> document.createElement('A');\r\n        anchor.download = 'Markdown.md';\r\n        anchor.href = dataUrl;\r\n        anchor.click();\r\n      });\r\n    unsubscribe.unsubscribe();\r\n  }\r\n\r\n  downloadHTML() {\r\n    const unsubscribe = this.markdownService.observeMarkdown()\r\n      .subscribe(value => {\r\n        const htmlWindow = window.open('', '');\r\n        document.head.querySelectorAll('meta, style').forEach(el => {\r\n          htmlWindow.document.head.innerHTML += el.outerHTML;\r\n        });\r\n        htmlWindow.document.body.innerHTML = `<article class=\"markdown-body\" style=\"font-size: 14px;height: auto;overflow: visible;\">`\r\n          + value.HTML.text\r\n          + `</article>`;\r\n        const html = htmlWindow.document.documentElement.innerHTML;\r\n        htmlWindow.close();\r\n\r\n        const file = new Blob([html], {type: 'text/html'});\r\n        const dataUrl = this.fileOperator.toDataURLSync(file);\r\n        const anchor: HTMLAnchorElement = <HTMLAnchorElement> document.createElement('A');\r\n        anchor.download = 'HTML.html';\r\n        anchor.href = dataUrl;\r\n        anchor.click();\r\n      });\r\n    unsubscribe.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   */\r\n  downloadPDF() {\r\n    const unsubscribe = this.markdownService.observeMarkdown()\r\n      .subscribe(value => {\r\n        const htmlWindow = window.open('', '');\r\n        document.head.querySelectorAll('meta, style').forEach(el => {\r\n          htmlWindow.document.head.innerHTML += el.outerHTML;\r\n        });\r\n        htmlWindow.document.body.innerHTML = `<article class=\"markdown-body\" style=\"font-size: 14px;height: auto;overflow: visible;\">`\r\n          + value.HTML.text\r\n          + `</article>`;\r\n        htmlWindow.print();\r\n        htmlWindow.close();\r\n      });\r\n    unsubscribe.unsubscribe();\r\n  }\r\n}\r\n","import {fromEvent, merge, Observable} from 'rxjs';\r\nimport {filter, map, tap, throttleTime} from 'rxjs/operators';\r\n\r\nexport enum DragAndDropEventType {\r\n  DRAG_START = 'dragstart',\r\n  DRAG = 'drag',\r\n  DRAG_END = 'dragend',\r\n  DRAG_ENTER = 'dragenter',\r\n  DRAG_OVER = 'dragover',\r\n  DRAG_LEAVE = 'dragleave',\r\n  DROP = 'drop'\r\n}\r\n\r\nexport interface DragAndDropEventOptions {\r\n  eventType: DragAndDropEventType;\r\n  listener?: (event: DragEvent) => void | boolean;\r\n  preventDefault?: boolean;\r\n  stopPropagation?: boolean;\r\n  operatorOptions?: {\r\n    throttleTime?: number,\r\n    filter?: (event: DragEvent) => boolean\r\n  };\r\n  eventOptions?: EventListenerOptions;\r\n}\r\n\r\n// @dynamic\r\nexport class DragAndDropEvent {\r\n\r\n  /* tslint:disable */\r\n  static defaultFun = event => { console.group('on ' + event.type); console.groupEnd(); };\r\n  static ALL_OPTIONS: { [key: string]: DragAndDropEventOptions } = {\r\n    'dragstart': {\r\n      eventType: DragAndDropEventType.DRAG_START,\r\n      listener: DragAndDropEvent.defaultFun\r\n    },\r\n    'drag': {\r\n      eventType: DragAndDropEventType.DRAG,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      operatorOptions: {\r\n        throttleTime: 1000\r\n      }\r\n    },\r\n    'dragend': {\r\n      eventType: DragAndDropEventType.DRAG_END,\r\n      listener: DragAndDropEvent.defaultFun,\r\n    },\r\n    'dragenter': {\r\n      eventType: DragAndDropEventType.DRAG_ENTER,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      preventDefault: true\r\n    },\r\n    'dragover': {\r\n      eventType: DragAndDropEventType.DRAG_OVER,\r\n      listener: DragAndDropEvent.defaultFun,\r\n      operatorOptions: {\r\n        throttleTime: 100\r\n      },\r\n      preventDefault: true\r\n    },\r\n    'drop': {\r\n      eventType: DragAndDropEventType.DROP,\r\n      listener: DragAndDropEvent.defaultFun\r\n    }\r\n  };\r\n\r\n  el: Element;\r\n  observable: Observable<DragEvent>;\r\n  options: { [key: string]: DragAndDropEventOptions };\r\n  /*tslint:enable*/\r\n\r\n  // listeners: { [key: string]: (event: DragEvent) => void | boolean };\r\n  // ondragstart:  (event: DragEvent) => void | boolean;\r\n  // ondrag:       (event: DragEvent) => void | boolean;\r\n  // ondragend:    (event: DragEvent) => void | boolean;\r\n  // ondragenter:  (event: DragEvent) => void | boolean;\r\n  // ondragover:   (event: DragEvent) => void | boolean;\r\n  // ondragleave:  (event: DragEvent) => void | boolean;\r\n  // ondrop:       (event: DragEvent) => void | boolean;\r\n\r\n  constructor(el: Element,\r\n              eventOptions: { [key: string]: DragAndDropEventOptions } = DragAndDropEvent.ALL_OPTIONS,\r\n              interceptor?: (event: DragEvent) => boolean\r\n  ) {\r\n    this.el       = el;\r\n    this.options  = eventOptions;\r\n\r\n    this.observable = this.initEvent(interceptor);\r\n  }\r\n\r\n  private initEvent(interceptor?: (event: DragEvent) => boolean): Observable<DragEvent> {\r\n    const observables = Object.getOwnPropertyNames(this.options)\r\n      .reduce<Array<Observable<DragEvent>>>((previousValue, currentValue) => {\r\n        const option = this.options[currentValue];\r\n\r\n        let eventObservable = this.addEventListener(this.el, option);\r\n\r\n        eventObservable = this.addListenFunction(eventObservable, option);\r\n\r\n        previousValue.push(eventObservable);\r\n\r\n        return previousValue;\r\n      }, []);\r\n\r\n    return merge(...observables);\r\n  }\r\n\r\n  private addEventListener(el: Element,\r\n                           option: DragAndDropEventOptions,\r\n                           resultSelector: ((...args: any[]) => any) = (args => args)\r\n  ): Observable<DragEvent> {\r\n    let observable = fromEvent(el, option.eventType, option.eventOptions, resultSelector);\r\n\r\n    observable = this.eventOptions(observable, option);\r\n    observable = this.streamOperator(observable, option);\r\n\r\n    return observable;\r\n  }\r\n\r\n  private addListenFunction(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    if (!option.listener) {\r\n      return observable;\r\n    }\r\n    return observable.pipe(\r\n      tap(option.listener)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®optionè®¾ç½®Eventå¯¹è±¡ä¸çæ¹æ³æå±æ§\r\n   * @param observable\r\n   * @param option\r\n   */\r\n  private eventOptions(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    return observable\r\n      .pipe(\r\n        map((event: DragEvent) => {\r\n          if (option.preventDefault) { event.preventDefault(); }\r\n          if (option.stopPropagation) { event.stopPropagation(); event.cancelBubble = true; }\r\n          return event;\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®optionå¯¹äºä»¶æµè¿è¡optionä¸­è®¾ç½®æä½\r\n   * @param observable\r\n   * @param option\r\n   */\r\n  private streamOperator(observable: Observable<DragEvent>, option: DragAndDropEventOptions): Observable<DragEvent> {\r\n    if (!option.operatorOptions) { return observable; }\r\n    const operator = option.operatorOptions;\r\n\r\n    if (operator.throttleTime && operator.throttleTime > 0) {\r\n      observable = observable\r\n        .pipe(throttleTime(operator.throttleTime));\r\n    }\r\n    if (operator.filter) {\r\n      observable = observable\r\n        .pipe(filter(operator.filter));\r\n    }\r\n\r\n    return observable;\r\n  }\r\n}\r\n","import {DragAndDropContainer} from './dragAndDropContainer';\r\nimport {DragAndDropEvent, DragAndDropEventType} from './dragAndDropEvent';\r\n\r\nexport class DragAndDropElement {\r\n\r\n  static ELEMENT_STYLE: CSSStyle = {\r\n    // cursor: 'grab'\r\n  };\r\n  static DEMO_STYLE: CSSStyle = {\r\n    opacity: '0.5'\r\n  };\r\n\r\n  // å³ä¸, å·¦ä¸, å·¦ä¸, å³ä¸åå«å¯¹åºçè§åº¦å¼\r\n  diagonal: {\r\n    RT_ANGLE,\r\n    LT_ANGLE,\r\n    LB_ANGLE,\r\n    RB_ANGLE\r\n  } = {\r\n    RT_ANGLE: Math.PI / 4,\r\n    LT_ANGLE: Math.PI / 4 * 3,\r\n    LB_ANGLE: Math.PI / 4 * 3 * -1,\r\n    RB_ANGLE: Math.PI / 4 * -1\r\n  };\r\n\r\n  private _el: HTMLElement;\r\n  private _parent: HTMLElement;\r\n  private _dadEvent: DragAndDropEvent;\r\n  parentContainer: DragAndDropContainer;\r\n  status: DragAndDropStatus;\r\n  clone: HTMLElement;\r\n  centerPoint: Point;\r\n  get clientRect(): ClientRect | DOMRect {\r\n    return this._el.getBoundingClientRect();\r\n  }\r\n\r\n  constructor (element: HTMLElement,\r\n               parentContainer: DragAndDropContainer,\r\n               elementStyle: CSSStyle = DragAndDropElement.ELEMENT_STYLE,\r\n               demoStyle: CSSStyle = DragAndDropElement.DEMO_STYLE,\r\n  ) {\r\n    this._el =                element               || null;\r\n    this.parentContainer =    parentContainer       || null;\r\n\r\n    this._parent  = this._el && this._el.parentElement                          || null;\r\n    this.clone    = this._el && (<HTMLElement> this._el.cloneNode(true))  || null;\r\n    Object.getOwnPropertyNames(elementStyle)\r\n      .forEach(value => {\r\n        this._el.style[value] = elementStyle[value];\r\n      });\r\n    Object.getOwnPropertyNames(demoStyle)\r\n      .forEach(value => {\r\n        this.clone.style[value] = demoStyle[value];\r\n      });\r\n\r\n    // set draggable property\r\n    this._el.draggable = true;\r\n    // add drag and drop event handler\r\n    this._dadEvent = new DragAndDropEvent(this._el,\r\n      {\r\n        'dragstart': {\r\n          eventType: DragAndDropEventType.DRAG_START,\r\n          stopPropagation: true,\r\n          listener: this.ondragstart.bind(this)\r\n        },\r\n        'drag': {\r\n          eventType: DragAndDropEventType.DRAG,\r\n          stopPropagation: true,\r\n          listener: this.ondrag.bind(this),\r\n          operatorOptions: {\r\n            throttleTime: 1000\r\n          }\r\n        },\r\n        'dragend': {\r\n          eventType: DragAndDropEventType.DRAG_END,\r\n          stopPropagation: true,\r\n          listener: this.ondragend.bind(this),\r\n        },\r\n        'dragenter': {\r\n          eventType: DragAndDropEventType.DRAG_ENTER,\r\n          listener: this.ondragenter.bind(this),\r\n          preventDefault: true,\r\n          operatorOptions: {\r\n            filter: (event) => {\r\n              if (!this.parentContainer.equals(event)) {\r\n                return false;\r\n              }\r\n              return this._el !== this.parentContainer.getDragElement()._el && this._el === event.target;\r\n            }\r\n          }\r\n        },\r\n        'dragover': {\r\n          eventType: DragAndDropEventType.DRAG_OVER,\r\n          listener: this.ondragover.bind(this),\r\n          operatorOptions: {\r\n            throttleTime: 100,\r\n            filter: (event) => {\r\n              if (!this.parentContainer.equals(event)) {\r\n                return false;\r\n              }\r\n              return this._el !== this.parentContainer.getDragElement()._el;\r\n            }\r\n          },\r\n          preventDefault: true\r\n        },\r\n        'drop': {\r\n          eventType: DragAndDropEventType.DROP,\r\n          stopPropagation: true,\r\n          listener: this.ondrop.bind(this)\r\n        }\r\n      });\r\n    this._dadEvent.observable\r\n      .subscribe(value => {});\r\n\r\n    // initial\r\n    this.status = 'none';\r\n    const rect = this.clientRect;\r\n    this.centerPoint = new Point((rect.left + rect.width / 2),\r\n      (rect.top + rect.height / 2));\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   */\r\n  reset(): void {\r\n    this.transitDemonstrationFinish(this.parentContainer.getDragElement());\r\n  }\r\n\r\n  /**\r\n   * drag start\r\n   * ç¨æ·å¼å§æå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragstart(ev: DragEvent) {\r\n    console.group('on drop start');\r\n    this.status = 'drag';\r\n    this.parentContainer.setDragElement(this, ev);\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag\r\n   * ç¨æ·æ­£å¨æå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondrag(ev: DragEvent) {\r\n    console.group('on drag');\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag end\r\n   * ç¨æ·ç»ææå¨æ¬åç´ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragend(ev: DragEvent) {\r\n    console.group('on drag end');\r\n    this.status = 'none';\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag enter\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , è¿å¥æ¬åç´ çå®¹å¨èå´æ¶è§¦å\r\n   * [ç®æ æ¾ç½®è¯´æ]{@link https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API/Drag_operations#droptargets}\r\n   * @param ev - emit event\r\n   */\r\n  private ondragenter(ev: DragEvent) {\r\n    if (!(this.parentContainer.getDragElement()._parent === this._parent && this._el === ev.target)) { return; }\r\n    if (this._el === this.parentContainer.getDragElement()._el) { return; }\r\n    console.group('on drag enter');\r\n    this.status = 'drop';\r\n    this.parentContainer.setDropElement(this);\r\n    const rect = this.clientRect;\r\n    this.diagonal.RT_ANGLE = Math.atan2(rect.height / 2, rect.width / 2);\r\n    this.diagonal.LT_ANGLE = Math.PI - this.diagonal.RT_ANGLE;\r\n    this.diagonal.LB_ANGLE = -this.diagonal.LT_ANGLE;\r\n    this.diagonal.RB_ANGLE = -this.diagonal.RT_ANGLE;\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag over\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , å¨æ¬åç´ çå®¹å¨èå´åæ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragover(ev: DragEvent) {\r\n    console.group('on drag over');\r\n    this.transitDemonstration(this.parentContainer.getDragElement(), new Point(ev.clientX, ev.clientY));\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * drag leave\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , ç¦»å¼æ¬åç´ çå®¹å¨èå´æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondragleave(ev: DragEvent) {\r\n    console.group('on drag leave');\r\n    this.status = 'none';\r\n    this.transitDemonstrationFinish(this.parentContainer.getDragElement());\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drag exit\r\n   * å½æ¬åç´ åå¾ä¸åå¯æå¨æ¶è§¦å\r\n   * @deprecated\r\n   * [æªè¢«ä»»ä½æµè§å¨å®ç°]{@link https://developer.mozilla.org/zh-CN/docs/Web/API/Document/dragexit_event}\r\n   * @param ev - emit event\r\n   */\r\n  private ondragexit(ev: DragEvent) {\r\n    console.group('on drag exit');\r\n    console.groupEnd();\r\n  }\r\n\r\n  /**\r\n   * drop\r\n   * å½å¦ä¸ä¸ªè¢«æå¨çåç´ , å¨æ¬åç´ çå®¹å¨èå´åéæ¾é¼ æ æ¶è§¦å\r\n   * @param ev - emit event\r\n   */\r\n  private ondrop(ev: DragEvent) {\r\n    console.group('on drop');\r\n    this.status = 'drop';\r\n    this.replaceElement(this.parentContainer.getDragElement()._el, this.parentContainer.getDragElement().clone);\r\n    console.groupEnd();\r\n  }\r\n\r\n  private insertBefore(el: Element): Element {\r\n    return this._parent.insertBefore(el, this._el);\r\n  }\r\n\r\n  /**\r\n   * `nextElementSibling`: ie8,ie9,safariä¸å¼å®¹\r\n   * è§: https://developer.mozilla.org/en-US/docs/Web/API/NonDocumentTypeChildNode/nextElementSibling\r\n   * @param el - insert element\r\n   * @return - return inserted element\r\n   */\r\n  private insertAfter(el: Element): Element {\r\n    if (!this._el.nextElementSibling) {\r\n      return this._parent.appendChild(el);\r\n    }\r\n    return this._parent.insertBefore(el, this._el.nextElementSibling);\r\n  }\r\n\r\n  private computeDirection(point: Point): DragAndDropDirection {\r\n    this.centerPoint = new Point((this.clientRect.left + this.clientRect.width / 2),\r\n      (this.clientRect.top + this.clientRect.height / 2));\r\n    point.relaitiveTo(this.centerPoint);\r\n    const angle = Math.atan2(point.Y, point.X);\r\n    if (angle >= this.diagonal.RT_ANGLE && angle < this.diagonal.LT_ANGLE) {\r\n      return 'top';\r\n    } else if (angle >= this.diagonal.LT_ANGLE || angle < this.diagonal.LB_ANGLE) {\r\n      return 'left';\r\n    } else if (angle >= this.diagonal.LB_ANGLE && angle < this.diagonal.RB_ANGLE) {\r\n      return 'bottom';\r\n    } else {\r\n      return 'right';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ¼ç¤ºé¼ æ æå¨åç´ éæ¾åçç¶æ\r\n   */\r\n  private transitDemonstration(draggedEl: DragAndDropElement, point: Point) {\r\n    const dir = this.computeDirection(point);\r\n    if ( dir === 'top' || dir === 'left') {\r\n      this.insertBefore(draggedEl._el);\r\n    } else if (dir === 'bottom' || dir === 'right') {\r\n      this.insertAfter(draggedEl._el);\r\n    }\r\n    console.log(dir);\r\n  }\r\n\r\n  /**\r\n   * æ¼ç¤ºç»æ, ç§»é¤åç´ \r\n   */\r\n  private transitDemonstrationFinish(dragElement: DragAndDropElement) {\r\n    this.removeElement(dragElement._el);\r\n  }\r\n\r\n  private removeElement(el: Element): Element {\r\n    for (let i = 0; i < this._parent.children.length; i++) {\r\n      if (this._parent.children[i] === el) {\r\n        this._parent.removeChild(el);\r\n        return el;\r\n      }\r\n    }\r\n  }\r\n\r\n  private replaceElement(newEl: Element, oldEl: Element): Element {\r\n    for (let i = 0; i < this._parent.children.length; i++) {\r\n      if (this._parent.children[i] === oldEl) {\r\n        this._parent.replaceChild(newEl, oldEl);\r\n        return oldEl;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass Point {\r\n  X: number;\r\n  Y: number;\r\n\r\n  constructor(X: number,\r\n              Y: number\r\n  ) {\r\n    this.X = X || null;\r\n    this.Y = Y || null;\r\n  }\r\n\r\n  relaitiveTo(relato: Point) {\r\n    this.X -= relato.X;\r\n    this.Y = relato.Y - this.Y;\r\n  }\r\n}\r\n\r\ntype DragAndDropStatus = 'none' | 'drag' | 'dragOver' | 'drop';\r\ntype DragAndDropDirection = 'top' | 'bottom' | 'left' | 'right' | 'center';\r\ntype CSSStyle = {\r\n  [P in keyof CSSStyleDeclaration]?: CSSStyleDeclaration[P];\r\n};\r\n","import {DragAndDropElement} from './dragAndDrop';\r\nimport {DragAndDropEvent, DragAndDropEventType} from './dragAndDropEvent';\r\nimport {assertNumber} from '@angular/core/src/render3/assert';\r\n\r\nexport class DragAndDropContainer {\r\n\r\n  private _el: HTMLElement;\r\n  private _children: HTMLCollection;\r\n  private _dragEl: DragAndDropElement;\r\n  private _dropEl: DragAndDropElement;\r\n  private _dadEvent: DragAndDropEvent;\r\n  private id: number;\r\n  DADChildren: Array<DragAndDropElement>;\r\n\r\n  constructor(element: HTMLElement\r\n  ) {\r\n    this._el =        element           || null;\r\n    this._children =  element.children  || null;\r\n\r\n    this.DADChildren = [];\r\n    for (let i = 0; i < this._children.length; i++) {\r\n      const el = new DragAndDropElement(\r\n        (<HTMLElement> this._children[i]),\r\n        this\r\n      );\r\n      this.DADChildren.push(el);\r\n    }\r\n  }\r\n\r\n  setDragElement(dragEl: DragAndDropElement, ev: DragEvent): void {\r\n    this._dragEl = dragEl;\r\n    this.id = new Date().getTime();\r\n    ev.dataTransfer.setData('text/containerid:' + this.id.toString(10), this.id.toString(10));\r\n  }\r\n\r\n  getDragElement(): DragAndDropElement {\r\n    return this._dragEl;\r\n  }\r\n\r\n  setDropElement(dropEl: DragAndDropElement): void {\r\n    this._dropEl = dropEl;\r\n  }\r\n\r\n  getDropElement(): DragAndDropElement {\r\n    return this._dropEl;\r\n  }\r\n\r\n  equals(ev: DragEvent): boolean {\r\n    let id = ev.dataTransfer.types[ev.dataTransfer.types.length - 1];\r\n\r\n    if (!id) { return false; }\r\n\r\n    id = id.split(':')[1];\r\n    return this.id === Number.parseInt(id, 10);\r\n  }\r\n}\r\n","import {AfterViewInit, Directive, ElementRef, OnInit} from '@angular/core';\r\nimport {DragAndDropContainer} from './core/dad/dragAndDropContainer';\r\n\r\n@Directive({\r\n  selector: '[nbDragAndDrop]'\r\n})\r\nexport class DragAndDropDirective implements OnInit, AfterViewInit {\r\n\r\n  private DADContainer: DragAndDropContainer;\r\n\r\n  constructor(\r\n    private el: ElementRef\r\n  ) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.DADContainer = new DragAndDropContainer(this.el.nativeElement);\r\n  }\r\n}\r\n","import {\n  Directive, HostListener, TemplateRef,\n  ViewContainerRef\n} from '@angular/core';\nimport {TreeNodeComponent} from '../tree-node/tree-node.component';\n\n\n@Directive({\n  selector: '[nbTreeNodeOutlet]'\n})\nexport class TreeNodeOutletDirective {\n\n  constructor(public viewContainer: ViewContainerRef\n  ) {\n  }\n}\n\n@Directive({\n  selector: '[nbTreeNodeDef]'\n})\nexport class TreeNodeDefDirective {\n\n  constructor(\n    public templateRef: TemplateRef<any>\n  ) {\n    // view.createEmbeddedView(template);\n  }\n}\n","import {\n  Component,\n  ContentChildren,\n  Input, IterableDiffer, IterableDiffers,\n  OnInit, QueryList,\n  ViewChild, ViewContainerRef\n} from '@angular/core';\nimport {Tree, TreeableNode, TreeNode} from '../../core/tree/tree';\nimport {Article} from '../../file-browser/file-browser.component';\nimport {TreeNodeDefDirective, TreeNodeOutletDirective} from '../tree-node-directive/tree-node-def.directive';\nimport {TreeNodeComponent} from '../tree-node/tree-node.component';\n\n@Component({\n  selector: 'nb-tree',\n  templateUrl: './tree.component.html',\n  styleUrls: ['./tree.component.css']\n})\nexport class TreeComponent implements OnInit {\n\n  @ViewChild(TreeNodeOutletDirective) outlet: TreeNodeOutletDirective;\n  @ContentChildren(TreeNodeDefDirective) def: QueryList<TreeNodeDefDirective>;\n\n  private _ds: Tree<Article>;\n  private _dataDiffer: IterableDiffer<TreeNode<TreeableNode>>;\n\n  @Input()\n  set dataSource(ds: Tree<Article>) {\n    if (!ds) { return; }\n    this._ds = ds;\n    this.renderNodeChanges(this._ds.rootNode.children, this._dataDiffer, this.outlet.viewContainer);\n  }\n  get dataSource() {\n    return this._ds;\n  }\n\n  constructor(private differs: IterableDiffers) {\n    this._dataDiffer = differs.find([])\n      .create((index, item) => item);\n  }\n\n  ngOnInit() {\n  }\n\n  renderNodeChanges(data: Array<TreeNode<TreeableNode>>,\n                    dataDiffer: IterableDiffer<TreeNode<TreeableNode>> = this._dataDiffer,\n                    viewContainer: ViewContainerRef = this.outlet.viewContainer) {\n    const changes = dataDiffer.diff(data);\n    if (!changes) { return; }\n\n    changes.forEachOperation((record, previousIndex, currentIndex) => {\n      // console.log(record.previousIndex, previousIndex, record.currentIndex, currentIndex);\n      if (record.previousIndex === null) {\n        viewContainer.createEmbeddedView(this.def.first.templateRef, record.item, currentIndex);\n        TreeControl.mostRecentTreeNode.data = record.item;\n      } else if (currentIndex === null) {\n        viewContainer.remove(previousIndex);\n      } else {\n        const view = viewContainer.get(previousIndex);\n        viewContainer.move(view, currentIndex);\n      }\n    });\n  }\n}\n\nexport class TreeControl {\n  static mostRecentTreeNode: TreeNodeComponent | null = null;\n}\n","import {\n  AfterContentInit,\n  Component,\n  ContentChild,\n  Input,\n  IterableDiffer,\n  IterableDiffers,\n  OnInit\n} from '@angular/core';\nimport {TreeableNode, TreeNode} from '../../core/tree/tree';\nimport {TreeNodeOutletDirective} from '../tree-node-directive/tree-node-def.directive';\nimport {TreeComponent, TreeControl} from '../tree/tree.component';\n\n@Component({\n  selector: 'nb-tree-node',\n  templateUrl: './tree-node.component.html',\n  styleUrls: ['./tree-node.component.css']\n})\nexport class TreeNodeComponent implements OnInit, AfterContentInit {\n\n  private _dataDiffer: IterableDiffer<TreeNode<TreeableNode>>;\n\n  @Input()\n  get isExpanded() { return this._isExpanded; }\n  set isExpanded(value: boolean) {\n    console.log('isExpanded');\n    this._isExpanded = value;\n    if (this.isExpanded) {\n      this.updateChildrenNodes();\n    } else {\n      this.outlet.viewContainer.clear();\n      this._dataDiffer.diff([]);\n    }\n  }\n  private _isExpanded: boolean;\n\n  /**\n   * æ èç¹çæ°æ®\n   */\n  get data(): TreeNode<TreeableNode> { return this._data; }\n  set data(value: TreeNode<TreeableNode>) {\n    this._data = value;\n  }\n  private _data: TreeNode<TreeableNode>;\n\n  @ContentChild(TreeNodeOutletDirective) outlet: TreeNodeOutletDirective;\n\n  constructor(private _tree: TreeComponent,\n              private _differs: IterableDiffers\n  ) {\n    TreeControl.mostRecentTreeNode = this;\n    this._dataDiffer = this._differs.find([]).create();\n  }\n\n  ngOnInit() {\n    // this._tree.renderNodeChanges(this.data.children, this._dataDiffer, this.outlet.viewContainer);\n  }\n\n  ngAfterContentInit(): void {\n  }\n\n  updateChildrenNodes() {\n    this._tree.renderNodeChanges(this.data.children, this._dataDiffer, this.outlet.viewContainer);\n  }\n}\n","import {Directive, EventEmitter, HostListener, Input, Output} from '@angular/core';\nimport {TreeNodeComponent} from '../tree-node/tree-node.component';\n\n@Directive({\n  selector: '[nbTreeNodeToggle]'\n})\nexport class TreeNodeToggleDirective {\n\n  @HostListener('dblclick', ['$event'])\n  toggle(event: Event) {\n    this.treeNode.isExpanded = !this.treeNode.isExpanded;\n    event.preventDefault();\n    this.callbackFn.emit(this.treeNode);\n  }\n\n  @Output() callbackFn = new EventEmitter<TreeNodeComponent>();\n\n  constructor(private treeNode: TreeNodeComponent) {\n    console.log(treeNode);\n  }\n\n}\n","import {Directive, ElementRef, HostListener, Input, OnDestroy, OnInit} from '@angular/core';\nimport {Ngr2MarkdownService} from '../service/ngr2-markdown.service';\nimport {SyncScroll} from '../core/syncScroll';\nimport {Subscription} from 'rxjs';\n\n@Directive({\n  selector: '[nbSyncScroll]'\n})\nexport class SyncScrollDirective implements OnInit, OnDestroy {\n\n  static mutexLock = false;\n\n  @HostListener('scroll', ['$event']) scroll = this.onScroll;\n\n  @Input() syncScrollInfo: SyncScroll;\n\n  private _el: HTMLElement;\n  private subscription: Subscription;\n\n  constructor(private markdownService: Ngr2MarkdownService,\n              el: ElementRef\n  ) {\n    this._el = el.nativeElement;\n  }\n\n  ngOnInit(): void {\n    this.subscription = this.markdownService.syncScroll\n      .subscribe((value) => {\n        if (!value || value.headingInfo.el === this._el) { return; }\n\n        const curHeading = this.syncScrollInfo.getPairHeading(value.headingInfo.pairId);\n        const deltaHeight = value.scrollTop - value.headingInfo.offsetTop;\n        this._el.scrollTop = curHeading.headingInfo.offsetTop + (curHeading.headingInfo.height / value.headingInfo.height) * deltaHeight;\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.subscription.unsubscribe();\n  }\n\n  onScroll(event: Event) {\n    if (SyncScrollDirective.mutexLock) {\n      SyncScrollDirective.mutexLock = false;\n    } else {\n    this.markdownService.syncScroll.next(this.syncScrollInfo.currentHeading());\n      SyncScrollDirective.mutexLock = true;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { Ngr2MarkdownComponent } from './ngr2-markdown.component';\r\nimport { SideTocComponent } from './side-toc/side-toc.component';\r\nimport { HTMLPipePipe } from './pipe/htmlpipe.pipe';\r\nimport {BrowserModule} from '@angular/platform-browser';\r\nimport { MdPipe } from './pipe/md.pipe';\r\nimport { ToolBarComponent } from './tool-bar/tool-bar.component';\r\nimport { EditBoxComponent } from './edit-box/edit-box.component';\r\nimport { FileBrowserComponent } from './file-browser/file-browser.component';\r\nimport { StatusBarComponent } from './status-bar/status-bar.component';\r\nimport { ControlBarComponent } from './control-bar/control-bar.component';\r\nimport { MenuComponent } from './menu/menu.component';\r\nimport { DragAndDropDirective } from './drag-and-drop.directive';\r\nimport { TreeComponent } from './tree/tree/tree.component';\r\nimport { TreeNodeComponent } from './tree/tree-node/tree-node.component';\r\nimport { TreeNodeDefDirective, TreeNodeOutletDirective } from './tree/tree-node-directive/tree-node-def.directive';\r\nimport {TreeNodeToggleDirective} from './tree/tree-node-directive/tree-node-toggle.directive';\r\nimport { SyncScrollDirective } from './sync-scroll/sync-scroll.directive';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    Ngr2MarkdownComponent,\r\n    SideTocComponent,\r\n    HTMLPipePipe,\r\n    MdPipe,\r\n    ToolBarComponent,\r\n    EditBoxComponent,\r\n    FileBrowserComponent,\r\n    StatusBarComponent,\r\n    ControlBarComponent,\r\n    MenuComponent,\r\n    DragAndDropDirective,\r\n    TreeComponent,\r\n    TreeNodeComponent,\r\n    TreeNodeDefDirective,\r\n    TreeNodeOutletDirective,\r\n    TreeNodeToggleDirective,\r\n    SyncScrollDirective\r\n  ],\r\n  imports: [\r\n    BrowserModule\r\n  ],\r\n  exports: [\r\n    Ngr2MarkdownComponent,\r\n    SideTocComponent,\r\n    MdPipe\r\n  ]\r\n})\r\nexport class Ngr2MarkdownModule { }\r\n"]}