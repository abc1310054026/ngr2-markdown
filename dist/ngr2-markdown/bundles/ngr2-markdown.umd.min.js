!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("node_modules/markdown-it/dist/markdown-it.min.js"),require("highlight.js"),require("@angular/platform-browser"),require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngr2-markdown",["exports","node_modules/markdown-it/dist/markdown-it.min.js","highlight.js","@angular/platform-browser","rxjs","rxjs/operators","@angular/core"],t):t(e["ngr2-markdown"]={},e.MarkdownIt,e.hljs,e.ng.platformBrowser,e.rxjs,e.rxjs.operators,e.ng.core)}(this,function(e,t,o,n,a,s,r){"use strict";var l=function(){function e(){var r=this;this.markdownIt=new t({highlight:function(e,t){if(t&&o.getLanguage(t))try{return'<pre class="hljs"><code>'+o.highlight(t,e).value+"</code></pre>"}catch(n){}return'<pre class="hljs"><code>'+r.markdownIt.utils.escapeHtml(e)+"</code>"}})}return e.prototype.render=function(e,t){this.disable(t);var n=this.markdownIt.render(e);return this.enable(t),n},e.prototype.use=function(t){var n=this.markdownIt;return new a.Observable(function(e){n.use(t,e)})},e.prototype.enable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.enable(e)}},e.prototype.disable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.disable(e)}},e}();function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}var d=function(){function e(){this.fileReader=new FileReader}return e.prototype.toDataURL=function(e){return this.fileReader.readAsDataURL(e),this.mergeFileReader(this.fileReader)},e.prototype.toText=function(e,t){return this.fileReader.readAsText(e,t),this.mergeFileReader(this.fileReader)},e.prototype.toArrayBuffer=function(e){return this.fileReader.readAsArrayBuffer(e),this.mergeFileReader(this.fileReader)},e.prototype.toDataURLSync=function(e){return this.result=window.URL.createObjectURL(e),this.result},e.prototype.revokeDataURLSync=function(){window.URL.revokeObjectURL(this.result)},e.prototype.mergeFileReader=function(t){return a.merge.apply(void 0,c([a.fromEvent(t,"load"),a.fromEvent(t,"loadstart"),a.fromEvent(t,"loadend"),a.fromEvent(t,"progress"),a.fromEvent(t,"error"),a.fromEvent(t,"abort")])).pipe(s.map(function(e){return Object.assign(e,{result:t.result||"",error:t.error||null})}))},e}(),u=function(){function i(){}return i.parse=function(e){void 0===e&&(e="");for(var t=(e.match(i.WORDS)||[]).length,n=0,r=0,o=0;o<e.length;o++)65280&e.charCodeAt(o)?n++:"\n"===e.charAt(o)&&r++,n++;return{text:e,words:t,bytes:n,lines:r}},i.parseMD=function(e){return this.parse(e)},i.parseHTML=function(e){i._DIV.innerHTML=e;var t=this.parse(i._DIV.textContent);return{text:e,characters:t.bytes,words:t.words,paragraphs:t.lines}},i._DIV=document.createElement("DIV"),i.WORDS=new RegExp(/([a-zA-Z]+)|([\u4e00-\u9fa5])/g),i}(),p=function(){function e(){var i=this;this.originMd=new a.BehaviorSubject(""),this.resetMd=new a.BehaviorSubject(""),this.renderMd=new a.BehaviorSubject(null),this.currentHeading=new a.BehaviorSubject(null),this.currentContent=new a.BehaviorSubject({md:"",html:""}),this.TOCInfo=new a.BehaviorSubject(null),this.syncScroll=new a.BehaviorSubject(null),this.currentFile=new a.BehaviorSubject(null),this._md=new l,this._md.use(this.anchor).subscribe(function(e){for(var t=e.map(function(e){return new f(e.content,e.indentLevel)}),n=new f("root",0),r=n,o=0;o<t.length;o++){for(;r&&r.indentLevel>=t[o].indentLevel;)r=r.parent;(t[o].parent=r).children.push(t[o]),r=t[o]}i.TOCInfo.next(n)}),this.originMd.pipe(s.map(function(e){var t=i.render(e);return{md:e||null,html:t,Markdown:u.parseMD(e),HTML:u.parseHTML(t)}})).subscribe(this.renderMd),this.resetMd.subscribe(this.originMd)}return e.prototype.reinitialization=function(e){e&&this.resetMd.next(e)},e.prototype.observerResetMarkdown=function(){return this.resetMd},e.prototype.updateMarkdown=function(e){e&&(e instanceof a.Observable?e.subscribe(this.originMd):this.originMd.next(e))},e.prototype.observeMarkdown=function(){return this.renderMd},e.prototype.render=function(e,t){return e||(e=""),this._md.render(e,t)},e.prototype.setCurrentHeading=function(e){this.currentHeading.getValue()!==e&&this.currentHeading.next(e)},e.prototype.currentContentToDataUrl=function(e){var t,n=new d;switch(e){case"markdown":t=new Blob([this.currentContent.getValue().md],{type:"text/plain"});break;case"html":t=new Blob([this.currentContent.getValue().html],{type:"text/html"});break;default:t=new Blob(["null"],{type:"text/html"})}return n.toDataURLSync(t),n},e.prototype.anchor=function(e,r){e.core.ruler.push("anchor",function(e){var t=[],n=0;e.tokens.forEach(function(e){"heading_open"===e.type&&(e.attrJoin("id",n+++"-"+e.markup.length),t.push({content:e.attrGet("id"),indentLevel:e.markup.length}))}),r.next(t)})},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),h=function(){function l(e,t,n,r,o,i,a,s){void 0===e&&(e=l.MODE),void 0===t&&(t=l.ANCHOR),void 0===n&&(n=l.TOc),void 0===r&&(r=l.TOOL_BAR),void 0===o&&(o=l.DIRECTION),void 0===i&&(i=l.HEIGHT),void 0===a&&(a=l.THEME_COLOR),void 0===s&&(s=l.BODY_CLASS_NAME),this.mode=e,this.anchor=t,this.TOC=n,this.toolBar=r,this.direction=o,this.height=i,this.themeColor=a,this.bodyClassName=s}return l.instanceOf=function(e){return new l(e.mode||l.MODE,e.anchor||l.ANCHOR,e.TOC||l.TOc,e.toolBar||l.TOOL_BAR,e.direction||l.DIRECTION,e.height||l.HEIGHT,e.themeColor||l.THEME_COLOR,e.bodyClassName||l.BODY_CLASS_NAME)},l.MODE="edit",l.ANCHOR=!1,l.TOc=!1,l.TOOL_BAR=!1,l.DIRECTION="left",l.HEIGHT="800px",l.THEME_COLOR="#3f51b5",l.BODY_CLASS_NAME="markdown-body",l}(),f=function ne(e,t){this.content=e,this.indentLevel=t,this.children=new Array},m=function(){function e(e,t,n){void 0===n&&(n=function(e){return e.id}),this._el=e,this.suffix=t,this.generateId=n,this.headingsInfo=[]}return e.prototype.syncScrollByHeading=function(e,t){switch(void 0===e&&(e="tag"),void 0===t&&(t=["h1","h2","h3","h4","h5","h6"]),e){case"class":this.queryString=t.map(function(e){return"."+e}).join(",");break;case"tag":default:this.queryString=t.join(",")}this._update(this.queryString)},e.prototype.updateHeadingsInfo=function(){this._update(this.queryString)},e.prototype.currentHeading=function(e){return void 0===e&&(e=this._el.scrollTop),this.headingsInfo?this._curHeading(e):null},e.prototype.getPairHeading=function(e){for(var t=0;t<this.headingsInfo.length;t++)if(this.headingsInfo[t].pairId===e)return{headingInfo:this.headingsInfo[t],scrollTop:this._el.scrollTop};return null},e.prototype._curHeading=function(n){return this.headingsInfo.length<=0?null:{headingInfo:this.headingsInfo.reduce(function(e,t){return t.offsetTop>n?e:n-e.offsetTop>n-t.offsetTop?t:e}),scrollTop:n}},e.prototype._update=function(e){var t=this._el.querySelectorAll(e);if(t&&!(t.length<=0)){this.headingsInfo=[];for(var n=0;n<t.length;n++){var r=t[n],o=n+1>=t.length?this._el.scrollHeight:t[n+1].offsetTop,i=this.generateId(r,n,t);this.headingsInfo.push({id:i+"-"+this.suffix,pairId:i,el:r,offsetTop:r.offsetTop,height:o-r.offsetTop})}}},e}(),b=function(){function e(e){this.markdownService=e}return Object.defineProperty(e.prototype,"markdown",{set:function(e){this.markdownService.updateMarkdown(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{set:function(e){this._options=h.instanceOf(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.syncScroll=new m(this.markdownBody.nativeElement,"pre",function(e,t){return t+"-"+(e.tagName.charCodeAt(1)-48)}),this.syncScroll.syncScrollByHeading(),this.markdownService.observeMarkdown().subscribe(function(e){t._html=e.html,setTimeout(function(){t.syncScroll.updateHeadingsInfo()})}),a.fromEvent(this.markdownBody.nativeElement,"scroll").pipe(s.filter(function(){return t.syncScroll.headingsInfo&&0<t.syncScroll.headingsInfo.length}),s.map(function(){return t.syncScroll.currentHeading()}),s.distinctUntilChanged()).subscribe(function(e){})},e.decorators=[{type:r.Component,args:[{selector:"nb-ngr2-markdown",template:'<div class="main-panel"\r\n     [style.height]="_options.height"\r\n     nbDragAndDrop\r\n>\r\n  <nb-tool-bar class="tool-bar"\r\n  ></nb-tool-bar>\r\n  <div class="content-panel content-container"\r\n       nbDragAndDrop\r\n  >\r\n    <nb-file-browser class="file-browser-wrapper"\r\n    >\r\n    </nb-file-browser>\r\n    <nb-edit-box *ngIf="_options.mode === \'edit\'"\r\n                 [ngClass]="\'editor\'"\r\n    >\r\n    </nb-edit-box>\r\n    <nb-control-bar class="control-bar"\r\n    >\r\n    </nb-control-bar>\r\n    \x3c!--disable: nbSyncScroll--\x3e\r\n    <article #markdownBody\r\n             class="markdown-preview"\r\n             nbSyncScroll\r\n             [syncScrollInfo]="syncScroll"\r\n    >\r\n      <div [ngClass]="[_options.bodyClassName]"\r\n           [innerHTML]="_html | safe:\'html\'"\r\n      >\r\n      </div>\r\n    </article>\r\n    <nb-menu class="menu-wrapper"\r\n    >\r\n    </nb-menu>\r\n  </div>\r\n  <nb-status-bar class="status-bar-wrapper"\r\n  ></nb-status-bar>\r\n</div>\r\n',encapsulation:r.ViewEncapsulation.None,styles:[".main-panel{position:relative;display:flex;flex-direction:column;flex:1 1 auto;box-sizing:border-box}.markdown-preview{flex:1;overflow-y:auto;box-sizing:border-box;margin:0;padding:20px;min-width:200px;height:100%;background-color:#fff}.markdown-body{position:relative;margin-bottom:120px}.editor{flex:1;overflow-y:auto;box-sizing:border-box;margin:0 auto;min-width:200px;height:auto;display:flex;flex-direction:column}.content-container{display:flex;flex-direction:row}.side-toc-container{flex:0 auto;max-width:200px}.tool-bar{flex:0 0 25px;background-color:#d3d3d3}.content-panel{flex:1 1 auto}.status-bar-wrapper{flex:0 0 20px;background-color:gray}.file-browser-wrapper{flex:0 0 200px;background-color:#696969}.control-bar{overflow:auto;flex:0 0 10px;background-color:#faebd7}.menu-wrapper{flex:0 0 280px;background-color:#778899}::-webkit-scrollbar{width:6px;height:6px;background-color:transparent}::-webkit-scrollbar-thumb{background-color:#a9a9a9}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={markdownBody:[{type:r.ViewChild,args:["markdownBody",{read:r.ElementRef}]}],markdown:[{type:r.Input}],options:[{type:r.Input}]},e}(),g=function(){function e(e){this.markdownService=e,this.themeColor="#3f51b5"}return e.prototype.ngOnInit=function(){var t=this;this.markdownService.currentHeading.subscribe({next:function(e){t.currentHeading=e}}),this.markdownService.TOCInfo.subscribe({next:function(e){t.TOCInfo=e}})},e.decorators=[{type:r.Component,args:[{selector:"nb-side-toc",template:"<aside class=\"side-anchor-toc\">\r\n  <ol class=\"nav\">\r\n    <li *ngFor=\"let TOCItem of TOCInfo.children\"\r\n        [ngClass]=\"['item-level-' + TOCItem.indentLevel, 'nav-item', 'nav-item-active']\"\r\n    >\r\n      <a [href]=\"'#' + TOCItem.content\"\r\n         [ngClass]=\"['nav-item-link']\"\r\n         [ngStyle]=\"{'color': TOCItem.content === currentHeading ? themeColor : ''}\"\r\n      >\r\n        <span>{{ TOCItem.content }}</span>\r\n      </a>\r\n      <ol class=\"nav\">\r\n        <li *ngFor=\"let subItem of TOCItem.children\"\r\n            [ngClass]=\"['item-level-' + subItem.indentLevel, 'nav-item', 'nav-item-active']\"\r\n        >\r\n          <a [href]=\"'#' + subItem.content\"\r\n             [ngClass]=\"['nav-item-link']\"\r\n             [ngStyle]=\"{'color': subItem.content === currentHeading ? themeColor : ''}\"\r\n          >\r\n            <span>{{ subItem.content }}</span>\r\n          </a>\r\n        </li>\r\n      </ol>\r\n    </li>\r\n  </ol>\r\n</aside>\r\n",styles:[".side-anchor-toc{display:flex;flex-direction:column;font-size:14px;margin:0 auto;padding:10px;color:gray}.side-anchor-toc a{color:#696969}.nav{margin:0}.nav-item{line-height:1.8;cursor:pointer}.nav-item-link{text-decoration:none;outline:0}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={currentHeading:[{type:r.Input}],themeColor:[{type:r.Input}]},e}(),v=function(){function e(e){this.domSanitizer=e}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];switch(t[0]){case"html":return this.domSanitizer.bypassSecurityTrustHtml(e);case"url":return this.domSanitizer.bypassSecurityTrustUrl(e);default:return this.domSanitizer.bypassSecurityTrustHtml(e)}},e.decorators=[{type:r.Pipe,args:[{name:"safe"}]}],e.ctorParameters=function(){return[{type:n.DomSanitizer}]},e}(),y=function(){function e(e){this.markdownService=e}return e.prototype.transform=function(e,t){return this.markdownService.render(e,{anchor:!1})},e.decorators=[{type:r.Pipe,args:[{name:"md"}]}],e.ctorParameters=function(){return[{type:p}]},e}(),w=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){var t,n,r=this;this.titleSubscribe=this.markdownService.TOCInfo.subscribe(function(e){return r.title=e.content}),this.hrefSubscribe=this.markdownService.currentContent.subscribe(function(e){t&&t.revokeDataURLSync(),n&&n.revokeDataURLSync(),t=r.markdownService.currentContentToDataUrl("markdown"),n=r.markdownService.currentContentToDataUrl("html"),r.mdHref=t.result,r.htmlHref=n.result})},e.prototype.ngOnDestroy=function(){this.titleSubscribe.unsubscribe(),this.hrefSubscribe.unsubscribe()},e.decorators=[{type:r.Component,args:[{selector:"nb-tool-bar",template:"<a [download]=\"title + '.md'\"\r\n   [href]=\"mdHref | safe:'url'\"\r\n>\r\n  MD\r\n</a>\r\n<a [download]=\"title + '.html'\"\r\n   [href]=\"htmlHref | safe:'url'\"\r\n>\r\n  HTML\r\n</a>\r\n",styles:["a{color:gray;text-decoration:none}"]}]}],e.ctorParameters=function(){return[{type:p}]},e}(),_=function(){function t(){}return t.prototype.testMarks=function(e){return t.headingRegExp.test(e)?x.HEADING:t.blockQuoteRegExp.test(e)?x.BLOCK_QUOTE:t.listItemRegExp.test(e)?x.LIST_ITEM:t.codeBlockRegExp.test(e)?x.CODE_BLOCK:x.DEFAULT},t.prototype.parseHeading=function(e){if(e)return{headingLevel:t.headingRegExp[Symbol.match](e)[1].length}},t.headingRegExp=new RegExp(/^\s*(#{1,6})\s+.*\s*$/),t.blockQuoteRegExp=new RegExp(/^\s*>.*/),t.listItemRegExp=new RegExp(/^(\d+|[*+\-])\s.*/),t.codeBlockRegExp=new RegExp(/^`{1,3}\w*$/),t}(),x={HEADING:"heading",BLOCK_QUOTE:"block quote",LIST_ITEM:"list item",CODE_BLOCK:"code block",CODE_INLINE:"code inline",NOTHING:"nothing",DEFAULT:"default"},E=function(){function e(){}return e.prototype.renderRange=function(e,t,n){return this.curRange=e,this.renderEl(this._getRangeEl(e),t,n)},e.prototype.renderEl=function(e,t,n){switch(this.curEl=e,t){case x.HEADING:this._heading(n);break;case x.DEFAULT:default:this._default(n)}},e.prototype._heading=function(e){var t=e&&e.headingLevel||1;this.curEl.className!=="h"+t&&(this.curEl.className="h"+t)},e.prototype._blockQuote=function(e){"blockquote"!==this.curEl.className&&(this.curEl.className="blockquote")},e.prototype._listItem=function(e){"li"!==this.curEl.className&&(this.curEl.className="li")},e.prototype._codeBlock=function(e){if("code"!==this.curEl.className)if("pre"!==this.curEl.parentElement.className){this.curEl.className="pre";var t=this.curRange.startOffset,n=document.createElement("DIV");n.appendChild(this.curRange.startContainer),n.className="code",this.curEl.appendChild(n),this.curRange.setStart(n,t)}else this.curEl.className="code"},e.prototype._codeInline=function(e){},e.prototype._default=function(e){"p"!==this.curEl.className&&(this.curEl.className="p")},e.prototype._getRangeEl=function(e){var t,n=e.startContainer;return n.nodeType===Node.TEXT_NODE?t=n.parentElement:n.nodeType===Node.ELEMENT_NODE&&(t=n),t},e}(),k=function(){function e(e){this.markdownService=e,this.contentChange=new a.Subject}return Object.defineProperty(e.prototype,"_range",{get:function(){return this._selection.getRangeAt(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return console.log({before:this._editArea.innerText,after:this._editArea.innerText.replace(/\n\n/g,"\n")}),this._editArea.innerText.replace(/\n\n/g,"\n")},set:function(e){!e||e.length<=0?this._editArea.innerHTML="<div><br></div>":this._editArea.innerText=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._editArea=this.editAreaRef.nativeElement,this._editArea.focus(),this._selection=document.getSelection(),this.syncScroll=new m(this.editWindowRef.nativeElement,"edit",function(e,t){return t+"-"+(e.className.charCodeAt(1)-48)}),this.syncScroll.syncScrollByHeading("class"),this.marker=new _,this.renderer=new E,this.bindMdService(),this.bindMutationObserver()},e.prototype.keyUp=function(e){var t=this._range.startContainer.textContent,n=this.marker.testMarks(t);switch(n){case x.HEADING:this.renderer.renderRange(this._range,n,this.marker.parseHeading(t));break;default:this.renderer.renderRange(this._range,n)}},e.prototype.paste=function(e){var t=e.clipboardData.getData("text");document.execCommand("insertText",!1,t);for(var n=this._editArea.children,r=0;r<n.length;r++){var o=this.marker.testMarks(n[r].textContent);switch(o){case x.HEADING:this.renderer.renderEl(n[r],o,this.marker.parseHeading(n[r].textContent));break;default:this.renderer.renderEl(n[r],o)}}this.syncScroll.updateHeadingsInfo(),e.preventDefault()},e.prototype.bindMdService=function(){var o=this;this.markdownService.observerResetMarkdown().subscribe(function(e){o._editArea.innerHTML="<div><br></div>",o._editArea.focus(),document.execCommand("insertText",!1,e);for(var t=o._editArea.children,n=0;n<t.length;n++){var r=o.marker.testMarks(t[n].textContent);switch(r){case x.HEADING:o.renderer.renderEl(t[n],r,o.marker.parseHeading(t[n].textContent));break;default:o.renderer.renderEl(t[n],r)}}o.syncScroll.updateHeadingsInfo()}),this.markdownService.updateMarkdown(this.observeText(200))},e.prototype.observeText=function(e){return e?this.contentChange.pipe(s.distinctUntilChanged(),s.debounceTime(e)):this.contentChange.asObservable()},e.prototype.bindMutationObserver=function(){var n=this;new MutationObserver(function(e,t){n.syncScroll.updateHeadingsInfo(),n.contentChange.next(n.content)}).observe(this._editArea,{subtree:!0,childList:!0,characterData:!0,attributes:!0})},e.decorators=[{type:r.Component,args:[{selector:"nb-edit-box",template:'<div class="edit-box"\r\n>\r\n  \x3c!-- tool bar --\x3e\r\n  \x3c!-- 工具栏 扩展用 --\x3e\r\n  <div class="edit-tool-bar"\r\n  >\r\n    edit tool bar\r\n  </div>\r\n  \x3c!-- edit content --\x3e\r\n  \x3c!-- 编辑框 --\x3e\r\n  \x3c!--disable: nbSyncScroll--\x3e\r\n  <div #editWindow\r\n       class="edit-content"\r\n       nbSyncScroll\r\n       [syncScrollInfo]="syncScroll"\r\n  >\r\n    <div #editArea\r\n         class="edit-area"\r\n         contenteditable="true"\r\n         (keyup)="keyUp($event)"\r\n         (paste)="paste($event)"\r\n    >\r\n    </div>\r\n  </div>\r\n</div>\r\n',encapsulation:r.ViewEncapsulation.None,styles:[".edit-box{display:flex;flex-direction:column;height:100%}.edit-tool-bar{flex:0 0 25px}.edit-content{flex:1 1 auto;overflow:auto}.edit-area{position:relative;overflow-wrap:break-word;outline:0;box-sizing:border-box;min-height:100%;padding:10px 10px 120px;background-color:#fff}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={editAreaRef:[{type:r.ViewChild,args:["editArea",{read:r.ElementRef}]}],editWindowRef:[{type:r.ViewChild,args:["editWindow",{read:r.ElementRef}]}]},e}(),T=function(){function i(e,t,n){void 0===e&&(e="testDB"),void 0===t&&(t=i.O_S_STRUCT);var r=this;this.objectStoreStructs=t;var o=window.indexedDB.open(e);o.onerror=function(e){alert("Database error: "+e.target.error)},o.onsuccess=function(e){console.log("IndexedDB open success"),r._db=o.result,n.next(r)},o.onupgradeneeded=function(e){console.log("IndexedDB upgrade need"),r._db=o.result,r.objectStoreStructs.forEach(function(e){var t=r._db.createObjectStore(e.name,e.optionalParameters);e.indexes&&e.indexes.forEach(function(e){t.createIndex(e.name,e.keyPath||e.name,e.options)})})}}return i.instenceof=function(t,n){return void 0===t&&(t="testDB"),void 0===n&&(n=i.O_S_STRUCT),new a.Observable(function(e){new i(t,n,e)})},i.prototype.getObjectStore=function(e,t){return new S(this._db.transaction(e,t).objectStore(e))},i.O_S_STRUCT=[{name:"testStore",optionalParameters:{keyPath:"id"},indexes:[{name:"storeName",keyPath:"storeName",options:{unique:!1}}]}],i}(),S=function(){function e(e){this.objectStore=e}return e.prototype.add=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.add(n);r.initRequest(t,e)})},e.prototype.addAll=function(e){var t=this,n=e.map(function(e){return t.add(e)});return this._concat_scan.apply(this,c(n))},e.prototype.getById=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.get(n);r.initRequest(t,e)})},e.prototype.getAll=function(){var t=this,n=new a.Observable(function(n){var r=t.objectStore.openCursor();r.onsuccess=function(e){var t=r.result;t?(n.next(new C(O.COMPLETE,1,1,t.value)),t["continue"]()):n.complete()},r.onerror=function(e){n.next(new C(O.ERROR,0,0)),n.complete()}});return this.getCount().pipe(s.mergeMap(function(e){return t._from_scan(n,e.data)}))},e.prototype.getAllById=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.map(function(e){return t.getById(e)});return this._concat_scan.apply(this,c(r))},e.prototype.getAllByIndex=function(e){var t=this,o=this.objectStore.index(e),n=new a.Observable(function(n){var r=o.openCursor();r.onsuccess=function(e){var t=r.result;t?(n.next(new C(O.COMPLETE,1,1,t.value)),t["continue"]()):n.complete()},r.onerror=function(e){n.next(new C(O.ERROR,0,0)),n.complete()}});return this.getCount(o).pipe(s.mergeMap(function(e){return t._from_scan(n,e.data)}))},e.prototype.update=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.put(n);r.initRequest(t,e)})},e.prototype.updateAll=function(e){var t=this,n=e.map(function(e){return t.update(e)});return this._concat_scan.apply(this,c(n))},e.prototype["delete"]=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore["delete"](n);r.initRequest(t,e)})},e.prototype.deleteAll=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.map(function(e){return t["delete"](e)});return this._concat_scan.apply(this,c(r))},e.prototype.getCount=function(n,e){var r=this;return new a.Observable(function(e){var t=n===undefined?r.objectStore.count():n.count();r.initRequest(t,e)})},e.prototype.initRequest=function(t,n){t.onsuccess=function(){t.result!==undefined?n.next(new C(O.COMPLETE,1,1,t.result)):n.next(new C(O.ERROR,0,0)),n.complete()},t.onerror=function(e){n.next(new C(O.ERROR,0,0,t.error)),n.complete()}},e.prototype._from_scan=function(e,t){return e.pipe(s.scan(function(e,t){return t.type!==O.ERROR?(e.loaded++,e.data.push(t.data),e.loaded===e.total&&(e.type=O.COMPLETE)):(e.type=O.ERROR,e.loaded=0),e},new C(O.PENDING,0,t,new Array)))},e.prototype._concat_scan=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;return a.concat.apply(void 0,c(e)).pipe(s.scan(function(e,t){return t.type!==O.ERROR?(e.loaded++,e.data.push(t.data),e.loaded===e.total&&(e.type=O.COMPLETE)):(e.type=O.ERROR,e.loaded=0),e},new C(O.PENDING,0,n,new Array)))},e}(),C=function re(e,t,n,r){this.type=e,this.loaded=t,this.total=n,this.data=r===undefined?undefined:r},O={PENDING:"Pending",SUCCESS:"Success",ERROR:"Error",COMPLETE:"Complete"},I=function(){function e(e){this.nodes=e,this.nodeMap={},this.initMap(),this.rootNode=this.generateTree()}return e.prototype.initMap=function(){for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];this.nodeMap[t.parentId]||(this.nodeMap[t.parentId]=[]),this.nodeMap[t.parentId].push(t)}},e.prototype.generateTree=function(e,t,n,r){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===r&&(r="root");var o=new D;o.id=e,o.data=t,o.parentId=n,o.type=r,o.children=[];var i=this.nodeMap[e];if(!i)return o;for(var a=0;a<i.length;a++)o.push(this.generateTree(i[a].id,i[a],e,i[a].type));return o},e.prototype.recursionChildNodes=function(e){if(!this.nodeMap[e])return[];for(var t=[],n=0;n<this.nodeMap[e].length;n++){var r=this.nodeMap[e][n];t.push(r),t.push.apply(t,c(this.recursionChildNodes(r.id)))}return t},e}(),D=function(){function e(e,t,n,r){this.id=e,this.parentId=t,this.type=n,this.data=r}return e.prototype.push=function(e){return this.children.push(e),e},e}(),N=function(){function e(e,t){this.markdownService=e,this.renderer=t,this.indexedDBStructs=[{name:"markdown_article",optionalParameters:{keyPath:"id",autoIncrement:!0},indexes:[{name:"parentId",keyPath:"parentId",options:{unique:!1}}]}];var n=t.createElement("LI");this.renderer.addClass(n,"fb-li"),this.renderer.addClass(n,"fb-li_create");var r=t.createElement("I");this.renderer.addClass(r,"material-icons"),this.renderer.addClass(r,"md-18"),this.renderer.addClass(r,"md-dark"),this.renderer.appendChild(r,this.renderer.createText("edit"));var o=t.createElement("INPUT");this.renderer.addClass(o,"fb-li_create-input"),this.renderer.appendChild(n,r),this.renderer.appendChild(n,o),this.inputArea=n}return e.prototype.ngOnInit=function(){var n=this;T.instenceof("ngr2-markdown-db",this.indexedDBStructs).subscribe(function(e){n.indexedDB=e;var t=n.indexedDB.getObjectStore("markdown_article","readwrite");t.getCount().pipe(s.concatMap(function(e){return 0===e.data?t.addAll([new L,new R]):a.of(new C(O.COMPLETE,1,1))})).subscribe(function(e){n.refreshArticles().then(function(){var e=n.fileTree.recursionChildNodes(-1).filter(function(e){return"folder"!==e.type}).reduce(function(e,t){return e.lastModifiedTime>t.lastModifiedTime?e:t});n.markdownService.currentFile.next(e),n.markdownService.reinitialization(e.content)})})})},e.prototype.createFile=function(){var t=this,n=this.selectedNode&&("folder"===this.selectedNode.data.type?this.selectedNode.data.id:this.selectedNode.data.parentId)||null,r=this.selectedNode&&("folder"===this.selectedNode.data.type?this.selectedNode.el.parentElement.querySelector("ul"):this.selectedNode.el.parentElement.parentElement)||null,o=this.inputArea.cloneNode(!0);r&&n&&o||console.error("unable create file"),this.renderer.listen(o,"keyup",function(e){switch(e.code){case"Enter":t.indexedDB.getObjectStore("markdown_article","readwrite").add(new R(n,"article","ce",e.target.value)).subscribe(function(e){t.refreshArticles(),t.renderer.removeChild(r,o)})}}),this.renderer.appendChild(r,o),o.querySelector("input").focus()},e.prototype.createFolder=function(){var t=this;if("folder"===this.selectedNode.data.type){var n=this.selectedNode&&this.selectedNode.data.id||null,r=this.selectedNode&&this.selectedNode.el.parentElement.querySelector("ul")||null,o=this.inputArea.cloneNode(!0);r&&n&&o||console.error("unable create folder"),this.renderer.listen(o,"keyup",function(e){switch(e.code){case"Enter":t.indexedDB.getObjectStore("markdown_article","readwrite").add(new L(n,"folder",e.target.value)).subscribe(function(e){t.refreshArticles(),t.renderer.removeChild(r,o)})}}),this.renderer.appendChild(r,o),o.querySelector("input").focus()}},e.prototype.rename=function(){var n=this,r=this.selectedNode&&this.selectedNode.el.parentElement||null,o=this.selectedNode.data.type,i=this.inputArea.cloneNode(!0);this.renderer.listen(i,"keyup",function(e){switch(e.code){case"Enter":var t=e.target.value;n.selectedNode.data["folder"===o?"name":"title"]=t,n.indexedDB.getObjectStore("markdown_article","readwrite").update(n.selectedNode.data).subscribe(function(){n.refreshArticles(),n.renderer.removeChild(r,i),n.selectedNode=null})}}),r.replaceChild(i,this.selectedNode.el),i.lastChild.focus()},e.prototype["delete"]=function(){var e,t=this,n=this.fileTree.recursionChildNodes(this.selectedNode.data.id);(e=this.indexedDB.getObjectStore("markdown_article","readwrite")).deleteAll.apply(e,c(n.map(function(e){return e.id}),[this.selectedNode.data.id])).subscribe(function(e){return t.refreshArticles()})},e.prototype.close=function(){console.log("close")},e.prototype.select=function(e,t){this.selectedNode?this.selectedNode.el===e?(this.selectedNode.el.classList.remove("fb-li_selected"),this.selectedNode=null):(e.classList.add("fb-li_selected"),this.selectedNode.el.classList.remove("fb-li_selected"),this.selectedNode={el:e,data:t}):(e.classList.add("fb-li_selected"),this.selectedNode={el:e,data:t}),console.log(this.selectedNode)},e.prototype.open=function(e,t){this._save(this.markdownService.currentFile.value),this.markdownService.reinitialization(t.content),this.markdownService.currentFile.next(t)},e.prototype.expanded=function(e){var t=e.data.data;t.isExpanded=e.isExpanded,this.indexedDB.getObjectStore("markdown_article","readwrite").update(t).subscribe(function(e){return console.log(e)})},e.prototype._save=function(e){var t=this;e.content=this.markdownService.originMd.value,this.indexedDB.getObjectStore("markdown_article","readwrite").update(e).subscribe(function(){t.refreshArticles(),console.log("save success")})},e.prototype.refreshArticles=function(){var r=this;return new Promise(function(t,n){r.indexedDB.getObjectStore("markdown_article","readwrite").getAll().subscribe(function(e){e.type===O.COMPLETE&&(console.log(e),r.fileTree=new I(e.data),t(e))},function(e){return n(e)})})},e.decorators=[{type:r.Component,args:[{selector:"nb-file-browser",template:'<div class="file-browser">\r\n  <header class="fb-header"\r\n  >\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="createFile()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        note_add\r\n      </i>\r\n    </button>\r\n    \x3c!--创建文件夹暂时不可用--\x3e\r\n    \x3c!--(click)="createFolder()"--\x3e\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="createFolder()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        create_new_folder\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="delete()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        delete\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="rename()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        edit\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover fb-button_close"\r\n            (click)="close()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        close\r\n      </i>\r\n    </button>\r\n  </header>\r\n  <aside class="fb-list"\r\n  >\r\n    <nb-tree [dataSource]="fileTree"\r\n    >\r\n      <nb-tree-node *nbTreeNodeDef="let data = data" [isExpanded]="data.isExpanded">\r\n        <li *ngIf="data.type === \'folder\'"\r\n            class="fb-li_hover"\r\n            (click)="select($any($event.currentTarget), data)"\r\n            nbTreeNodeToggle\r\n            (callbackFn)="expanded($event)"\r\n        >\r\n          <i class="material-icons md-18 md-dark">\r\n            subdirectory_arrow_right\r\n          </i>\r\n          <span>{{ data.name }}</span>\r\n        </li>\r\n        <li *ngIf="data.type === \'article\'"\r\n            class="fb-li_hover"\r\n            (click)="select($any($event.currentTarget), data)"\r\n            (dblclick)="open($any($event.currentTarget), data)"\r\n        >\r\n          <i class="material-icons md-18 md-dark">\r\n            insert_drive_file\r\n          </i>\r\n          <span>{{ data.title }}</span>\r\n        </li>\r\n        <ul>\r\n          <ng-container nbTreeNodeOutlet></ng-container>\r\n        </ul>\r\n      </nb-tree-node>\r\n    </nb-tree>\r\n  </aside>\r\n</div>\r\n',encapsulation:r.ViewEncapsulation.None,styles:[".file-browser{display:flex;flex-direction:column;height:100%;background-color:#d3d3d3}.file-browser .fb-button{cursor:pointer;padding:1px 2px;margin:0;border:0;outline:0;height:100%;background-color:transparent}.file-browser .fb-button_hover:hover{background-color:rgba(0,0,0,.1)}.file-browser .fb-button_disable{cursor:default;opacity:.5}.file-browser .fb-button_close{float:right}.file-browser .fb-header{flex:0 0 30px;background-color:rgba(0,0,0,.1)}.file-browser .fb-list{flex:1 1 auto;width:200px;overflow:auto}.file-browser .fb-list ul{list-style:none;margin:0 0 0 5px;padding-left:2px}.file-browser .fb-list li{display:flex;box-sizing:border-box;font-size:12px;padding:2px;margin:3px}.file-browser .fb-li_hover:hover{background-color:rgba(0,0,0,.1)}.file-browser .fb-list li span{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.file-browser .fb-li_selected,.file-browser .fb-li_selected:hover{background-color:rgba(0,0,0,.2)}.file-browser .fb-li_create{background-color:#fff;width:170px}.file-browser .fb-li_create-input{box-sizing:padding-box;width:100%;padding:0 0 0 5px;outline:0;border:none}"]}]}],e.ctorParameters=function(){return[{type:p},{type:r.Renderer2}]},e}(),R=function(){function i(e,t,n,r,o){void 0===e&&(e=-1),void 0===t&&(t="article"),void 0===n&&(n=i.AUTHOR),void 0===r&&(r=i.TITLE),void 0===o&&(o=i.CONTENT),this.parentId=e,this.type=t,this.author=n,this.title=r,this.content=o,this.createTime=new Date,this.lastModifiedTime=this.createTime}return i.AUTHOR="Author",i.TITLE="Default Title",i.CONTENT="# Default Title",i}(),L=function(){function o(e,t,n,r){void 0===e&&(e=-1),void 0===t&&(t="folder"),void 0===n&&(n=o.NAME),void 0===r&&(r=!0),this.parentId=e,this.type=t,this.name=n,this.isExpanded=r}return o.NAME="folderName",o}(),M=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){var t=this;this.markdownService.observeMarkdown().subscribe(function(e){t.mdInfo=e.Markdown,t.htmlInfo=e.HTML}),this.markdownService.currentFile.subscribe(function(e){return t.fileInfo=e})},e.decorators=[{type:r.Component,args:[{selector:"nb-status-bar",template:'<footer class="status-bar"\r\n>\r\n  <div class="status-bar_panel sb-file_browser"\r\n  >\r\n    <span class="status-bar_panel-name">File</span>\r\n    <span><span class="status-bar_panel-value">{{ fileInfo && fileInfo.title }}</span></span>\r\n  </div>\r\n\r\n  <div class="status-bar_panel sb-edit_box"\r\n  >\r\n    <span class="status-bar_panel-name">Markdown</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.bytes }}</span>bytes</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.words }}</span>words</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.lines }}</span>lines</span>\r\n  </div>\r\n\r\n  <div class="status-bar_panel sb-control_bar">\r\n  </div>\r\n\r\n  <div class="status-bar_panel sb-preview_box"\r\n  >\r\n    <span class="status-bar_panel-name">HTML</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.characters }}</span>characters</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.words }}</span>words</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.paragraphs }}</span>paragraphs</span>\r\n  </div>\r\n\r\n  <div class="status-bar_panel sb-menu">\r\n  </div>\r\n</footer>\r\n',styles:[".status-bar{display:flex;font-size:10px;background-color:#007acc;color:#fff;height:100%}.status-bar_panel{line-height:20px}.sb-file_browser{flex:0 0 200px}.sb-edit_box{flex:1 1 auto}.sb-control_bar{flex:0 0 10px}.sb-preview_box{flex:1 1 auto}.sb-menu{flex:0 0 280px}.status-bar_panel-value{font-weight:700;margin-left:5px;margin-right:2px}"]}]}],e.ctorParameters=function(){return[{type:p}]},e}(),A=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:r.Component,args:[{selector:"nb-control-bar",template:"",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),H=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){this.fileOperator=new d},e.prototype.downloadMarkdown=function(){var o=this;this.markdownService.observeMarkdown().subscribe(function(e){console.log(e);var t=new Blob([e.Markdown.text],{type:"text/plain"}),n=o.fileOperator.toDataURLSync(t),r=document.createElement("A");r.download="Markdown.md",r.href=n,r.click()}).unsubscribe()},e.prototype.downloadHTML=function(){var a=this;this.markdownService.observeMarkdown().subscribe(function(e){var t=window.open("","");document.head.querySelectorAll("meta, style").forEach(function(e){t.document.head.innerHTML+=e.outerHTML}),t.document.body.innerHTML='<article class="markdown-body" style="font-size: 14px;height: auto;overflow: visible;">'+e.HTML.text+"</article>";var n=t.document.documentElement.innerHTML;t.close();var r=new Blob([n],{type:"text/html"}),o=a.fileOperator.toDataURLSync(r),i=document.createElement("A");i.download="HTML.html",i.href=o,i.click()}).unsubscribe()},e.prototype.downloadPDF=function(){this.markdownService.observeMarkdown().subscribe(function(e){var t=window.open("","");document.head.querySelectorAll("meta, style").forEach(function(e){t.document.head.innerHTML+=e.outerHTML}),t.document.body.innerHTML='<article class="markdown-body" style="font-size: 14px;height: auto;overflow: visible;">'+e.HTML.text+"</article>",t.print(),t.close()}).unsubscribe()},e.decorators=[{type:r.Component,args:[{selector:"nb-menu",template:'<div class="menu">\r\n  <header class="mu-header">\r\n    <span class="mu-title">MENU</span>\r\n  </header>\r\n  <aside class="mu-list">\r\n    <ul>\r\n      <li class="mu-li_hover"\r\n          (click)="downloadMarkdown()"\r\n      >\r\n        <i class="material-icons md-18 md-dark">\r\n          cloud_download\r\n        </i>\r\n        <div class="mu-item">\r\n          <span class="mu-item-title">Download Markdown</span>\r\n          <span class="mu-item-description">Download Markdown</span>\r\n        </div>\r\n      </li>\r\n      <li class="mu-li_hover"\r\n          (click)="downloadHTML()"\r\n      >\r\n        <i class="material-icons md-18 md-dark">\r\n          cloud_download\r\n        </i>\r\n        <div class="mu-item">\r\n          <span class="mu-item-title">Download HTML</span>\r\n          <span class="mu-item-description">Download HTML</span>\r\n        </div>\r\n      </li>\r\n      <li class="mu-li_hover"\r\n          (click)="downloadPDF()"\r\n      >\r\n        <i class="material-icons md-18 md-dark">\r\n          cloud_download\r\n        </i>\r\n        <div class="mu-item">\r\n          <span class="mu-item-title">Download PDF (Disable)</span>\r\n          <span class="mu-item-description">Download PDF</span>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n  </aside>\r\n</div>\r\n',styles:[".menu{display:flex;flex-direction:column;height:100%;background-color:#d3d3d3}.mu-header{flex:0 0 30px;background-color:rgba(0,0,0,.1)}.menu .mu-title{line-height:30px;margin:0 5px}.mu-list{flex:1 1 auto;width:280px;overflow:auto}.mu-list ul{list-style:none;margin:0 0 0 5px;padding-left:2px}.mu-list li{display:flex;align-items:center;box-sizing:border-box;font-size:12px;padding:10px;margin:3px}.mu-li_hover:hover{background-color:rgba(0,0,0,.1)}.mu-item{display:flex;flex-direction:column;margin-left:10px}.mu-item-title{font-size:16px}.mu-item-description{font-size:12px;color:gray}"]}]}],e.ctorParameters=function(){return[{type:p}]},e}(),P="dragstart",B="drag",j="dragend",F="dragenter",U="dragover",q="drop",G=function(){function r(e,t,n){void 0===t&&(t=r.ALL_OPTIONS),this.el=e,this.options=t,this.observable=this.initEvent(n)}return r.prototype.initEvent=function(e){var o=this,t=Object.getOwnPropertyNames(this.options).reduce(function(e,t){var n=o.options[t],r=o.addEventListener(o.el,n);return r=o.addListenFunction(r,n),e.push(r),e},[]);return a.merge.apply(void 0,c(t))},r.prototype.addEventListener=function(e,t,n){void 0===n&&(n=function(e){return e});var r=a.fromEvent(e,t.eventType,t.eventOptions,n);return r=this.eventOptions(r,t),r=this.streamOperator(r,t)},r.prototype.addListenFunction=function(e,t){return t.listener?e.pipe(s.tap(t.listener)):e},r.prototype.eventOptions=function(e,t){return e.pipe(s.map(function(e){return t.preventDefault&&e.preventDefault(),t.stopPropagation&&(e.stopPropagation(),e.cancelBubble=!0),e}))},r.prototype.streamOperator=function(e,t){if(!t.operatorOptions)return e;var n=t.operatorOptions;return n.throttleTime&&0<n.throttleTime&&(e=e.pipe(s.throttleTime(n.throttleTime))),n.filter&&(e=e.pipe(s.filter(n.filter))),e},r.ALL_OPTIONS={dragstart:{eventType:P,listener:r.defaultFun=function(e){console.group("on "+e.type),console.groupEnd()}},drag:{eventType:B,listener:r.defaultFun,operatorOptions:{throttleTime:1e3}},dragend:{eventType:j,listener:r.defaultFun},dragenter:{eventType:F,listener:r.defaultFun,preventDefault:!0},dragover:{eventType:U,listener:r.defaultFun,operatorOptions:{throttleTime:100},preventDefault:!0},drop:{eventType:q,listener:r.defaultFun}},r}(),z=function(){function a(e,t,n,r){void 0===n&&(n=a.ELEMENT_STYLE),void 0===r&&(r=a.DEMO_STYLE);var o=this;this.diagonal={RT_ANGLE:Math.PI/4,LT_ANGLE:Math.PI/4*3,LB_ANGLE:Math.PI/4*3*-1,RB_ANGLE:Math.PI/4*-1},this._el=e||null,this.parentContainer=t||null,this._parent=this._el&&this._el.parentElement||null,this.clone=this._el&&this._el.cloneNode(!0)||null,Object.getOwnPropertyNames(n).forEach(function(e){o._el.style[e]=n[e]}),Object.getOwnPropertyNames(r).forEach(function(e){o.clone.style[e]=r[e]}),this._el.draggable=!0,this._dadEvent=new G(this._el,{dragstart:{eventType:P,stopPropagation:!0,listener:this.ondragstart.bind(this)},drag:{eventType:B,stopPropagation:!0,listener:this.ondrag.bind(this),operatorOptions:{throttleTime:1e3}},dragend:{eventType:j,stopPropagation:!0,listener:this.ondragend.bind(this)},dragenter:{eventType:F,listener:this.ondragenter.bind(this),preventDefault:!0,operatorOptions:{filter:function(e){return!!o.parentContainer.equals(e)&&(o._el!==o.parentContainer.getDragElement()._el&&o._el===e.target)}}},dragover:{eventType:U,listener:this.ondragover.bind(this),operatorOptions:{throttleTime:100,filter:function(e){return!!o.parentContainer.equals(e)&&o._el!==o.parentContainer.getDragElement()._el}},preventDefault:!0},drop:{eventType:q,stopPropagation:!0,listener:this.ondrop.bind(this)}}),this._dadEvent.observable.subscribe(function(e){}),this.status="none";var i=this.clientRect;this.centerPoint=new V(i.left+i.width/2,i.top+i.height/2)}return Object.defineProperty(a.prototype,"clientRect",{get:function(){return this._el.getBoundingClientRect()},enumerable:!0,configurable:!0}),a.prototype.reset=function(){this.transitDemonstrationFinish(this.parentContainer.getDragElement())},a.prototype.ondragstart=function(e){console.group("on drop start"),this.status="drag",this.parentContainer.setDragElement(this,e),console.groupEnd()},a.prototype.ondrag=function(e){console.group("on drag"),console.groupEnd()},a.prototype.ondragend=function(e){console.group("on drag end"),this.status="none",console.groupEnd()},a.prototype.ondragenter=function(e){if(this.parentContainer.getDragElement()._parent===this._parent&&this._el===e.target&&this._el!==this.parentContainer.getDragElement()._el){console.group("on drag enter"),this.status="drop",this.parentContainer.setDropElement(this);var t=this.clientRect;this.diagonal.RT_ANGLE=Math.atan2(t.height/2,t.width/2),this.diagonal.LT_ANGLE=Math.PI-this.diagonal.RT_ANGLE,this.diagonal.LB_ANGLE=-this.diagonal.LT_ANGLE,this.diagonal.RB_ANGLE=-this.diagonal.RT_ANGLE,console.groupEnd()}},a.prototype.ondragover=function(e){console.group("on drag over"),this.transitDemonstration(this.parentContainer.getDragElement(),new V(e.clientX,e.clientY)),console.groupEnd()},a.prototype.ondragleave=function(e){console.group("on drag leave"),this.status="none",this.transitDemonstrationFinish(this.parentContainer.getDragElement()),console.groupEnd()},a.prototype.ondragexit=function(e){console.group("on drag exit"),console.groupEnd()},a.prototype.ondrop=function(e){console.group("on drop"),this.status="drop",this.replaceElement(this.parentContainer.getDragElement()._el,this.parentContainer.getDragElement().clone),console.groupEnd()},a.prototype.insertBefore=function(e){return this._parent.insertBefore(e,this._el)},a.prototype.insertAfter=function(e){return this._el.nextElementSibling?this._parent.insertBefore(e,this._el.nextElementSibling):this._parent.appendChild(e)},a.prototype.computeDirection=function(e){this.centerPoint=new V(this.clientRect.left+this.clientRect.width/2,this.clientRect.top+this.clientRect.height/2),e.relaitiveTo(this.centerPoint);var t=Math.atan2(e.Y,e.X);return t>=this.diagonal.RT_ANGLE&&t<this.diagonal.LT_ANGLE?"top":t>=this.diagonal.LT_ANGLE||t<this.diagonal.LB_ANGLE?"left":t>=this.diagonal.LB_ANGLE&&t<this.diagonal.RB_ANGLE?"bottom":"right"},a.prototype.transitDemonstration=function(e,t){var n=this.computeDirection(t);"top"===n||"left"===n?this.insertBefore(e._el):"bottom"!==n&&"right"!==n||this.insertAfter(e._el),console.log(n)},a.prototype.transitDemonstrationFinish=function(e){this.removeElement(e._el)},a.prototype.removeElement=function(e){for(var t=0;t<this._parent.children.length;t++)if(this._parent.children[t]===e)return this._parent.removeChild(e),e},a.prototype.replaceElement=function(e,t){for(var n=0;n<this._parent.children.length;n++)if(this._parent.children[n]===t)return this._parent.replaceChild(e,t),t},a.ELEMENT_STYLE={},a.DEMO_STYLE={opacity:"0.5"},a}(),V=function(){function e(e,t){this.X=e||null,this.Y=t||null}return e.prototype.relaitiveTo=function(e){this.X-=e.X,this.Y=e.Y-this.Y},e}(),Y=function(){function e(e){this._el=e||null,this._children=e.children||null,this.DADChildren=[];for(var t=0;t<this._children.length;t++){var n=new z(this._children[t],this);this.DADChildren.push(n)}}return e.prototype.setDragElement=function(e,t){this._dragEl=e,this.id=(new Date).getTime(),t.dataTransfer.setData("text/containerid:"+this.id.toString(10),this.id.toString(10))},e.prototype.getDragElement=function(){return this._dragEl},e.prototype.setDropElement=function(e){this._dropEl=e},e.prototype.getDropElement=function(){return this._dropEl},e.prototype.equals=function(e){var t=e.dataTransfer.types[e.dataTransfer.types.length-1];return!!t&&(t=t.split(":")[1],this.id===Number.parseInt(t,10))},e}(),$=function(){function e(e){this.el=e}return e.prototype.ngOnInit=function(){},e.prototype.ngAfterViewInit=function(){this.DADContainer=new Y(this.el.nativeElement)},e.decorators=[{type:r.Directive,args:[{selector:"[nbDragAndDrop]"}]}],e.ctorParameters=function(){return[{type:r.ElementRef}]},e}(),W=function(){function e(e){this.viewContainer=e}return e.decorators=[{type:r.Directive,args:[{selector:"[nbTreeNodeOutlet]"}]}],e.ctorParameters=function(){return[{type:r.ViewContainerRef}]},e}(),X=function(){function e(e){this.templateRef=e}return e.decorators=[{type:r.Directive,args:[{selector:"[nbTreeNodeDef]"}]}],e.ctorParameters=function(){return[{type:r.TemplateRef}]},e}(),Q=function(){function e(e){this.differs=e,this._dataDiffer=e.find([]).create(function(e,t){return t})}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._ds},set:function(e){e&&(this._ds=e,this.renderNodeChanges(this._ds.rootNode.children,this._dataDiffer,this.outlet.viewContainer))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.renderNodeChanges=function(e,t,o){var i=this;void 0===t&&(t=this._dataDiffer),void 0===o&&(o=this.outlet.viewContainer);var n=t.diff(e);n&&n.forEachOperation(function(e,t,n){if(null===e.previousIndex)o.createEmbeddedView(i.def.first.templateRef,e.item,n),K.mostRecentTreeNode.data=e.item;else if(null===n)o.remove(t);else{var r=o.get(t);o.move(r,n)}})},e.decorators=[{type:r.Component,args:[{selector:"nb-tree",template:"<ul>\n  <ng-container nbTreeNodeOutlet></ng-container>\n</ul>\n",styles:[""]}]}],e.ctorParameters=function(){return[{type:r.IterableDiffers}]},e.propDecorators={outlet:[{type:r.ViewChild,args:[W]}],def:[{type:r.ContentChildren,args:[X]}],dataSource:[{type:r.Input}]},e}(),K=function(){function e(){}return e.mostRecentTreeNode=null,e}(),J=function(){function e(e,t){this._tree=e,this._differs=t,(K.mostRecentTreeNode=this)._dataDiffer=this._differs.find([]).create()}return Object.defineProperty(e.prototype,"isExpanded",{get:function(){return this._isExpanded},set:function(e){console.log("isExpanded"),this._isExpanded=e,this.isExpanded?this.updateChildrenNodes():(this.outlet.viewContainer.clear(),this._dataDiffer.diff([]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.ngAfterContentInit=function(){},e.prototype.updateChildrenNodes=function(){this._tree.renderNodeChanges(this.data.children,this._dataDiffer,this.outlet.viewContainer)},e.decorators=[{type:r.Component,args:[{selector:"nb-tree-node",template:"<ng-content></ng-content>\n",styles:[""]}]}],e.ctorParameters=function(){return[{type:Q},{type:r.IterableDiffers}]},e.propDecorators={isExpanded:[{type:r.Input}],outlet:[{type:r.ContentChild,args:[W]}]},e}(),Z=function(){function e(e){this.treeNode=e,this.callbackFn=new r.EventEmitter,console.log(e)}return e.prototype.toggle=function(e){this.treeNode.isExpanded=!this.treeNode.isExpanded,e.preventDefault(),this.callbackFn.emit(this.treeNode)},e.decorators=[{type:r.Directive,args:[{selector:"[nbTreeNodeToggle]"}]}],e.ctorParameters=function(){return[{type:J}]},e.propDecorators={toggle:[{type:r.HostListener,args:["dblclick",["$event"]]}],callbackFn:[{type:r.Output}]},e}(),ee=function(){function t(e,t){this.markdownService=e,this.scroll=this.onScroll,this._el=t.nativeElement}return t.prototype.ngOnInit=function(){var r=this;this.subscription=this.markdownService.syncScroll.subscribe(function(e){if(e&&e.headingInfo.el!==r._el){var t=r.syncScrollInfo.getPairHeading(e.headingInfo.pairId),n=e.scrollTop-e.headingInfo.offsetTop;r._el.scrollTop=t.headingInfo.offsetTop+t.headingInfo.height/e.headingInfo.height*n}})},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.onScroll=function(e){t.mutexLock=!t.mutexLock&&(this.markdownService.syncScroll.next(this.syncScrollInfo.currentHeading()),!0)},t.mutexLock=!1,t.decorators=[{type:r.Directive,args:[{selector:"[nbSyncScroll]"}]}],t.ctorParameters=function(){return[{type:p},{type:r.ElementRef}]},t.propDecorators={scroll:[{type:r.HostListener,args:["scroll",["$event"]]}],syncScrollInfo:[{type:r.Input}]},t}(),te=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[b,g,v,y,w,k,N,M,A,H,$,Q,J,X,W,Z,ee],imports:[n.BrowserModule],exports:[b,g,y]}]}],e}();e.Ngr2MarkdownService=p,e.EditorOption=h,e.TOCItem=f,e.Ngr2MarkdownComponent=b,e.Ngr2MarkdownModule=te,e.ɵh=A,e.ɵj=$,e.ɵe=k,e.ɵf=N,e.ɵi=H,e.ɵb=v,e.ɵc=y,e.ɵa=g,e.ɵg=M,e.ɵp=ee,e.ɵd=w,e.ɵm=X,e.ɵl=W,e.ɵo=Z,e.ɵn=J,e.ɵk=Q,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngr2-markdown.umd.min.js.map