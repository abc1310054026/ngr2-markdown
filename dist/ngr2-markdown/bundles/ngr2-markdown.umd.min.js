!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("node_modules/markdown-it/dist/markdown-it.min.js"),require("highlight.js"),require("@angular/platform-browser"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngr2-markdown",["exports","node_modules/markdown-it/dist/markdown-it.min.js","highlight.js","@angular/platform-browser","@angular/core","rxjs","rxjs/operators"],t):t(e["ngr2-markdown"]={},e.MarkdownIt,e.hljs,e.ng.platformBrowser,e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,t,o,n,r,a,s){"use strict";var l=function(){function e(){var r=this;this.markdownIt=new t({highlight:function(e,t){if(t&&o.getLanguage(t))try{return'<pre class="hljs"><code>'+o.highlight(t,e).value+"</code></pre>"}catch(n){}return'<pre class="hljs"><code>'+r.markdownIt.utils.escapeHtml(e)+"</code>"}})}return e.prototype.render=function(e,t){this.disable(t);var n=this.markdownIt.render(e);return this.enable(t),n},e.prototype.use=function(t){var n=this.markdownIt;return new a.Observable(function(e){n.use(t,e)})},e.prototype.enable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.enable(e)}},e.prototype.disable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.disable(e)}},e}();function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}var d=function(){function e(){this.fileReader=new FileReader}return e.prototype.toDataURL=function(e){return this.fileReader.readAsDataURL(e),this.mergeFileReader(this.fileReader)},e.prototype.toText=function(e,t){return this.fileReader.readAsText(e,t),this.mergeFileReader(this.fileReader)},e.prototype.toArrayBuffer=function(e){return this.fileReader.readAsArrayBuffer(e),this.mergeFileReader(this.fileReader)},e.prototype.toDataURLSync=function(e){return this.result=window.URL.createObjectURL(e),this.result},e.prototype.revokeDataURLSync=function(){window.URL.revokeObjectURL(this.result)},e.prototype.mergeFileReader=function(t){return a.merge.apply(void 0,c([a.fromEvent(t,"load"),a.fromEvent(t,"loadstart"),a.fromEvent(t,"loadend"),a.fromEvent(t,"progress"),a.fromEvent(t,"error"),a.fromEvent(t,"abort")])).pipe(s.map(function(e){return Object.assign(e,{result:t.result||"",error:t.error||null})}))},e}(),u=function(){function i(){}return i.parse=function(e){void 0===e&&(e="");for(var t=(e.match(i.WORDS)||[]).length,n=0,r=0,o=0;o<e.length;o++)65280&e.charCodeAt(o)?n++:"\n"===e.charAt(o)&&r++,n++;return{text:e,words:t,bytes:n,lines:r}},i.parseMD=function(e){return this.parse(e)},i.parseHTML=function(e){i._DIV.innerHTML=e;var t=this.parse(i._DIV.textContent);return{text:t.text,character:t.bytes,words:t.words,paragraphs:t.lines}},i._DIV=document.createElement("DIV"),i.WORDS=new RegExp(/([a-zA-Z]+)|([\u4e00-\u9fa5])/g),i}(),p=function(){function e(){var i=this;this.originMd=new a.BehaviorSubject(null),this.resetMd=new a.BehaviorSubject(null),this.currentHeading=new a.BehaviorSubject(null),this.currentContent=new a.BehaviorSubject({md:"",html:""}),this.TOCInfo=new a.BehaviorSubject(null),this._md=new l,this._md.use(this.anchor).subscribe(function(e){for(var t=e.map(function(e){return new f(e.content,e.indentLevel)}),n=new f("root",0),r=n,o=0;o<t.length;o++){for(;r&&r.indentLevel>=t[o].indentLevel;)r=r.parent;(t[o].parent=r).children.push(t[o]),r=t[o]}i.TOCInfo.next(n)}),this.renderMd=this.originMd.pipe(s.map(function(e){var t=i.render(e);return{md:e||null,html:t,Markdown:u.parseMD(e),HTML:u.parseHTML(t)}})),this.resetMd.subscribe(this.originMd)}return e.prototype.reinitialization=function(e){e&&this.resetMd.next(e)},e.prototype.observerResetMarkdown=function(){return this.resetMd},e.prototype.updateMarkdown=function(e){e&&(e instanceof a.Observable?e.subscribe(this.originMd):this.originMd.next(e))},e.prototype.observeMarkdown=function(){return this.renderMd},e.prototype.render=function(e,t){return e||(e=""),this._md.render(e,t)},e.prototype.setCurrentHeading=function(e){this.currentHeading.getValue()!==e&&this.currentHeading.next(e)},e.prototype.currentContentToDataUrl=function(e){var t,n=new d;switch(e){case"markdown":t=new Blob([this.currentContent.getValue().md],{type:"text/plain"});break;case"html":t=new Blob([this.currentContent.getValue().html],{type:"text/html"});break;default:t=new Blob(["null"],{type:"text/html"})}return n.toDataURLSync(t),n},e.prototype.anchor=function(e,t){e.core.ruler.push("anchor",function(e){var r=[];e.tokens.map(function(e,t,n){"heading_open"===e.type&&(e.attrJoin("id",n[t+1].content),r.push({content:e.attrGet("id"),indentLevel:e.markup.length}))}),t.next(r)})},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),h=function(){function l(e,t,n,r,o,i,a,s){void 0===e&&(e=l.MODE),void 0===t&&(t=l.ANCHOR),void 0===n&&(n=l.TOc),void 0===r&&(r=l.TOOL_BAR),void 0===o&&(o=l.DIRECTION),void 0===i&&(i=l.HEIGHT),void 0===a&&(a=l.THEME_COLOR),void 0===s&&(s=l.BODY_CLASS_NAME),this.mode=e,this.anchor=t,this.TOC=n,this.toolBar=r,this.direction=o,this.height=i,this.themeColor=a,this.bodyClassName=s}return l.instanceOf=function(e){return new l(e.mode||l.MODE,e.anchor||l.ANCHOR,e.TOC||l.TOc,e.toolBar||l.TOOL_BAR,e.direction||l.DIRECTION,e.height||l.HEIGHT,e.themeColor||l.THEME_COLOR,e.bodyClassName||l.BODY_CLASS_NAME)},l.MODE="edit",l.ANCHOR=!1,l.TOc=!1,l.TOOL_BAR=!1,l.DIRECTION="left",l.HEIGHT="800px",l.THEME_COLOR="#3f51b5",l.BODY_CLASS_NAME="markdown-body",l}(),f=function z(e,t){this.content=e,this.indentLevel=t,this.children=new Array},b=function(){function a(){}return a.checkUnit=function(e,t,n){if(void 0===t&&(t=a.UNIT_MAP),t&&e){var r;n||(e=e.toLocaleLowerCase());var o=!1;for(r=e.length-1;0<=r;r--){var i=e.charCodeAt(r);if(48<=i&&i<=57){o=t.exist;break}if(!t.child[e[r]])break;t=t.child[e[r]]}return o?{unit:e.substr(r+1),number:Number.parseInt(e.substr(0,r+1),10)}:null}},a.UNIT_MAP={exist:!1,child:{b:{exist:!1,child:{v:{exist:!0,child:{}}}},c:{exist:!1,child:{i:{exist:!0,child:{}},p:{exist:!0,child:{}}}},h:{exist:!1,child:{c:{exist:!0,child:{}},l:{exist:!0,child:{r:{exist:!0,child:{}}}},v:{exist:!0,child:{}}}},i:{exist:!1,child:{v:{exist:!0,child:{}}}},m:{exist:!1,child:{e:{exist:!0,child:{r:{exist:!0,child:{}}}},m:{exist:!0,child:{}},c:{exist:!0,child:{}}}},n:{exist:!1,child:{i:{exist:!0,child:{m:{exist:!1,child:{v:{exist:!0,child:{}}}}}}}},p:{exist:!1,child:{a:{exist:!1,child:{c:{exist:!0,child:{}}}}}},q:{exist:!0,child:{}},t:{exist:!1,child:{p:{exist:!0,child:{}}}},w:{exist:!1,child:{v:{exist:!0,child:{}}}},x:{exist:!1,child:{a:{exist:!1,child:{m:{exist:!1,child:{v:{exist:!0,child:{}}}}}},e:{exist:!0,child:{}},p:{exist:!0,child:{}}}}}},a}(),m=function(){function e(e){this.markdownService=e}return Object.defineProperty(e.prototype,"markdown",{set:function(e){this.markdownService.updateMarkdown(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{set:function(e){this._options=h.instanceOf(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.markdownService.observeMarkdown().subscribe(function(e){t._html=e.html,t.reinitialization(),setTimeout(function(){t.updateHeadingInfo()})}),a.fromEvent(this.markdownBody.nativeElement,"scroll").pipe(s.filter(function(){return t.headingElementRef&&0<t.headingElementRef.length}),s.map(function(){return t.markdownScroll()}),s.distinctUntilChanged()).subscribe(this.markdownService.currentHeading)},e.prototype.reinitialization=function(){this.headingElementMarginTop={},this.headingElementRef=[],this.markdownBody.nativeElement.scrollTop=0,this.markdownService.setCurrentHeading(null)},e.prototype.markdownScroll=function(){var n,r,o,i,a=this,s=this.markdownBody.nativeElement.getBoundingClientRect().top;return this.headingElementRef.reduce(function(e,t){return n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),o=a.headingElementMarginTop[e.id],i=a.headingElementMarginTop[t.id],0<r.top-s-i?e:r.top-s-i>n.top-s-o?t:e}).id},e.prototype.updateHeadingInfo=function(){var e,t=this.markdownBody.nativeElement.querySelectorAll("h1, h2");if(t!==undefined&&null!==t){this.headingElementRef.splice(0);for(var n=[],r=0;r<t.length;r++){var o=t[r],i=this.getComputedStyle(o,"margin-top");this.headingElementMarginTop[o.id]=b.checkUnit(i).number,n.push(o)}(e=this.headingElementRef).push.apply(e,c(n))}},e.prototype.getComputedStyle=function(e,t,n){return window.getComputedStyle(e,null).getPropertyValue(t)},e.decorators=[{type:r.Component,args:[{selector:"nb-ngr2-markdown",template:'<div class="main-panel"\r\n     [style.height]="_options.height"\r\n     nbDragAndDrop\r\n>\r\n  <nb-tool-bar class="tool-bar"\r\n  ></nb-tool-bar>\r\n  <div class="content-panel content-container"\r\n       nbDragAndDrop\r\n  >\r\n    <nb-file-browser class="file-browser-wrapper"\r\n    >\r\n    </nb-file-browser>\r\n    <nb-edit-box *ngIf="_options.mode === \'edit\'"\r\n                 [ngClass]="\'editor\'"\r\n    >\r\n    </nb-edit-box>\r\n    <nb-control-bar class="control-bar"\r\n    >\r\n    </nb-control-bar>\r\n    <article #markdownBody\r\n             [ngClass]="[_options.bodyClassName]"\r\n             [innerHTML]="_html | safe:\'html\'"\r\n    >\r\n    </article>\r\n    <nb-menu class="menu"\r\n    >\r\n    </nb-menu>\r\n  </div>\r\n  <nb-status-bar class="status-bar-wrapper"\r\n  ></nb-status-bar>\r\n</div>\r\n',encapsulation:r.ViewEncapsulation.None,styles:[".main-panel{position:relative;display:flex;flex-direction:column;flex:1 1 auto;box-sizing:border-box}.markdown-body{flex:1;overflow-y:auto;box-sizing:border-box;margin:0 auto;padding:45px;min-width:200px;height:100%}.editor{flex:1;overflow-y:auto;box-sizing:border-box;margin:0 auto;min-width:200px;height:auto;display:flex;flex-direction:column}.content-container{display:flex;flex-direction:row}.side-toc-container{flex:0 auto;max-width:200px}.tool-bar{flex:0 0 25px;background-color:#d3d3d3}.content-panel{flex:1 1 auto;background-color:#a9a9a9}.status-bar-wrapper{flex:0 0 20px;background-color:gray}.file-browser-wrapper{flex:0 0 200px;background-color:#696969}.control-bar{overflow:auto;flex:0 0 25px;background-color:#faebd7}.menu{flex:0 0 200px;background-color:#778899}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={markdownBody:[{type:r.ViewChild,args:["markdownBody",{read:r.ElementRef}]}],markdown:[{type:r.Input}],options:[{type:r.Input}]},e}(),g=function(){function e(e){this.markdownService=e,this.themeColor="#3f51b5"}return e.prototype.ngOnInit=function(){var t=this;this.markdownService.currentHeading.subscribe({next:function(e){t.currentHeading=e}}),this.markdownService.TOCInfo.subscribe({next:function(e){t.TOCInfo=e}})},e.decorators=[{type:r.Component,args:[{selector:"nb-side-toc",template:"<aside class=\"side-anchor-toc\">\r\n  <ol class=\"nav\">\r\n    <li *ngFor=\"let TOCItem of TOCInfo.children\"\r\n        [ngClass]=\"['item-level-' + TOCItem.indentLevel, 'nav-item', 'nav-item-active']\"\r\n    >\r\n      <a [href]=\"'#' + TOCItem.content\"\r\n         [ngClass]=\"['nav-item-link']\"\r\n         [ngStyle]=\"{'color': TOCItem.content === currentHeading ? themeColor : ''}\"\r\n      >\r\n        <span>{{ TOCItem.content }}</span>\r\n      </a>\r\n      <ol class=\"nav\">\r\n        <li *ngFor=\"let subItem of TOCItem.children\"\r\n            [ngClass]=\"['item-level-' + subItem.indentLevel, 'nav-item', 'nav-item-active']\"\r\n        >\r\n          <a [href]=\"'#' + subItem.content\"\r\n             [ngClass]=\"['nav-item-link']\"\r\n             [ngStyle]=\"{'color': subItem.content === currentHeading ? themeColor : ''}\"\r\n          >\r\n            <span>{{ subItem.content }}</span>\r\n          </a>\r\n        </li>\r\n      </ol>\r\n    </li>\r\n  </ol>\r\n</aside>\r\n",styles:[".side-anchor-toc{display:flex;flex-direction:column;font-size:14px;margin:0 auto;padding:10px;color:gray}.side-anchor-toc a{color:#696969}.nav{margin:0}.nav-item{line-height:1.8;cursor:pointer}.nav-item-link{text-decoration:none;outline:0}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={currentHeading:[{type:r.Input}],themeColor:[{type:r.Input}]},e}(),v=function(){function e(e){this.domSanitizer=e}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];switch(t[0]){case"html":return this.domSanitizer.bypassSecurityTrustHtml(e);case"url":return this.domSanitizer.bypassSecurityTrustUrl(e);default:return this.domSanitizer.bypassSecurityTrustHtml(e)}},e.decorators=[{type:r.Pipe,args:[{name:"safe"}]}],e.ctorParameters=function(){return[{type:n.DomSanitizer}]},e}(),y=function(){function e(e){this.markdownService=e}return e.prototype.transform=function(e,t){return this.markdownService.render(e,{anchor:!1})},e.decorators=[{type:r.Pipe,args:[{name:"md"}]}],e.ctorParameters=function(){return[{type:p}]},e}(),w=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){var t,n,r=this;this.titleSubscribe=this.markdownService.TOCInfo.subscribe(function(e){return r.title=e.content}),this.hrefSubscribe=this.markdownService.currentContent.subscribe(function(e){t&&t.revokeDataURLSync(),n&&n.revokeDataURLSync(),t=r.markdownService.currentContentToDataUrl("markdown"),n=r.markdownService.currentContentToDataUrl("html"),r.mdHref=t.result,r.htmlHref=n.result})},e.prototype.ngOnDestroy=function(){this.titleSubscribe.unsubscribe(),this.hrefSubscribe.unsubscribe()},e.decorators=[{type:r.Component,args:[{selector:"nb-tool-bar",template:"<a [download]=\"title + '.md'\"\r\n   [href]=\"mdHref | safe:'url'\"\r\n>\r\n  MD\r\n</a>\r\n<a [download]=\"title + '.html'\"\r\n   [href]=\"htmlHref | safe:'url'\"\r\n>\r\n  HTML\r\n</a>\r\n",styles:["a{color:gray;text-decoration:none}"]}]}],e.ctorParameters=function(){return[{type:p}]},e.propDecorators={download:[{type:r.ViewChild,args:["download",{read:r.ElementRef}]}]},e}(),x=function(){function n(e,t){void 0===t&&(t=n.SHORTCUT_KEY_OPTIONS),this._el=e,this.sKOpts=t,this.observable=this.listenEvent("keydown")}return n.prototype.listenEvent=function(e,t){return a.fromEvent(this._el,e,t,function(e){return e})},n.prototype.dispatch=function(t){return t?this.observable.pipe(s.filter(function(e){return e.shiftKey===(t.shortcutKey.shift||!1)&&e.ctrlKey===(t.shortcutKey.ctrl||!1)&&e.altKey===(t.shortcutKey.alt||!1)&&e.key===(t.shortcutKey.key||!1)}),s.map(function(e){return t.preventDefault&&e.preventDefault(),t.stopPropagation&&(e.stopPropagation(),e.cancelBubble=!0),e})):null},n.prototype.eventOptions=function(e,t){return e.pipe(s.map(function(e){return t.preventDefault&&e.preventDefault(),t.stopPropagation&&(e.stopPropagation(),e.cancelBubble=!0),e}))},n.prototype.specOprt=function(e){return e?this.dispatch(this.sKOpts[e]):null},n.prototype.copyOprt=function(){return this.dispatch(this.sKOpts.Copy)},n.prototype.selectAllOprt=function(){return this.dispatch(this.sKOpts["Select All"])},n.prototype.pasteOprt=function(){return this.dispatch(this.sKOpts.Paste)},n.prototype.cutOprt=function(){return this.dispatch(this.sKOpts.Cut)},n.prototype.undoOprt=function(){return this.dispatch(this.sKOpts.Undo)},n.prototype.redoOprt=function(){return this.dispatch(this.sKOpts.Redo)},n.SHORTCUT_KEY_OPTIONS={"Select All":{operateType:"Select All",shortcutKey:{ctrl:!0,key:"a"}},Copy:{operateType:"Copy",shortcutKey:{ctrl:!0,key:"c"},preventDefault:!0},Paste:{operateType:"Paste",shortcutKey:{ctrl:!0,key:"v"}},Cut:{operateType:"Cut",shortcutKey:{ctrl:!0,key:"x"},preventDefault:!0},Undo:{operateType:"Undo",shortcutKey:{ctrl:!0,key:"z"}},Redo:{operateType:"Redo",shortcutKey:{ctrl:!0,shift:!0,key:"z"}}},n}(),_=function(){function e(e){this._el=e,this._sKEv=new x(this._el),this._sKEv.copyOprt().subscribe(this.copy.bind(this)),this._sKEv.cutOprt().subscribe(this.cut.bind(this))}return e.prototype.copy=function(e){var t=window.getSelection(),n=t.getRangeAt(0);t.isCollapsed&&(n.setStart(n.startContainer,0),n.setEnd(n.endContainer,n.endContainer.textContent.length)),document.execCommand("copy")},e.prototype.cut=function(e){var t=window.getSelection(),n=t.getRangeAt(0);t.isCollapsed&&(n.setStart(n.startContainer,0),n.setEnd(n.endContainer,n.endContainer.textContent.length)),document.execCommand("cut")},e}(),E=function(){function e(e,t){this.markdownService=e,this.mdSubject=new a.Subject,this._el=t.nativeElement}return e.prototype.ngOnInit=function(){var t=this;this._editArea=this._el.querySelector("#editArea"),this._editArea.focus();new _(this._editArea);this.markdownService.observerResetMarkdown().subscribe(function(e){t._editArea.innerText=e}),this.bindMdService(),this.bindMutationObserver()},e.prototype.bindMdService=function(){var t=this;this.markdownService.observerResetMarkdown().subscribe(function(e){t._editArea.textContent=e}),this.markdownService.updateMarkdown(this.observeText(200))},e.prototype.observeText=function(e){return e?this.mdSubject.pipe(s.distinctUntilChanged(),s.debounceTime(e)):this.mdSubject.asObservable()},e.prototype.bindMutationObserver=function(){var n=this;new MutationObserver(function(e,t){n.mdSubject.next(n.getText())}).observe(this._editArea,{subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},e.prototype.getText=function(){return this._editArea.innerText},e.decorators=[{type:r.Component,args:[{selector:"nb-edit-box",template:'<div class="edit-box"\r\n>\r\n  \x3c!-- tool bar --\x3e\r\n  \x3c!-- 工具栏 扩展用 --\x3e\r\n  <div class="edit-tool-bar"\r\n  >\r\n    edit tool bar\r\n  </div>\r\n  \x3c!-- edit content --\x3e\r\n  \x3c!-- 编辑框 --\x3e\r\n  <div id="editArea"\r\n       class="edit-content"\r\n       contenteditable="true"\r\n  >\r\n  </div>\r\n</div>\r\n',styles:[".edit-box{display:flex;flex-direction:column;height:100%}.edit-tool-bar{flex:0 0 25px}.edit-content{flex:auto;overflow:auto;overflow-wrap:break-word;outline:0;padding:20px;background-color:#fff}"]}]}],e.ctorParameters=function(){return[{type:p},{type:r.ElementRef}]},e}(),O=function(){function i(e,t,n){void 0===e&&(e="testDB"),void 0===t&&(t=i.O_S_STRUCT);var r=this;this.objectStoreStructs=t;var o=window.indexedDB.open(e);o.onerror=function(e){alert("Database error: "+e.target.error)},o.onsuccess=function(e){console.log("IndexedDB open success"),r._db=o.result,n.next(r)},o.onupgradeneeded=function(e){console.log("IndexedDB upgrade need"),r._db=o.result,r.objectStoreStructs.forEach(function(e){var t=r._db.createObjectStore(e.name,e.optionalParameters);e.indexes&&e.indexes.forEach(function(e){t.createIndex(e.name,e.keyPath||e.name,e.options)})})}}return i.instenceof=function(t,n){return void 0===t&&(t="testDB"),void 0===n&&(n=i.O_S_STRUCT),new a.Observable(function(e){new i(t,n,e)})},i.prototype.getObjectStore=function(e,t){return new C(this._db.transaction(e,t).objectStore(e))},i.O_S_STRUCT=[{name:"testStore",optionalParameters:{keyPath:"id"},indexes:[{name:"storeName",keyPath:"storeName",options:{unique:!1}}]}],i}(),C=function(){function e(e){this.objectStore=e}return e.prototype.add=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.add(n);r.initRequest(t,e)})},e.prototype.addAll=function(e){var t=this,n=e.map(function(e){return t.add(e)});return this._concat_scan.apply(this,c(n))},e.prototype.getById=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.get(n);r.initRequest(t,e)})},e.prototype.getAll=function(){var t=this,n=new a.Observable(function(n){var r=t.objectStore.openCursor();r.onsuccess=function(e){var t=r.result;t?(n.next(new T(k.COMPLETE,1,1,t.value)),t["continue"]()):n.complete()},r.onerror=function(e){n.next(new T(k.ERROR,0,0)),n.complete()}});return this.getCount().pipe(s.mergeMap(function(e){return t._from_scan(n,e.data)}))},e.prototype.getAllById=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.map(function(e){return t.getById(e)});return this._concat_scan.apply(this,c(r))},e.prototype.getAllByIndex=function(e){var t=this,o=this.objectStore.index(e),n=new a.Observable(function(n){var r=o.openCursor();r.onsuccess=function(e){var t=r.result;t?(n.next(new T(k.COMPLETE,1,1,t.value)),t["continue"]()):n.complete()},r.onerror=function(e){n.next(new T(k.ERROR,0,0)),n.complete()}});return this.getCount(o).pipe(s.mergeMap(function(e){return t._from_scan(n,e.data)}))},e.prototype.update=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore.put(n);r.initRequest(t,e)})},e.prototype.updateAll=function(e){var t=this,n=e.map(function(e){return t.update(e)});return this._concat_scan.apply(this,c(n))},e.prototype["delete"]=function(n){var r=this;return new a.Observable(function(e){var t=r.objectStore["delete"](n);r.initRequest(t,e)})},e.prototype.deleteAll=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.map(function(e){return t["delete"](e)});return this._concat_scan.apply(this,c(r))},e.prototype.getCount=function(n,e){var r=this;return new a.Observable(function(e){var t=n===undefined?r.objectStore.count():n.count();r.initRequest(t,e)})},e.prototype.initRequest=function(t,n){t.onsuccess=function(){t.result!==undefined?n.next(new T(k.COMPLETE,1,1,t.result)):n.next(new T(k.ERROR,0,0)),n.complete()},t.onerror=function(e){n.next(new T(k.ERROR,0,0,t.error)),n.complete()}},e.prototype._from_scan=function(e,t){return e.pipe(s.scan(function(e,t){return t.type!==k.ERROR?(e.loaded++,e.data.push(t.data),e.loaded===e.total&&(e.type=k.COMPLETE)):(e.type=k.ERROR,e.loaded=0),e},new T(k.PENDING,0,t,new Array)))},e.prototype._concat_scan=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;return a.concat.apply(void 0,c(e)).pipe(s.scan(function(e,t){return t.type!==k.ERROR?(e.loaded++,e.data.push(t.data),e.loaded===e.total&&(e.type=k.COMPLETE)):(e.type=k.ERROR,e.loaded=0),e},new T(k.PENDING,0,n,new Array)))},e}(),T=function Y(e,t,n,r){this.type=e,this.loaded=t,this.total=n,this.data=r===undefined?undefined:r},k={PENDING:"Pending",SUCCESS:"Success",ERROR:"Error",COMPLETE:"Complete"},S=function(){function e(e,t){this.markdownService=e,this.renderer=t,this.indexedDBStructs=[{name:"markdown_article",optionalParameters:{keyPath:"id",autoIncrement:!0},indexes:[{name:"title",keyPath:"title",options:{unique:!1}}]}];var n=t.createElement("LI");this.renderer.addClass(n,"fb-li"),this.renderer.addClass(n,"fb-li_create");var r=t.createElement("I");this.renderer.addClass(r,"material-icons"),this.renderer.addClass(r,"md-18"),this.renderer.addClass(r,"md-dark"),this.renderer.appendChild(r,this.renderer.createText("edit"));var o=t.createElement("INPUT");this.renderer.addClass(o,"fb-li_create-input"),this.renderer.setAttribute(o,"contenteditable","true"),this.renderer.appendChild(n,r),this.renderer.appendChild(n,o),this.inputArea=n,this.isConnect=!1,this.selectedArticles={}}return e.prototype.ngOnInit=function(){var t=this;O.instenceof("ngr2-markdown-db",this.indexedDBStructs).subscribe(function(e){t.indexedDB=e,t.isConnect=!0,t.refreshArticles()}),this.fileListArea=this.fileList.nativeElement},e.prototype.createFile=function(){var t=this,n=this.inputArea.cloneNode(!0);this.renderer.listen(n,"keyup",function(e){switch(e.code){case"Enter":t.indexedDB.getObjectStore("markdown_article","readwrite").add(new R("ce",e.target.value)).subscribe(function(e){t.refreshArticles(),t.renderer.removeChild(t.fileListArea,n)})}}),this.renderer.appendChild(this.fileListArea,n)},e.prototype.createFolder=function(){console.log("createFolder")},e.prototype.rename=function(){var t=this,n=this.inputArea.cloneNode(!0),r=Object.getOwnPropertyNames(this.selectedArticles)[0],o=this.selectedArticles[r];this.renderer.listen(n,"keyup",function(e){switch(e.code){case"Enter":o.data.title=e.target.value,t.indexedDB.getObjectStore("markdown_article","readwrite").update(o.data).subscribe(function(e){t.refreshArticles(),t.renderer.removeChild(t.fileListArea,n),t.selectedArticles[r]=null})}}),this.fileListArea.replaceChild(n,o.el),n.lastChild.focus()},e.prototype["delete"]=function(){var e,t=this;(e=this.indexedDB.getObjectStore("markdown_article","readwrite")).deleteAll.apply(e,c(Object.getOwnPropertyNames(this.selectedArticles).map(function(e){return t.selectedArticles[Number.parseInt(e,10)].data.id}))).subscribe(function(e){return t.refreshArticles()})},e.prototype.close=function(){console.log("close")},e.prototype.select=function(e,t){console.log("select"),this.selectedArticles[t.id.toString(10)]?(this.selectedArticles[t.id.toString(10)]=null,e.classList.remove("fb-li_selected")):(this.selectedArticles[t.id.toString(10)]={el:e,data:t},e.classList.add("fb-li_selected"))},e.prototype.open=function(e,t){console.log("open"),this.markdownService.reinitialization(t.content)},e.prototype.refreshArticles=function(){var t=this;this.indexedDB.getObjectStore("markdown_article","readwrite").getAll().subscribe(function(e){t.articles=e.data})},e.decorators=[{type:r.Component,args:[{selector:"nb-file-browser",template:'<div class="file-browser">\r\n  <header class="fb-header"\r\n  >\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="createFile()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        note_add\r\n      </i>\r\n    </button>\r\n    \x3c!--创建文件夹暂时不可用--\x3e\r\n    \x3c!--(click)="createFolder()"--\x3e\r\n    <button class="fb-button fb-button_disable"\r\n            style="opacity: 0.5;"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        create_new_folder\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="delete()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        delete\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover"\r\n            (click)="rename()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        edit\r\n      </i>\r\n    </button>\r\n    <button class="fb-button fb-button_hover fb-button_close"\r\n            (click)="close()"\r\n    >\r\n      <i class="material-icons md-dark">\r\n        close\r\n      </i>\r\n    </button>\r\n  </header>\r\n  <aside class="fb-list"\r\n  >\r\n    <ul class="fb-ul"\r\n        #fileList\r\n    >\r\n      <li class="fb-li fb-li_hover" *ngFor="let article of articles"\r\n          (click)="select($any($event.currentTarget), article)"\r\n          (dblclick)="open($any($event.currentTarget), article)"\r\n      >\r\n        <i class="material-icons md-18 md-dark">\r\n          insert_drive_file\r\n        </i>\r\n        <span>\r\n          {{ article.title }}\r\n        </span>\r\n      </li>\r\n    </ul>\r\n  </aside>\r\n</div>\r\n',styles:[".file-browser{display:flex;flex-direction:column;height:100%;background-color:#d3d3d3}.file-browser .fb-button{cursor:pointer;padding:1px 2px;margin:0;border:0;outline:0;height:100%;background-color:transparent}.file-browser .fb-button_hover:hover{background-color:rgba(0,0,0,.1)}.file-browser .fb-button_disable{cursor:default;opacity:.5}.file-browser .fb-button_close{float:right}.file-browser .fb-header{flex:0 0 30px;background-color:rgba(0,0,0,.1)}.file-browser .fb-list{flex:1 1 auto}.file-browser .fb-ul{list-style:none;margin:0;padding:2px}.file-browser .fb-li{display:flex;box-sizing:border-box;font-size:14px;width:190px;padding:2px;margin:3px;background-color:rgba(0,0,0,.05);border-radius:2px}.file-browser .fb-li_hover:hover{background-color:rgba(0,0,0,.1)}.file-browser .fb-li span{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.file-browser .fb-li_selected,.file-browser .fb-li_selected:hover{background-color:rgba(0,0,0,.2)}.file-browser .fb-li_create{background-color:#fff}.file-browser .fb-li_create-input{box-sizing:padding-box;width:163px;padding:0 0 0 5px;outline:0;border:none}"]}]}],e.ctorParameters=function(){return[{type:p},{type:r.Renderer2}]},e.propDecorators={fileList:[{type:r.ViewChild,args:["fileList",{read:r.ElementRef}]}]},e}(),R=function(){function r(e,t,n){void 0===e&&(e=r.AUTHOR),void 0===t&&(t=r.TITLE),void 0===n&&(n=r.CONTENT),this.author=e,this.title=t,this.content=n,this.createTime=new Date,this.lastModifiedTime=this.createTime}return r.AUTHOR="Author",r.TITLE="Default Title",r.CONTENT="# Default Title",r}(),D=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){var t=this;this.markdownService.observeMarkdown().subscribe(function(e){t.mdInfo=e.Markdown,t.htmlInfo=e.HTML,console.log(e)})},e.decorators=[{type:r.Component,args:[{selector:"nb-status-bar",template:'<footer class="status-bar"\r\n>\r\n  <div class="status-bar_panel status-bar_panel-left"\r\n  >\r\n    <span class="status-bar_panel-name">Markdown</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.bytes }}</span>bytes</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.words }}</span>words</span>\r\n    <span><span class="status-bar_panel-value">{{ mdInfo.lines }}</span>lines</span>\r\n  </div>\r\n  <div class="status-bar_panel status-bar_panel-right"\r\n  >\r\n    <span class="status-bar_panel-name">HTML</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.characters }}</span>characters</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.words }}</span>words</span>\r\n    <span><span class="status-bar_panel-value">{{ htmlInfo.paragraphs }}</span>paragraphs</span>\r\n  </div>\r\n</footer>\r\n',styles:[".status-bar{display:flex;justify-content:space-between;font-size:10px;background-color:#007acc;color:#fff;height:100%}.status-bar_panel{line-height:20px}.status-bar_panel-value{font-weight:700;margin-left:5px;margin-right:2px}.status-bar_panel-left{margin-left:210px}.status-bar_panel-right{margin-right:210px}"]}]}],e.ctorParameters=function(){return[{type:p}]},e}(),A=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:r.Component,args:[{selector:"nb-control-bar",template:"control bar\r\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),L=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:r.Component,args:[{selector:"nb-menu",template:"menu\r\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),I="dragstart",M="drag",P="dragend",N="dragenter",B="dragover",j="drop",H=function(){function r(e,t,n){void 0===t&&(t=r.ALL_OPTIONS),this.el=e,this.options=t,this.observable=this.initEvent(n)}return r.prototype.initEvent=function(e){var o=this,t=Object.getOwnPropertyNames(this.options).reduce(function(e,t){var n=o.options[t],r=o.addEventListener(o.el,n);return r=o.addListenFunction(r,n),e.push(r),e},[]);return a.merge.apply(void 0,c(t))},r.prototype.addEventListener=function(e,t,n){void 0===n&&(n=function(e){return e});var r=a.fromEvent(e,t.eventType,t.eventOptions,n);return r=this.eventOptions(r,t),r=this.streamOperator(r,t)},r.prototype.addListenFunction=function(e,t){return t.listener?e.pipe(s.tap(t.listener)):e},r.prototype.eventOptions=function(e,t){return e.pipe(s.map(function(e){return t.preventDefault&&e.preventDefault(),t.stopPropagation&&(e.stopPropagation(),e.cancelBubble=!0),e}))},r.prototype.streamOperator=function(e,t){if(!t.operatorOptions)return e;var n=t.operatorOptions;return n.throttleTime&&0<n.throttleTime&&(e=e.pipe(s.throttleTime(n.throttleTime))),n.filter&&(e=e.pipe(s.filter(n.filter))),e},r.ALL_OPTIONS={dragstart:{eventType:I,listener:r.defaultFun=function(e){console.group("on "+e.type),console.groupEnd()}},drag:{eventType:M,listener:r.defaultFun,operatorOptions:{throttleTime:1e3}},dragend:{eventType:P,listener:r.defaultFun},dragenter:{eventType:N,listener:r.defaultFun,preventDefault:!0},dragover:{eventType:B,listener:r.defaultFun,operatorOptions:{throttleTime:100},preventDefault:!0},drop:{eventType:j,listener:r.defaultFun}},r}(),U=function(){function a(e,t,n,r){void 0===n&&(n=a.ELEMENT_STYLE),void 0===r&&(r=a.DEMO_STYLE);var o=this;this.diagonal={RT_ANGLE:Math.PI/4,LT_ANGLE:Math.PI/4*3,LB_ANGLE:Math.PI/4*3*-1,RB_ANGLE:Math.PI/4*-1},this._el=e||null,this.parentContainer=t||null,this._parent=this._el&&this._el.parentElement||null,this.clone=this._el&&this._el.cloneNode(!0)||null,Object.getOwnPropertyNames(n).forEach(function(e){o._el.style[e]=n[e]}),Object.getOwnPropertyNames(r).forEach(function(e){o.clone.style[e]=r[e]}),this._el.draggable=!0,this._dadEvent=new H(this._el,{dragstart:{eventType:I,stopPropagation:!0,listener:this.ondragstart.bind(this)},drag:{eventType:M,stopPropagation:!0,listener:this.ondrag.bind(this),operatorOptions:{throttleTime:1e3}},dragend:{eventType:P,stopPropagation:!0,listener:this.ondragend.bind(this)},dragenter:{eventType:N,listener:this.ondragenter.bind(this),preventDefault:!0,operatorOptions:{filter:function(e){return!!o.parentContainer.equals(e)&&(o._el!==o.parentContainer.getDragElement()._el&&o._el===e.target)}}},dragover:{eventType:B,listener:this.ondragover.bind(this),operatorOptions:{throttleTime:100,filter:function(e){return!!o.parentContainer.equals(e)&&o._el!==o.parentContainer.getDragElement()._el}},preventDefault:!0},drop:{eventType:j,stopPropagation:!0,listener:this.ondrop.bind(this)}}),this._dadEvent.observable.subscribe(function(e){}),this.status="none";var i=this.clientRect;this.centerPoint=new K(i.left+i.width/2,i.top+i.height/2)}return Object.defineProperty(a.prototype,"clientRect",{get:function(){return this._el.getBoundingClientRect()},enumerable:!0,configurable:!0}),a.prototype.reset=function(){this.transitDemonstrationFinish(this.parentContainer.getDragElement())},a.prototype.ondragstart=function(e){console.group("on drop start"),this.status="drag",this.parentContainer.setDragElement(this,e),console.groupEnd()},a.prototype.ondrag=function(e){console.group("on drag"),console.groupEnd()},a.prototype.ondragend=function(e){console.group("on drag end"),this.status="none",console.groupEnd()},a.prototype.ondragenter=function(e){if(this.parentContainer.getDragElement()._parent===this._parent&&this._el===e.target&&this._el!==this.parentContainer.getDragElement()._el){console.group("on drag enter"),this.status="drop",this.parentContainer.setDropElement(this);var t=this.clientRect;this.diagonal.RT_ANGLE=Math.atan2(t.height/2,t.width/2),this.diagonal.LT_ANGLE=Math.PI-this.diagonal.RT_ANGLE,this.diagonal.LB_ANGLE=-this.diagonal.LT_ANGLE,this.diagonal.RB_ANGLE=-this.diagonal.RT_ANGLE,console.groupEnd()}},a.prototype.ondragover=function(e){console.group("on drag over"),this.transitDemonstration(this.parentContainer.getDragElement(),new K(e.clientX,e.clientY)),console.groupEnd()},a.prototype.ondragleave=function(e){console.group("on drag leave"),this.status="none",this.transitDemonstrationFinish(this.parentContainer.getDragElement()),console.groupEnd()},a.prototype.ondragexit=function(e){console.group("on drag exit"),console.groupEnd()},a.prototype.ondrop=function(e){console.group("on drop"),this.status="drop",this.replaceElement(this.parentContainer.getDragElement()._el,this.parentContainer.getDragElement().clone),console.groupEnd()},a.prototype.insertBefore=function(e){return this._parent.insertBefore(e,this._el)},a.prototype.insertAfter=function(e){return this._el.nextElementSibling?this._parent.insertBefore(e,this._el.nextElementSibling):this._parent.appendChild(e)},a.prototype.computeDirection=function(e){this.centerPoint=new K(this.clientRect.left+this.clientRect.width/2,this.clientRect.top+this.clientRect.height/2),e.relaitiveTo(this.centerPoint);var t=Math.atan2(e.Y,e.X);return t>=this.diagonal.RT_ANGLE&&t<this.diagonal.LT_ANGLE?"top":t>=this.diagonal.LT_ANGLE||t<this.diagonal.LB_ANGLE?"left":t>=this.diagonal.LB_ANGLE&&t<this.diagonal.RB_ANGLE?"bottom":"right"},a.prototype.transitDemonstration=function(e,t){var n=this.computeDirection(t);"top"===n||"left"===n?this.insertBefore(e._el):"bottom"!==n&&"right"!==n||this.insertAfter(e._el),console.log(n)},a.prototype.transitDemonstrationFinish=function(e){this.removeElement(e._el)},a.prototype.removeElement=function(e){for(var t=0;t<this._parent.children.length;t++)if(this._parent.children[t]===e)return this._parent.removeChild(e),e},a.prototype.replaceElement=function(e,t){for(var n=0;n<this._parent.children.length;n++)if(this._parent.children[n]===t)return this._parent.replaceChild(e,t),t},a.ELEMENT_STYLE={},a.DEMO_STYLE={opacity:"0.5"},a}(),K=function(){function e(e,t){this.X=e||null,this.Y=t||null}return e.prototype.relaitiveTo=function(e){this.X-=e.X,this.Y=e.Y-this.Y},e}(),F=function(){function e(e){this._el=e||null,this._children=e.children||null,this.DADChildren=[];for(var t=0;t<this._children.length;t++){var n=new U(this._children[t],this);this.DADChildren.push(n)}}return e.prototype.setDragElement=function(e,t){this._dragEl=e,this.id=(new Date).getTime(),t.dataTransfer.setData("text/containerid:"+this.id.toString(10),this.id.toString(10))},e.prototype.getDragElement=function(){return this._dragEl},e.prototype.setDropElement=function(e){this._dropEl=e},e.prototype.getDropElement=function(){return this._dropEl},e.prototype.equals=function(e){var t=e.dataTransfer.types[e.dataTransfer.types.length-1];return!!t&&(t=t.split(":")[1],this.id===Number.parseInt(t,10))},e}(),G=function(){function e(e){this.el=e}return e.prototype.ngOnInit=function(){},e.prototype.ngAfterViewInit=function(){this.DADContainer=new F(this.el.nativeElement)},e.decorators=[{type:r.Directive,args:[{selector:"[nbDragAndDrop]"}]}],e.ctorParameters=function(){return[{type:r.ElementRef}]},e}(),q=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[m,g,v,y,w,E,S,D,A,L,G],imports:[n.BrowserModule],exports:[m,g,y]}]}],e}();e.Ngr2MarkdownService=p,e.EditorOption=h,e.TOCItem=f,e.Ngr2MarkdownComponent=m,e.Ngr2MarkdownModule=q,e.ɵh=A,e.ɵj=G,e.ɵe=E,e.ɵf=S,e.ɵi=L,e.ɵb=v,e.ɵc=y,e.ɵa=g,e.ɵg=D,e.ɵd=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngr2-markdown.umd.min.js.map