!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("markdown-it/lib/index"),require("highlight.js"),require("rxjs/operators"),require("@angular/platform-browser"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("ngr2-markdown",["exports","markdown-it/lib/index","highlight.js","rxjs/operators","@angular/platform-browser","@angular/core","rxjs"],t):t(e["ngr2-markdown"]={},e.MarkdownIt,e.hljs,e.rxjs.operators,e.ng.platformBrowser,e.ng.core,e.rxjs)}(this,function(e,t,o,n,r,i,a){"use strict";var s=function(){function e(){var r=this;this.markdownIt=new t({highlight:function(e,t){if(t&&o.getLanguage(t))try{return'<pre class="hljs"><code>'+o.highlight(t,e).value+"</code></pre>"}catch(n){}return'<pre class="hljs"><code>'+r.markdownIt.utils.escapeHtml(e)+"</code>"}})}return e.prototype.render=function(e,t){this.disable(t);var n=this.markdownIt.render(e);return this.enable(t),n},e.prototype.use=function(t){var n=this.markdownIt;new a.Subject;return new a.Observable(function(e){n.use(t,e)})},e.prototype.enable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.enable(e)}},e.prototype.disable=function(t){if(t){var e=Object.keys(t).filter(function(e){return!t[e]});this.markdownIt.disable(e)}},e}();function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var d=function(){function e(){this.fileReader=new FileReader}return e.prototype.toDataURL=function(e){return this.fileReader.readAsDataURL(e),this.mergeFileReader(this.fileReader)},e.prototype.toText=function(e,t){return this.fileReader.readAsText(e,t),this.mergeFileReader(this.fileReader)},e.prototype.toArrayBuffer=function(e){return this.fileReader.readAsArrayBuffer(e),this.mergeFileReader(this.fileReader)},e.prototype.toDataURLSync=function(e){return this.result=window.URL.createObjectURL(e),this.result},e.prototype.revokeDataURLSync=function(){window.URL.revokeObjectURL(this.result)},e.prototype.mergeFileReader=function(t){return a.merge.apply(void 0,c([a.fromEvent(t,"load"),a.fromEvent(t,"loadstart"),a.fromEvent(t,"loadend"),a.fromEvent(t,"progress"),a.fromEvent(t,"error"),a.fromEvent(t,"abort")])).pipe(n.map(function(e){return Object.assign(e,{result:t.result||"",error:t.error||null})}))},e}(),u=function(){function e(){var i=this;this.unitMap={exist:!1,child:{b:{exist:!1,child:{v:{exist:!0,child:{}}}},c:{exist:!1,child:{i:{exist:!0,child:{}},p:{exist:!0,child:{}}}},h:{exist:!1,child:{c:{exist:!0,child:{}},l:{exist:!0,child:{r:{exist:!0,child:{}}}},v:{exist:!0,child:{}}}},i:{exist:!1,child:{v:{exist:!0,child:{}}}},m:{exist:!1,child:{e:{exist:!0,child:{r:{exist:!0,child:{}}}},m:{exist:!0,child:{}},c:{exist:!0,child:{}}}},n:{exist:!1,child:{i:{exist:!0,child:{m:{exist:!1,child:{v:{exist:!0,child:{}}}}}}}},p:{exist:!1,child:{a:{exist:!1,child:{c:{exist:!0,child:{}}}}}},q:{exist:!0,child:{}},t:{exist:!1,child:{p:{exist:!0,child:{}}}},w:{exist:!1,child:{v:{exist:!0,child:{}}}},x:{exist:!1,child:{a:{exist:!1,child:{m:{exist:!1,child:{v:{exist:!0,child:{}}}}}},e:{exist:!0,child:{}},p:{exist:!0,child:{}}}}}},this.currentHeading=new a.BehaviorSubject(null),this.currentContent=new a.BehaviorSubject(null),this.TOCInfo=new a.BehaviorSubject(null),this.markdownIt=new s,this.markdownIt.use(this.anchor).subscribe(function(e){for(var t=e.map(function(e){return new h(e.content,e.indentLevel)}),n=new h("root",0),r=n,o=0;o<t.length;o++){for(;r&&r.indentLevel>=t[o].indentLevel;)r=r.parent;(t[o].parent=r).children.push(t[o]),r=t[o]}i.TOCInfo.next(n)})}return e.prototype.render=function(e,t){"string"!=typeof e&&(e="");var n=this.markdownIt.render(e,t);return this.currentContent.next({md:e,html:n}),n},e.prototype.setCurrentHeading=function(e){this.currentHeading.getValue()!==e&&this.currentHeading.next(e)},e.prototype.checkUnit=function(e,t,n){if(void 0===t&&(t=this.unitMap),t&&e){var r;n||(e=e.toLocaleLowerCase());var o=!1;for(r=e.length-1;0<=r;r--){var i=e.charCodeAt(r);if(48<=i&&i<=57){o=t.exist;break}if(!t.child[e[r]])break;t=t.child[e[r]]}return o?{unit:e.substr(r+1),number:Number.parseInt(e.substr(0,r+1),10)}:null}},e.prototype.currentContentToDataUrl=function(e){var t,n=new d;switch(e){case"markdown":t=new File([this.currentContent.getValue().md],"markdown",{type:"text/plain"});break;case"html":t=new File([this.currentContent.getValue().html],"html",{type:"text/html"});break;default:t=new File(["null"],"html",{type:"text/html"})}return n.toDataURLSync(t),n},e.prototype.anchor=function(e,t){e.core.ruler.push("anchor",function(e){var r=new Array;e.tokens.map(function(e,t,n){"heading_open"===e.type&&(e.attrJoin("id",n[t+1].content),r.push({content:e.attrGet("id"),indentLevel:e.markup.length}))}),t.next(r)})},e.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=i.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),p=function D(e,t,n,r,o,i,a){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r="left"),void 0===o&&(o="800px"),void 0===i&&(i="#3f51b5"),void 0===a&&(a="markdown-body"),this.anchor=e,this.TOC=t,this.toolBar=n,this.direction=r,this.height=o,this.themeColor=i,this.bodyClassName=a},h=function R(e,t){this.content=e,this.indentLevel=t,this.children=new Array},f=function(){function e(e){this.markdownService=e}return Object.defineProperty(e.prototype,"markdown",{set:function(e){var t=this;this._html=this.markdownService.render(e),this.reinitialization(),setTimeout(function(){t.updateHeadingInfo()})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{set:function(e){this._options=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;a.fromEvent(this.markdownBody.nativeElement,"scroll").pipe(n.filter(function(){return e.headingElementRef&&0<e.headingElementRef.length}),n.map(function(){return e.markdownScroll()}),n.distinctUntilChanged()).subscribe(this.markdownService.currentHeading)},e.prototype.reinitialization=function(){this.headingElementMarginTop={},this.headingElementRef=new Array,this.markdownBody.nativeElement.scrollTop=0,this.markdownService.setCurrentHeading(null)},e.prototype.markdownScroll=function(){var n,r,o,i,a=this,s=this.markdownBody.nativeElement.getBoundingClientRect().top;return this.headingElementRef.reduce(function(e,t){return n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),o=a.headingElementMarginTop[e.id],i=a.headingElementMarginTop[t.id],0<r.top-s-i?e:r.top-s-i>n.top-s-o?t:e}).id},e.prototype.updateHeadingInfo=function(){var e,n=this,t=this.markdownBody.nativeElement.querySelectorAll("h1, h2, h3, h4, h5, h6");t!==undefined&&null!==t&&(this.headingElementRef.splice(0),t.forEach(function(e){var t=n.getComputedStyle(e,"margin-top");n.headingElementMarginTop[e.id]=n.markdownService.checkUnit(t).number}),(e=this.headingElementRef).push.apply(e,c(t)))},e.prototype.getComputedStyle=function(e,t,n){return window.getComputedStyle(e,null).getPropertyValue(t)},e.decorators=[{type:i.Component,args:[{selector:"nb-ngr2-markdown",template:'<div class="main-panel"\n     [style.height]="_options.height"\n>\n  <nb-tool-bar class="tool-bar"\n               nbDragAndDrop\n               [droppable]="true"\n  ></nb-tool-bar>\n  <div class="content-panel content-container">\n    <nb-file-browser class="file-browser"></nb-file-browser>\n    <nb-edit-box *ngIf="mode === \'edit\'"\n                 [ngClass]="\'editor\'"\n    >\n    </nb-edit-box>\n    <nb-control-bar class="control-bar"></nb-control-bar>\n    <article #markdownBody\n             [ngClass]="[_options.bodyClassName]"\n             [innerHTML]="_html | safe:\'html\'"\n    >\n    </article>\n    <nb-menu class="menu"></nb-menu>\n  </div>\n  <nb-status-bar class="status-bar" nbDragAndDrop [droppable]="true"></nb-status-bar>\n</div>\n',encapsulation:i.ViewEncapsulation.None,styles:[".main-panel{position:relative;display:flex;flex-direction:column;flex:1 1 auto;box-sizing:border-box;padding:15px}.markdown-body{flex:1;overflow-y:auto;box-sizing:border-box;margin:0 auto;padding:45px;min-width:200px;height:100%}.editor{flex:1;overflow-y:auto;box-sizing:border-box;margin:0 auto;padding:5px;min-width:200px;height:100%}.content-container{display:flex;flex-direction:row}.side-toc-container{flex:0 auto;max-width:200px}.tool-bar{flex:0 0 25px;background-color:#d3d3d3}.content-panel{flex:1 1 auto;background-color:#a9a9a9}.status-bar{flex:0 0 15px;background-color:gray}.file-browser{flex:0 0 200px;background-color:#696969}.control-bar{flex:0 0 15px;background-color:#faebd7}.menu{flex:0 0 200px;background-color:#778899}"]}]}],e.ctorParameters=function(){return[{type:u}]},e.propDecorators={markdownBody:[{type:i.ViewChild,args:["markdownBody",{read:i.ElementRef}]}],markdown:[{type:i.Input}],options:[{type:i.Input}],mode:[{type:i.Input}]},e}(),m=function(){function e(e){this.markdownService=e,this.themeColor="#3f51b5"}return e.prototype.ngOnInit=function(){var t=this;this.markdownService.currentHeading.subscribe({next:function(e){t.currentHeading=e}}),this.markdownService.TOCInfo.subscribe({next:function(e){t.TOCInfo=e}})},e.decorators=[{type:i.Component,args:[{selector:"nb-side-toc",template:"<aside class=\"side-anchor-toc\">\n  <ol class=\"nav\">\n    <li *ngFor=\"let TOCItem of TOCInfo.children\"\n        [ngClass]=\"['item-level-' + TOCItem.indentLevel, 'nav-item', 'nav-item-active']\"\n    >\n      <a [href]=\"'#' + TOCItem.content\"\n         [ngClass]=\"['nav-item-link']\"\n         [ngStyle]=\"{'color': TOCItem.content === currentHeading ? themeColor : ''}\"\n      >\n        <span>{{ TOCItem.content }}</span>\n      </a>\n      <ol class=\"nav\">\n        <li *ngFor=\"let subItem of TOCItem.children\"\n            [ngClass]=\"['item-level-' + subItem.indentLevel, 'nav-item', 'nav-item-active']\"\n        >\n          <a [href]=\"'#' + subItem.content\"\n             [ngClass]=\"['nav-item-link']\"\n             [ngStyle]=\"{'color': subItem.content === currentHeading ? themeColor : ''}\"\n          >\n            <span>{{ subItem.content }}</span>\n          </a>\n        </li>\n      </ol>\n    </li>\n  </ol>\n</aside>\n",styles:[".side-anchor-toc{display:flex;flex-direction:column;font-size:14px;margin:0 auto;padding:10px;color:gray}.side-anchor-toc a{color:#696969}.nav{margin:0}.nav-item{line-height:1.8;cursor:pointer}.nav-item-link{text-decoration:none;outline:0}"]}]}],e.ctorParameters=function(){return[{type:u}]},e.propDecorators={currentHeading:[{type:i.Input}],themeColor:[{type:i.Input}]},e}(),g=function(){function e(e){this.domSanitizer=e}return e.prototype.transform=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];switch(t[0]){case"html":return this.domSanitizer.bypassSecurityTrustHtml(e);case"url":return this.domSanitizer.bypassSecurityTrustUrl(e);default:return this.domSanitizer.bypassSecurityTrustHtml(e)}},e.decorators=[{type:i.Pipe,args:[{name:"safe"}]}],e.ctorParameters=function(){return[{type:r.DomSanitizer}]},e}(),b=function(){function e(e){this.markdownService=e}return e.prototype.transform=function(e,t){return this.markdownService.render(e,{anchor:!1})},e.decorators=[{type:i.Pipe,args:[{name:"md"}]}],e.ctorParameters=function(){return[{type:u}]},e}(),y=function(){function e(e){this.markdownService=e}return e.prototype.ngOnInit=function(){var t,n,r=this;this.titleSubscribe=this.markdownService.TOCInfo.subscribe(function(e){return r.title=e.content}),this.hrefSubscribe=this.markdownService.currentContent.subscribe(function(e){t&&t.revokeDataURLSync(),n&&n.revokeDataURLSync(),t=r.markdownService.currentContentToDataUrl("markdown"),n=r.markdownService.currentContentToDataUrl("html"),r.mdHref=t.result,r.htmlHref=n.result})},e.prototype.ngOnDestroy=function(){this.titleSubscribe.unsubscribe(),this.hrefSubscribe.unsubscribe()},e.decorators=[{type:i.Component,args:[{selector:"nb-tool-bar",template:"<a [download]=\"title + '.md'\"\n   [href]=\"mdHref | safe:'url'\"\n>\n  MD\n</a>\n<a [download]=\"title + '.html'\"\n   [href]=\"htmlHref | safe:'url'\"\n>\n  HTML\n</a>\n",styles:["a{color:gray;text-decoration:none}"]}]}],e.ctorParameters=function(){return[{type:u}]},e.propDecorators={download:[{type:i.ViewChild,args:["download",{read:i.ElementRef}]}]},e}(),v=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"nb-edit-box",template:'<div class="edit-box"\n>\n  \x3c!-- tool bar --\x3e\n  \x3c!-- 工具栏 扩展用 --\x3e\n  <div class="edit-tool-bar"\n  >\n  </div>\n  \x3c!-- edit content --\x3e\n  \x3c!-- 编辑框 --\x3e\n  <div class="edit-content"\n       contenteditable="true"\n  >\n  </div>\n</div>\n',styles:[".edit-box{display:flex;flex-direction:column;height:100%}.edit-tool-bar{flex:0 0 25px}.edit-content{overflow-y:auto;overflow-wrap:break-word;flex:auto;outline:0;border:1px solid gray;padding:8px}"]}]}],e.ctorParameters=function(){return[]},e}(),x=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"nb-file-browser",template:"file browser\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),w=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"nb-status-bar",template:"status bar\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),k=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"nb-control-bar",template:"control bar\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),C=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:i.Component,args:[{selector:"nb-menu",template:"menu\n",styles:[""]}]}],e.ctorParameters=function(){return[]},e}(),S=function(){function e(){this.elementMap={},this.currentDragElement=new a.BehaviorSubject(null)}return e.prototype.push=function(e,t){return this.elementMap[e]=t,e},e.prototype.get=function(e){return this.elementMap[e]?this.elementMap[e]:null},e.prototype.remove=function(e){this.elementMap[e]=null},e.prototype.setCurrentElement=function(e){this.currentDragElement.next(e)},e.prototype.getCurrentElement=function(){return this.currentDragElement.getValue()},e.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=i.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),I=function(){function e(e,t){this.el=e,this.dadService=t,this.draggable=!0,this.drag=this.ondrag,this.dragend=this.ondragend,this.dragenter=this.ondragenter,this.dragleave=this.ondragleave,this.dragover=this.ondragover,this.dragstart=this.ondragstart,this.droppable=!1,this._el=e.nativeElement,this._parent=this._el.parentElement}return e.prototype.ngOnInit=function(){this.clone=this.el.nativeElement.cloneNode(!0),this.drop=this.droppable?this.ondrop:function(){}},e.prototype.ondrag=function(e){console.group("on drag"),console.log(this._el.className),console.groupEnd()},e.prototype.ondragstart=function(e){console.group("ondropstart"),this.dadService.setCurrentElement(this._el);var t=(new Date).getTime().toString();this.dadService.push(t,this.el.nativeElement),e.dataTransfer.setData("text/timestamp",t),console.groupEnd()},e.prototype.ondragend=function(e){console.log("on drag end")},e.prototype.ondragenter=function(e){console.group("on drag enter"),console.log(this._el.className),this._transitDemonstration(),e.preventDefault(),console.groupEnd()},e.prototype.ondragover=function(e){console.group("on drag over"),console.log(this._el.className),console.groupEnd()},e.prototype.ondragleave=function(e){console.group("on drag leave"),console.log(this._el.className),this._transitDemonstrationFinish(),e.preventDefault(),console.groupEnd()},e.prototype.ondrop=function(e){console.group("ondrop");var t=this.dadService.get(e.dataTransfer.getData("text/timestamp"));this._insertBefore(t),console.groupEnd(),e.preventDefault()},e.prototype._transitDemonstration=function(){this._insertBefore(this.dadService.getCurrentElement())},e.prototype._transitDemonstrationFinish=function(){this._removeElement(this.dadService.getCurrentElement())},e.prototype._getDragElement=function(e){return this.dadService.get(e.dataTransfer.getData("text/timestamp"))},e.prototype._insertBefore=function(e){return this._parent.insertBefore(e,this._el)},e.prototype._insertAfter=function(e){return this._el.nextElementSibling?this._parent.insertBefore(e,this._el.nextElementSibling):this._parent.appendChild(e)},e.prototype._removeElement=function(e){return this._parent.removeChild(e)},e.prototype._judgeMousePosition=function(e){return""},e.decorators=[{type:i.Directive,args:[{selector:"[nbDragAndDrop]"}]}],e.ctorParameters=function(){return[{type:i.ElementRef},{type:S}]},e.propDecorators={draggable:[{type:i.HostBinding,args:["draggable"]}],drag:[{type:i.HostListener,args:["drag",["$event"]]}],dragend:[{type:i.HostListener,args:["dragend",["$event"]]}],dragenter:[{type:i.HostListener,args:["dragenter",["$event"]]}],dragleave:[{type:i.HostListener,args:["dragleave",["$event"]]}],dragover:[{type:i.HostListener,args:["dragover",["$event"]]}],dragstart:[{type:i.HostListener,args:["dragstart",["$event"]]}],drop:[{type:i.HostListener,args:["drop",["$event"]]}],droppable:[{type:i.Input}]},e}(),E=function(){function e(){}return e.decorators=[{type:i.NgModule,args:[{declarations:[f,m,g,b,y,v,x,w,k,C,I],imports:[r.BrowserModule],exports:[f,m,b]}]}],e}();e.Ngr2MarkdownService=u,e.MarkdownOption=p,e.TOCItem=h,e.Ngr2MarkdownComponent=f,e.Ngr2MarkdownModule=E,e.ɵh=k,e.ɵj=I,e.ɵe=v,e.ɵf=x,e.ɵi=C,e.ɵb=g,e.ɵc=b,e.ɵk=S,e.ɵa=m,e.ɵg=w,e.ɵd=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngr2-markdown.umd.min.js.map